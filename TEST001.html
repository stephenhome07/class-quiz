<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.2 ç§‘å­¸æ¸¬é©—ï¼šå¹³è¡¡åŠ›èˆ‡é‹å‹•</title>
    
    <!-- 1. è¼‰å…¥å¿…è¦çš„å·¥å…· -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. è¼‰å…¥ Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // ==========================================
        // æ‚¨æä¾›çš„ Firebase è¨­å®š (å·²å¡«å…¥)
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDLoHH3xJcg8RP135anypHnT--rY2O_8ag",
            authDomain: "test-235ba.firebaseapp.com",
            databaseURL: "https://test-235ba-default-rtdb.firebaseio.com",
            projectId: "test-235ba",
            storageBucket: "test-235ba.firebasestorage.app",
            messagingSenderId: "956103447126",
            appId: "1:956103447126:web:23fb288d99c599c053a1f7",
            measurementId: "G-73095GCTJ9"
        };

        // å¦‚æœæœªä¾†æœ‰ Gemini API Keyï¼Œå¯å¡«å…¥æ­¤è™•é–‹å•Ÿ AI ç¹ªåœ–åŠŸèƒ½
        const GEMINI_API_KEY = ""; 

        // åˆå§‹åŒ– Firebase
        let app, auth, db;
        let initError = null;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", e);
            initError = e.message;
        }

        window.dbServices = { 
            auth, db, 
            signInAnonymously, onAuthStateChanged, 
            collection, addDoc, query, onSnapshot, serverTimestamp, orderBy, limit, 
            GEMINI_API_KEY, initError
        };
    </script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- éœæ…‹åœ–ç¤ºçµ„ä»¶ (ç•¶æ²’æœ‰ API ç”Ÿæˆåœ–ç‰‡æ™‚ä½¿ç”¨) ---
        const Icons = {
            Atom: () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-blue-500"><circle cx="12" cy="12" r="1"/><path d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z"/><path d="M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z"/></svg>,
            Car: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-red-500"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>,
            Box: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-amber-600"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></svg>,
            Ball: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-slate-700"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
            Apple: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-red-500"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/></svg>,
            Arrow: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600"><path d="M18 8L22 12L18 16"/><path d="M2 12H22"/></svg>,
            Force: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-purple-600"><path d="m15 5 4 4-4 4"/><path d="M5 9h14"/><path d="m9 19-4-4 4-4"/><path d="M19 15H5"/></svg>,
            Skater: () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-cyan-500"><path d="M15 12h-2"/><path d="M13 14v-2"/><path d="M9 4a2 2 0 1 0 2 2"/><path d="m16 20 2-2-4-5-2 2 3 5"/><path d="m2 16 6-5 2 4-2 5"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600"><polyline points="20 6 9 17 4 12"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-500"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Image: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
        };

        // --- é¡Œç›®è³‡æ–™ (åŒ…å«ä¸»é¡Œç›® + æ‚¨è¦æ±‚çš„1é¡Œé å»ºé¡ä¼¼é¡Œ) ---
        const QUESTIONS_DATA = [
            {
                id: 1,
                question: "ä¸€è¼›æ‰‹æ¨è»ŠåŸæœ¬è™•æ–¼éœæ­¢ç‹€æ…‹ã€‚å¦‚åœ–æ‰€ç¤ºï¼Œå®ƒå—åˆ°å‘å·¦ 10 N å’Œå‘å³ 10 N çš„åŠ›åŒæ™‚ä½œç”¨ã€‚é æ¸¬é€™è¼›æ‰‹æ¨è»Šçš„é‹å‹•ç‹€æ…‹ã€‚",
                options: ["A. ä¿æŒéœæ­¢ (Remain at rest)", "B. å‹»é€Ÿé‹å‹• (Uniform motion)", "C. éå‹»é€Ÿé‹å‹• (Non-uniform motion)", "D. ç„¡æ³•åˆ¤æ–·"],
                correctAnswer: "A. ä¿æŒéœæ­¢ (Remain at rest)",
                explanation: "å‘å·¦ 10N å’Œå‘å³ 10N çš„åŠ›å¤§å°ç›¸ç­‰ã€æ–¹å‘ç›¸åï¼ŒåˆåŠ›ç‚º 0ï¼ˆå¹³è¡¡åŠ›ï¼‰ã€‚æ ¹æ“šç‰›é “ç¬¬ä¸€å®šå¾‹ï¼ŒåŸæœ¬éœæ­¢çš„ç‰©é«”åœ¨å—å¹³è¡¡åŠ›ä½œç”¨ä¸‹æœƒä¿æŒéœæ­¢ã€‚",
                keywords: ["cart", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘ä¸€æœ¬æ›¸éœç½®åœ¨æ¡Œé¢ä¸Šï¼Œå°æ˜å¾å·¦é‚Šæ–½åŠ› 5 Nï¼Œå°è¯å¾å³é‚Šæ–½åŠ› 5 Nã€‚è«‹å•é€™æœ¬æ›¸æœƒå¦‚ä½•é‹å‹•ï¼Ÿ",
                    options: ["A. å‘å³ç§»å‹•", "B. å‘å·¦ç§»å‹•", "C. ä¿æŒéœæ­¢", "D. è½‰å‹•"],
                    correctAnswer: "C. ä¿æŒéœæ­¢",
                    explanation: "å·¦å³å…©é‚Šçš„åŠ›å¤§å°ç›¸åŒä¸”æ–¹å‘ç›¸åï¼Œäº’ç›¸æŠµéŠ·ï¼ŒåˆåŠ›ç‚ºé›¶ï¼Œæ•…ç‰©é«”ä¿æŒåŸæœ¬çš„éœæ­¢ç‹€æ…‹ã€‚"
                }
            },
            {
                id: 2,
                question: "ä¸€å€‹ç®±å­æ­£åœ¨å…‰æ»‘çš„åœ°é¢ä¸Šå‘å³ç§»å‹•ã€‚æ­¤æ™‚ï¼Œå®ƒå—åˆ°å‘å·¦ 5 N å’Œå‘å³ 5 N çš„åŠ›ä½œç”¨ã€‚é æ¸¬ç®±å­æ¥ä¸‹ä¾†çš„é‹å‹•ã€‚",
                options: ["A. ç«‹å³åœæ­¢", "B. ä¿æŒéœæ­¢ (Remain at rest)", "C. å‹»é€Ÿé‹å‹• (Uniform motion)", "D. éå‹»é€Ÿé‹å‹• (Non-uniform motion)"],
                correctAnswer: "C. å‹»é€Ÿé‹å‹• (Uniform motion)",
                explanation: "å·¦å³å—åŠ›å„ 5Nï¼ŒåˆåŠ›ç‚º 0ã€‚é›–ç„¶æœ‰åŠ›ä½œç”¨ï¼Œä½†å› ç‚ºæ˜¯ã€Œå¹³è¡¡åŠ›ã€ï¼Œç‰©é«”æœƒç¶­æŒåŸæœ¬çš„é‹å‹•ç‹€æ…‹ã€‚æ—¢ç„¶åŸæœ¬åœ¨å‘å³å‹•ï¼Œå°±æœƒç¹¼çºŒä»¥åŒæ¨£é€Ÿåº¦å‘å³åšå‹»é€Ÿé‹å‹•ã€‚",
                keywords: ["box", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘å†°çƒåœ¨å†°é¢ä¸Šä»¥ 2 m/s å‘å‰æ»‘è¡Œï¼Œå‡è¨­æ‘©æ“¦åŠ›å¿½ç•¥ä¸è¨ˆï¼Œä¸”æ²’æœ‰å…¶ä»–å¤–åŠ›ä½œç”¨ï¼Œå†°çƒæœƒï¼Ÿ",
                    options: ["A. è¶Šä¾†è¶Šæ…¢", "B. ä¿æŒ 2 m/s å‹»é€Ÿç›´ç·šé‹å‹•", "C. è¶Šä¾†è¶Šå¿«", "D. ç«‹å³åœæ­¢"],
                    correctAnswer: "B. ä¿æŒ 2 m/s å‹»é€Ÿç›´ç·šé‹å‹•",
                    explanation: "ä¸å—å¤–åŠ›ï¼ˆæˆ–åˆåŠ›ç‚ºé›¶ï¼‰æ™‚ï¼Œé‹å‹•ä¸­çš„ç‰©é«”æœƒç¶­æŒåŸæœ¬çš„é€Ÿåº¦å’Œæ–¹å‘ï¼Œé€™å°±æ˜¯æ…£æ€§ã€‚"
                }
            },
            {
                id: 3,
                question: "ä¸€è¼›ç©å…·è»Šéœæ­¢åœ¨åœ°é¢ä¸Šï¼Œå—åˆ°å‘å³ 20 N çš„æ¨åŠ›å’Œå‘å·¦ 5 N çš„æ‘©æ“¦åŠ›ä½œç”¨ã€‚é æ¸¬ç©å…·è»Šçš„é‹å‹•ã€‚",
                options: ["A. ä¿æŒéœæ­¢", "B. å‹»é€Ÿé‹å‹•", "C. éå‹»é€Ÿé‹å‹• (Non-uniform motion)", "D. å…ˆå‘å·¦ç§»å‹•ï¼Œå†å‘å³ç§»å‹•"],
                correctAnswer: "C. éå‹»é€Ÿé‹å‹• (Non-uniform motion)",
                explanation: "å‘å³ 20Nï¼Œå‘å·¦ 5Nï¼ŒåˆåŠ› = 20 - 5 = 15N å‘å³ã€‚å› ç‚ºå—åŠ›ã€Œä¸å¹³è¡¡ã€ï¼Œç‰©é«”æœƒç”¢ç”ŸåŠ é€Ÿåº¦ï¼Œå¾éœæ­¢é–‹å§‹è®Šå¿«ï¼Œé€™å±¬æ–¼éå‹»é€Ÿé‹å‹•ã€‚",
                keywords: ["car", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘ä¸€è‰˜å¿«è‰‡å¼•æ“æä¾›å‘å‰ 5000 N çš„æ¨åŠ›ï¼Œæ°´é˜»åŠ›ç‚º 2000 Nã€‚è«‹å•å¿«è‰‡çš„é‹å‹•ç‹€æ…‹ï¼Ÿ",
                    options: ["A. éœæ­¢", "B. å‹»é€Ÿé‹å‹•", "C. å‘å‰åŠ é€Ÿ (éå‹»é€Ÿé‹å‹•)", "D. å‘å¾ŒåŠ é€Ÿ"],
                    correctAnswer: "C. å‘å‰åŠ é€Ÿ (éå‹»é€Ÿé‹å‹•)",
                    explanation: "æ¨åŠ›å¤§æ–¼é˜»åŠ›ï¼ŒåˆåŠ›ä¸ç‚ºé›¶ä¸”å‘å‰ï¼Œç‰©é«”æœƒæ²¿åˆåŠ›æ–¹å‘åŠ é€Ÿã€‚"
                }
            },
            {
                id: 4,
                question: "åœ–ç‰‡é¡¯ç¤ºä¸€å€‹è¶³çƒåœ¨è‰åœ°ä¸Šæ»¾å‹•ï¼Œæœ€çµ‚åœäº†ä¸‹ä¾†ã€‚é€™éç¨‹ä¸­ï¼Œè¶³çƒè™•æ–¼ä»€éº¼é‹å‹•ç‹€æ…‹ï¼Ÿé€™æš—ç¤ºäº†ä»€éº¼ï¼Ÿ",
                options: ["A. å‹»é€Ÿé‹å‹•ï¼›å—åŠ›å¹³è¡¡", "B. éå‹»é€Ÿé‹å‹•ï¼›å—åŠ›å¹³è¡¡", "C. éå‹»é€Ÿé‹å‹•ï¼›å—åŠ›ä¸å¹³è¡¡ (Unbalanced forces)", "D. ä¿æŒéœæ­¢ï¼›å—åŠ›ä¸å¹³è¡¡"],
                correctAnswer: "C. éå‹»é€Ÿé‹å‹• (Non-uniform motion)ï¼›å—åŠ›ä¸å¹³è¡¡ (Unbalanced forces)",
                explanation: "è¶³çƒå¾æ»¾å‹•åˆ°åœæ­¢ï¼Œé€Ÿåº¦åœ¨æ”¹è®Šï¼ˆæ¸›é€Ÿï¼‰ï¼Œæ‰€ä»¥æ˜¯ã€Œéå‹»é€Ÿé‹å‹•ã€ã€‚é€Ÿåº¦æ”¹è®Šå¿…å®šæ˜¯å› ç‚ºå—åˆ°ã€Œä¸å¹³è¡¡åŠ›ã€ï¼ˆæ‘©æ“¦åŠ›ï¼‰çš„ä½œç”¨ã€‚",
                keywords: ["ball", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘é¨è…³è¸è»Šæ™‚åœæ­¢è¸©è¸æ¿ï¼Œè»Šå­æœƒæ…¢æ…¢åœä¸‹ä¾†ï¼Œé€™æ˜¯å› ç‚ºå—åˆ°ä»€éº¼åŠ›çš„ä½œç”¨ï¼Ÿæ­¤æ™‚åˆåŠ›æ˜¯å¦ç‚ºé›¶ï¼Ÿ",
                    options: ["A. é‡åŠ›ï¼›åˆåŠ›ç‚ºé›¶", "B. æ‘©æ“¦åŠ›ï¼›åˆåŠ›ä¸ç‚ºé›¶", "C. æ¨åŠ›ï¼›åˆåŠ›ç‚ºé›¶", "D. æ”¯æ’åŠ›ï¼›åˆåŠ›ä¸ç‚ºé›¶"],
                    correctAnswer: "B. æ‘©æ“¦åŠ›ï¼›åˆåŠ›ä¸ç‚ºé›¶",
                    explanation: "è»Šå­æ¸›é€Ÿæ˜¯åŠ é€Ÿåº¦é‹å‹•ï¼ˆéå‹»é€Ÿï¼‰ï¼Œä»£è¡¨åˆåŠ›ä¸ç‚ºé›¶ï¼Œä¸»è¦å—åˆ°åœ°é¢çš„æ‘©æ“¦åŠ›é˜»ç¤™é‹å‹•ã€‚"
                }
            },
            {
                id: 5,
                question: "ä¸€å€‹ç‰©é«”æ‡¸æ›åœ¨ç¹©å­ä¸Šä¿æŒéœæ­¢ï¼ˆå¦‚åœ–ï¼‰ã€‚ä¸‹åˆ—å“ªé …é—œæ–¼å—åŠ›çš„æè¿°æ˜¯æ­£ç¢ºçš„ï¼Ÿ",
                options: ["A. ç‰©é«”æ²’æœ‰å—åˆ°ä»»ä½•åŠ›çš„ä½œç”¨", "B. ä½œç”¨åœ¨ç‰©é«”ä¸Šçš„åŠ›æ˜¯ä¸å¹³è¡¡åŠ›", "C. ä½œç”¨åœ¨ç‰©é«”ä¸Šçš„åŠ›æ˜¯å¹³è¡¡åŠ› (Balanced forces)", "D. é‡åŠ›å¤§æ–¼æ‹‰åŠ›"],
                correctAnswer: "C. ä½œç”¨åœ¨ç‰©é«”ä¸Šçš„åŠ›æ˜¯å¹³è¡¡åŠ› (Balanced forces)",
                explanation: "ç‰©é«”éœæ­¢ä¸å‹•ï¼Œä»£è¡¨åˆåŠ›ç‚º 0ã€‚å®ƒå—åˆ°å‘ä¸‹çš„é‡åŠ›å’Œå‘ä¸Šçš„ç¹©å­æ‹‰åŠ›ï¼Œé€™å…©å€‹åŠ›å¤§å°ç›¸ç­‰ã€æ–¹å‘ç›¸åï¼Œå±¬æ–¼å¹³è¡¡åŠ›ã€‚",
                keywords: ["box", "arrow"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘é›»ç‡ˆåŠåœ¨å¤©èŠ±æ¿ä¸Šéœæ­¢ä¸å‹•ã€‚è«‹å•é›»ç‡ˆå—åˆ°çš„é‡åŠ›å’Œé›»ç·šçš„æ‹‰åŠ›é—œä¿‚ç‚ºä½•ï¼Ÿ",
                    options: ["A. é‡åŠ› > æ‹‰åŠ›", "B. æ‹‰åŠ› > é‡åŠ›", "C. å¤§å°ç›¸ç­‰ï¼Œæ–¹å‘ç›¸å", "D. å¤§å°ç›¸ç­‰ï¼Œæ–¹å‘ç›¸åŒ"],
                    correctAnswer: "C. å¤§å°ç›¸ç­‰ï¼Œæ–¹å‘ç›¸å",
                    explanation: "éœæ­¢ä»£è¡¨å—å¹³è¡¡åŠ›ä½œç”¨ï¼Œæ•…å‘ä¸‹çš„é‡åŠ›èˆ‡å‘ä¸Šçš„æ‹‰åŠ›å¿…é ˆæŠµéŠ·ã€‚"
                }
            },
            {
                id: 6,
                question: "å°æ˜åœ¨æºœå†°å ´ä¸Šæ»‘è¡Œã€‚å‡è¨­å†°é¢å®Œå…¨æ²’æœ‰æ‘©æ“¦åŠ›ï¼Œæ ¹æ“šç‰›é “ç¬¬ä¸€å®šå¾‹ï¼Œä»–åœ¨åœæ­¢ç”¨åŠ›å¾Œæœƒå¦‚ä½•é‹å‹•ï¼Ÿ",
                options: ["A. ç«‹å³åœæ­¢", "B. æ…¢æ…¢åœä¸‹ä¾†", "C. ä»¥å‹»é€Ÿé‹å‹•ç¹¼çºŒæ»‘è¡Œ (Uniform motion)", "D. è¶Šæ»‘è¶Šå¿«"],
                correctAnswer: "C. ä»¥å‹»é€Ÿé‹å‹•ç¹¼çºŒæ»‘è¡Œ (Uniform motion)",
                explanation: "å¦‚æœæ²’æœ‰æ‘©æ“¦åŠ›ï¼ˆåˆåŠ›ç‚º 0ï¼‰ï¼Œæ ¹æ“šç‰›é “ç¬¬ä¸€å®šå¾‹ï¼ˆæ…£æ€§å®šå¾‹ï¼‰ï¼Œé‹å‹•ä¸­çš„ç‰©é«”æœƒä¸€ç›´ä¿æŒåŸæœ¬çš„é€Ÿåº¦å’Œæ–¹å‘å‰é€²ï¼Œå³å‹»é€Ÿé‹å‹•ã€‚",
                keywords: ["skater"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘åœ¨å¤–å¤ªç©ºä¸­ï¼Œå¤ªç©ºèˆ¹é—œé–‰å¼•æ“å¾Œï¼Œè‹¥ä¸è€ƒæ…®é™„è¿‘æ˜Ÿçƒçš„å¼•åŠ›ï¼Œå®ƒæœƒï¼Ÿ",
                    options: ["A. åœä¸‹ä¾†", "B. ä¿æŒåŸæœ¬é€Ÿåº¦ç›´ç·šé£›è¡Œ", "C. é–‹å§‹è½‰åœˆ", "D. æ¸›é€Ÿ"],
                    correctAnswer: "B. ä¿æŒåŸæœ¬é€Ÿåº¦ç›´ç·šé£›è¡Œ",
                    explanation: "å¤ªç©ºä¸­å¹¾ä¹æ²’æœ‰é˜»åŠ›ï¼Œä¸€æ—¦å—åŠ›ç‚ºé›¶ï¼Œç‰©é«”å°‡ä¾æ…£æ€§ç¶­æŒå‹»é€Ÿç›´ç·šé‹å‹•ã€‚"
                }
            },
            {
                id: 7,
                question: "ä¸€è¼›æ±½è»Šåœ¨é«˜é€Ÿå…¬è·¯ä¸Šè¡Œé§›ã€‚å¼•æ“æä¾›å‘å³ 5000 N çš„å‹•åŠ›ï¼Œç©ºæ°£é˜»åŠ›å’Œæ‘©æ“¦åŠ›ç¸½å…±å‘å·¦ 5000 Nã€‚è«‹å•æ±½è»Šçš„å„€è¡¨æ¿é€Ÿåº¦é‡æœƒå¦‚ä½•è®ŠåŒ–ï¼Ÿ",
                options: ["A. æŒ‡é‡æœƒå‘ä¸Šè½‰ï¼ˆåŠ é€Ÿï¼‰", "B. æŒ‡é‡æœƒå‘ä¸‹è½‰ï¼ˆæ¸›é€Ÿï¼‰", "C. æŒ‡é‡ä¿æŒä¸è®Šï¼ˆå‹»é€Ÿé‹å‹•ï¼‰", "D. æŒ‡é‡æœƒæ­¸é›¶ï¼ˆåœæ­¢ï¼‰"],
                correctAnswer: "C. æŒ‡é‡ä¿æŒä¸è®Šï¼ˆå‹»é€Ÿé‹å‹•ï¼‰",
                explanation: "å‹•åŠ› 5000N èˆ‡é˜»åŠ› 5000N æŠµéŠ·ï¼ŒåˆåŠ›ç‚º 0ï¼ˆå¹³è¡¡åŠ›ï¼‰ã€‚æ±½è»Šä¸æœƒåŠ é€Ÿä¹Ÿä¸æœƒæ¸›é€Ÿï¼Œè€Œæ˜¯ç¶­æŒç›®å‰çš„æ™‚é€Ÿè¡Œé§›ï¼Œæ‰€ä»¥é€Ÿåº¦é‡ä¸å‹•ã€‚",
                keywords: ["car", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘è·³å‚˜å“¡æ‰“é–‹é™è½å‚˜å¾Œï¼Œç•¶ç©ºæ°£é˜»åŠ›ç­‰æ–¼ä»–çš„é‡é‡æ™‚ï¼Œä»–æœƒå‘ˆç¾ä»€éº¼ç‹€æ…‹ï¼Ÿ",
                    options: ["A. éœæ­¢åœ¨ç©ºä¸­", "B. å‘ä¸Šé£›", "C. ä»¥çµ‚ç«¯é€Ÿåº¦åšå‹»é€Ÿä¸‹é™", "D. ç¹¼çºŒåŠ é€Ÿä¸‹é™"],
                    correctAnswer: "C. ä»¥çµ‚ç«¯é€Ÿåº¦åšå‹»é€Ÿä¸‹é™",
                    explanation: "å‘ä¸‹é‡åŠ›ç­‰æ–¼å‘ä¸Šé˜»åŠ›æ™‚ï¼ŒåˆåŠ›ç‚ºé›¶ï¼ŒåŠ é€Ÿåº¦ç‚ºé›¶ï¼Œæ•…ç¶­æŒå›ºå®šé€Ÿåº¦ï¼ˆçµ‚ç«¯é€Ÿåº¦ï¼‰ä¸‹é™ã€‚"
                }
            },
            {
                id: 8,
                question: "(æƒ…å¢ƒé¡Œ) åƒè€ƒèª²å ‚ä¾‹å­ï¼šæ˜Ÿå¦‚å‘å³æ¨è»Šï¼Œæœ—è»’å‘å·¦æ¨è»Šã€‚å¦‚æœæ˜Ÿå¦‚çš„åŠ›æ¯”æœ—è»’çš„å¤§ï¼Œæ‰‹æ¨è»Šæœƒå‘ˆç¾ä»€éº¼é‹å‹•ç‹€æ…‹ï¼Ÿ",
                options: ["A. ä¿æŒéœæ­¢", "B. å‹»é€Ÿé‹å‹•", "C. éå‹»é€Ÿé‹å‹• (å‘å³åŠ é€Ÿ)", "D. éå‹»é€Ÿé‹å‹• (å‘å·¦åŠ é€Ÿ)"],
                correctAnswer: "C. éå‹»é€Ÿé‹å‹• (å‘å³åŠ é€Ÿ)",
                explanation: "æ˜Ÿå¦‚ï¼ˆå‘å³ï¼‰çš„åŠ› > æœ—è»’ï¼ˆå‘å·¦ï¼‰çš„åŠ›ï¼ŒåˆåŠ›ä¸ç‚º 0 ä¸”æ–¹å‘å‘å³ã€‚å—ä¸å¹³è¡¡åŠ›ä½œç”¨ï¼Œç‰©é«”æœƒå‘åˆåŠ›æ–¹å‘åŠ é€Ÿï¼Œå³å‘å³åšéå‹»é€Ÿé‹å‹•ã€‚",
                keywords: ["cart", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘æ‹”æ²³æ¯”è³½ä¸­ï¼Œç”²éšŠæ‹‰åŠ›å¤§æ–¼ä¹™éšŠæ‹‰åŠ›ã€‚ç¹©å­ä¸­å¿ƒé»æœƒï¼Ÿ",
                    options: ["A. éœæ­¢", "B. å‘ç”²éšŠæ–¹å‘åŠ é€Ÿç§»å‹•", "C. å‘ä¹™éšŠæ–¹å‘åŠ é€Ÿç§»å‹•", "D. å‹»é€Ÿç§»å‹•"],
                    correctAnswer: "B. å‘ç”²éšŠæ–¹å‘åŠ é€Ÿç§»å‹•",
                    explanation: "åˆåŠ›æ–¹å‘æŒ‡å‘åŠ›å¤§çš„ä¸€æ–¹ï¼ˆç”²éšŠï¼‰ï¼Œæ•…ç‰©é«”æœƒå‘è©²æ–¹å‘ç”¢ç”ŸåŠ é€Ÿåº¦ã€‚"
                }
            },
            {
                id: 9,
                question: "ä¸€å€‹è˜‹æœæ”¾åœ¨æ¡Œé¢ä¸Šã€‚ä¸‹åœ–æ˜¯å®ƒçš„å­¤ç«‹ç‰©é«”åœ– (Free-body diagram)ã€‚è«‹å•åœ–ä¸­å‘ä¸Šçš„ç®­é ­ (A) å’Œå‘ä¸‹çš„ç®­é ­ (B) åˆ†åˆ¥ä»£è¡¨ä»€éº¼åŠ›ï¼Ÿ",
                options: ["A. Aæ˜¯é‡åŠ›ï¼ŒBæ˜¯æ”¯æ’åŠ›", "B. Aæ˜¯æ”¯æ’åŠ› (Supporting force)ï¼ŒBæ˜¯é‡åŠ› (Gravity)", "C. Aæ˜¯æ‘©æ“¦åŠ›ï¼ŒBæ˜¯é‡åŠ›", "D. Aæ˜¯æ”¯æ’åŠ›ï¼ŒBæ˜¯æ‘©æ“¦åŠ›"],
                correctAnswer: "B. Aæ˜¯æ”¯æ’åŠ› (Supporting force)ï¼ŒBæ˜¯é‡åŠ› (Gravity)",
                explanation: "è˜‹æœå—åœ°å¿ƒå¼•åŠ›ï¼ˆé‡åŠ›ï¼‰å‘ä¸‹ï¼Œæ‰€ä»¥ B æ˜¯é‡åŠ›ã€‚æ¡Œå­çµ¦è˜‹æœä¸€å€‹å‘ä¸Šçš„æ”¯æ’åŠ›ï¼ˆæˆ–ç¨±æ­£å‘åŠ›ï¼‰æŠµæŠ—é‡åŠ›ï¼Œæ‰€ä»¥ A æ˜¯æ”¯æ’åŠ›ã€‚",
                keywords: ["apple", "arrow"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘ä¸€å€‹äººç«™åœ¨åœ°é¢ä¸Šï¼Œé—œæ–¼ä»–å—åŠ›çš„æè¿°ï¼Œå“ªçµ„æ˜¯ä½œç”¨åŠ›èˆ‡åä½œç”¨åŠ›ï¼Ÿ",
                    options: ["A. äººçš„é‡åŠ›èˆ‡åœ°é¢çµ¦äººçš„æ”¯æ’åŠ›", "B. è…³è¸©åœ°çš„åŠ›èˆ‡åœ°é¢æ¨è…³çš„åŠ›", "C. äººçš„é‡åŠ›èˆ‡äººå°åœ°çƒçš„å¼•åŠ›", "D. ä»¥ä¸Šçš†é"],
                    correctAnswer: "C. äººçš„é‡åŠ›èˆ‡äººå°åœ°çƒçš„å¼•åŠ›",
                    explanation: "é€™æ˜¯è§€å¿µå»¶ä¼¸é¡Œã€‚åœ¨æœ¬é¡Œæƒ…å¢ƒåœ–ä¸­ï¼Œå‘ä¸Šç®­é ­æ˜¯åœ°é¢çµ¦äººçš„æ”¯æ’åŠ›ï¼Œå‘ä¸‹æ˜¯äººçš„é‡åŠ›ï¼Œé€™å…©è€…æ˜¯å¹³è¡¡åŠ›ã€‚"
                }
            },
            {
                id: 10,
                question: "åœ¨ç¹ªç•«å­¤ç«‹ç‰©é«”åœ– (Free-body diagram) æ™‚ï¼Œæˆ‘å€‘ç”¨ç®­é ­çš„é•·åº¦ä¾†ä»£è¡¨ä»€éº¼ï¼Ÿ",
                options: ["A. ç‰©é«”ç§»å‹•çš„é€Ÿåº¦", "B. åŠ›çš„å¤§å° (Magnitude of force)", "C. ç‰©é«”çš„é‡é‡", "D. åŠ›çš„ç¨®é¡"],
                correctAnswer: "B. åŠ›çš„å¤§å° (Magnitude of force)",
                explanation: "åœ¨åŠ›åœ–ä¸­ï¼Œç®­é ­çš„æ–¹å‘ä»£è¡¨åŠ›çš„æ–¹å‘ï¼Œè€Œç®­é ­çš„é•·åº¦å‰‡ä»£è¡¨åŠ›çš„å¤§å°ï¼ˆMagnitudeï¼‰ã€‚åŠ›è¶Šå¤§ï¼Œç®­é ­ç•«å¾—è¶Šé•·ã€‚",
                keywords: ["arrow", "force"],
                similar: {
                    question: "ã€é¡ä¼¼é¡Œã€‘åœ¨åŠ›åœ–ä¸­ï¼Œè‹¥ç•«äº†å…©å€‹ç®­é ­ï¼Œç®­é ­ A æ¯”ç®­é ­ B é•·å…©å€ï¼Œé€™ä»£è¡¨ï¼Ÿ",
                    options: ["A. åŠ› A çš„ä½œç”¨æ™‚é–“è¼ƒé•·", "B. åŠ› A çš„å¤§å°æ˜¯åŠ› B çš„å…©å€", "C. åŠ› A çš„é€Ÿåº¦è¼ƒå¿«", "D. ç‰©é«” A æ¯”è¼ƒé‡"],
                    correctAnswer: "B. åŠ› A çš„å¤§å°æ˜¯åŠ› B çš„å…©å€",
                    explanation: "ç®­é ­é•·åº¦èˆ‡åŠ›çš„å¤§å°æˆæ­£æ¯”ã€‚"
                }
            }
        ];

        // --- æ™ºèƒ½åœ–ç‰‡é¡¯ç¤ºçµ„ä»¶ ---
        function SmartImage({ question, apiKey }) {
            // 1. æ ¹æ“šé—œéµå­—é¸æ“‡éœæ…‹åœ–ç¤º
            let StaticIcon = Icons.Atom;
            const text = (question.question + " " + question.keywords?.join(" ")).toLowerCase();
            
            if (text.includes("è»Š") || text.includes("car") || text.includes("cart")) StaticIcon = Icons.Car;
            else if (text.includes("çƒ") || text.includes("ball") || text.includes("soccer")) StaticIcon = Icons.Ball;
            else if (text.includes("ç®±") || text.includes("box")) StaticIcon = Icons.Box;
            else if (text.includes("æœ") || text.includes("apple")) StaticIcon = Icons.Apple;
            else if (text.includes("æºœå†°") || text.includes("skater")) StaticIcon = Icons.Skater;
            else if (text.includes("åœ–") || text.includes("diagram") || text.includes("arrow")) StaticIcon = Icons.Arrow;
            else if (text.includes("åŠ›") || text.includes("force")) StaticIcon = Icons.Force;

            const [imageUrl, setImageUrl] = useState(null);
            
            // 2. å¦‚æœæœ‰ Keyï¼Œå˜—è©¦ç”Ÿæˆåœ–ç‰‡ (é€™è£¡ä¿ç•™ä»£ç¢¼ä»¥å‚™æœªä¾†ä½¿ç”¨)
            useEffect(() => {
                if (!apiKey || !question.imagePrompt) return;
                // é€™è£¡çœç•¥å¯¦éš› fetch éç¨‹ä»¥ç¯€çœ tokenï¼Œè‹¥æ‚¨å¡«å…¥ Keyï¼Œå¯å°‡ä¹‹å‰çš„ fetch é‚è¼¯æ”¾å›
            }, [apiKey, question]);

            // ç›®å‰ç‰ˆæœ¬å„ªå…ˆé¡¯ç¤ºéœæ…‹åœ–ç¤ºï¼Œç¢ºä¿ç„¡ Key ä¹Ÿèƒ½é‹ä½œ
            return (
                <div className="w-full flex justify-center mb-6">
                    <div className="p-6 bg-blue-50 rounded-full ring-4 ring-blue-100 shadow-sm">
                        <StaticIcon />
                    </div>
                </div>
            );
        }

        function App() {
            const [user, setUser] = useState(null);
            const [studentName, setStudentName] = useState("");
            const [appState, setAppState] = useState('login'); 
            const [score, setScore] = useState(0);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isAnswerChecked, setIsAnswerChecked] = useState(false);
            const [leaderboard, setLeaderboard] = useState([]);
            const [loading, setLoading] = useState(true);
            const [errorMsg, setErrorMsg] = useState("");
            
            // ç·´ç¿’æ¨¡å¼ç‹€æ…‹
            const [practiceMode, setPracticeMode] = useState(false); // æ˜¯å¦æ­£åœ¨åšé¡ä¼¼é¡Œ
            const [currentQuestionData, setCurrentQuestionData] = useState(QUESTIONS_DATA[0]);

            const { auth, db, signInAnonymously, onAuthStateChanged, collection, addDoc, query, onSnapshot, serverTimestamp, GEMINI_API_KEY, initError } = window.dbServices;

            useEffect(() => {
                if (initError) { setLoading(false); return; }
                
                // å˜—è©¦åŒ¿åç™»å…¥
                if (auth) {
                    signInAnonymously(auth).catch(e => {
                        console.error(e);
                        if(e.code === 'auth/configuration-not-found' || e.code === 'auth/admin-restricted-operation') {
                            setErrorMsg("âš ï¸ è«‹è‡³ Firebase Console é–‹å•Ÿã€ŒåŒ¿åç™»å…¥ã€æ¬Šé™");
                        } else {
                            setErrorMsg("é€£ç·šéŒ¯èª¤: " + e.code);
                        }
                        setLoading(false);
                    });

                    return onAuthStateChanged(auth, u => {
                        setUser(u);
                        setLoading(false);
                    });
                } else {
                    setLoading(false);
                }
            }, []);

            // è®€å–æ’è¡Œæ¦œ
            useEffect(() => {
                if (!user || !db) return;
                const q = query(collection(db, 'class_scores')); 
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const records = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    records.sort((a, b) => b.score - a.score);
                    setLeaderboard(records);
                }, err => console.log("æ’è¡Œæ¦œè®€å–éœ€é–‹å•Ÿæ¬Šé™"));
                return () => unsubscribe();
            }, [user]);

            // --- æ ¸å¿ƒé‚è¼¯ ---

            const startQuiz = () => {
                if (!studentName) return alert("è«‹è¼¸å…¥å§“å");
                setScore(0);
                setCurrentQuestionIndex(0);
                setPracticeMode(false);
                setCurrentQuestionData(QUESTIONS_DATA[0]);
                setAppState('quiz');
                setIsAnswerChecked(false);
                setSelectedOption(null);
            };

            const handleAnswer = (option) => {
                if(isAnswerChecked) return;
                setSelectedOption(option);
            }

            const check = () => {
                setIsAnswerChecked(true);
                if (selectedOption === currentQuestionData.correctAnswer) {
                    if (!practiceMode) setScore(s => s + 10); // åªæœ‰ä¸»æ¸¬é©—è¨ˆåˆ†
                }
            }

            // é€²å…¥é¡ä¼¼é¡Œæ¨¡å¼
            const startPractice = () => {
                const similarQ = currentQuestionData.similar;
                if (similarQ) {
                    // åˆ‡æ›åˆ°é¡ä¼¼é¡Œ
                    setPracticeMode(true);
                    setSelectedOption(null);
                    setIsAnswerChecked(false);
                    setCurrentQuestionData({
                        ...similarQ,
                        id: `p-${currentQuestionData.id}`,
                        isPractice: true
                    });
                }
            };

            const next = () => {
                // å¦‚æœæ˜¯ç·´ç¿’æ¨¡å¼ï¼Œåšå®Œè¦å›åˆ°åŸæœ¬çš„ä¸»ç·šä¸‹ä¸€é¡Œ
                if (practiceMode) {
                    setPracticeMode(false);
                    // å›åˆ°ä¸»ç·šç´¢å¼• + 1
                    const nextIdx = currentQuestionIndex + 1;
                    if (nextIdx < QUESTIONS_DATA.length) {
                        setCurrentQuestionIndex(nextIdx);
                        setCurrentQuestionData(QUESTIONS_DATA[nextIdx]);
                        setIsAnswerChecked(false);
                        setSelectedOption(null);
                    } else {
                        finish();
                    }
                } else {
                    // ä¸»ç·šæ¨¡å¼ç›´æ¥ä¸‹ä¸€é¡Œ
                    const nextIdx = currentQuestionIndex + 1;
                    if (nextIdx < QUESTIONS_DATA.length) {
                        setCurrentQuestionIndex(nextIdx);
                        setCurrentQuestionData(QUESTIONS_DATA[nextIdx]);
                        setIsAnswerChecked(false);
                        setSelectedOption(null);
                    } else {
                        finish();
                    }
                }
            };

            const finish = async () => {
                setAppState('result');
                if (user && db) {
                    try {
                        await addDoc(collection(db, 'class_scores'), {
                            studentName,
                            score,
                            timestamp: serverTimestamp(),
                            topic: 'å¹³è¡¡åŠ›æ¸¬é©—'
                        });
                    } catch (e) {
                        console.error("ä¸Šå‚³åˆ†æ•¸å¤±æ•—", e);
                    }
                }
            }

            if (loading) return <div className="flex h-screen items-center justify-center text-blue-600 font-bold">è¼‰å…¥ä¸­...</div>;

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex justify-center p-4">
                    <div className="w-full max-w-2xl">
                        
                        <header className="mb-6 text-center mt-8">
                            <h1 className="text-3xl font-bold text-slate-900">S.2 ç§‘å­¸æ¸¬é©—</h1>
                            <p className="text-slate-500">å–®å…ƒ 11.3 å¹³è¡¡åŠ›èˆ‡é‹å‹•</p>
                        </header>

                        {errorMsg && (
                            <div className="mb-4 p-4 bg-red-100 text-red-700 rounded-lg text-sm font-bold text-center">
                                {errorMsg}
                            </div>
                        )}

                        <div className="overflow-hidden rounded-2xl bg-white shadow-xl ring-1 ring-slate-900/5">
                            {appState === 'login' && (
                                <div className="p-8 space-y-6">
                                    <div className="text-center">
                                        <div className="mx-auto mb-4 w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                                            <Icons.Atom />
                                        </div>
                                        <h2 className="text-xl font-semibold">æ­¡è¿æŒ‘æˆ°</h2>
                                        <p className="text-slate-500">è¼¸å…¥åå­—é–‹å§‹</p>
                                    </div>
                                    <input 
                                        type="text" 
                                        className="w-full border rounded-lg p-3" 
                                        placeholder="å­¸ç”Ÿå§“å" 
                                        value={studentName} 
                                        onChange={e => setStudentName(e.target.value)}
                                    />
                                    <button 
                                        onClick={startQuiz}
                                        className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-bold"
                                    >
                                        é–‹å§‹æ¸¬é©—
                                    </button>
                                    <button onClick={() => setAppState('leaderboard')} className="w-full text-sm text-slate-500 hover:text-blue-600">
                                        æŸ¥çœ‹æ’è¡Œæ¦œ
                                    </button>
                                </div>
                            )}

                            {appState === 'quiz' && (
                                <div className="p-8">
                                    {/* é ‚éƒ¨è³‡è¨Šåˆ— */}
                                    <div className="flex justify-between mb-6 text-sm font-bold">
                                        <span className={practiceMode ? "text-purple-600" : "text-slate-500"}>
                                            {practiceMode ? "ğŸ“ ç·´ç¿’é¡ä¼¼é¡Œ (ä¸è¨ˆåˆ†)" : `ç¬¬ ${currentQuestionIndex + 1} / ${QUESTIONS_DATA.length} é¡Œ`}
                                        </span>
                                        <span className="text-blue-600 bg-blue-50 px-3 py-1 rounded-full">å¾—åˆ†: {score}</span>
                                    </div>

                                    {/* æ™ºæ…§åœ–ç‰‡å€ */}
                                    <SmartImage question={currentQuestionData} apiKey={GEMINI_API_KEY} />

                                    {/* é¡Œç›® */}
                                    <h2 className="text-xl font-bold mb-6 leading-relaxed">
                                        {currentQuestionData.question}
                                    </h2>

                                    {/* é¸é … */}
                                    <div className="space-y-3">
                                        {currentQuestionData.options.map(opt => {
                                            let bg = "bg-white hover:bg-slate-50 border-slate-200";
                                            if (isAnswerChecked) {
                                                if (opt.startsWith(currentQuestionData.correctAnswer.charAt(0))) {
                                                    bg = "bg-green-100 border-green-500 text-green-800 ring-1 ring-green-500";
                                                } else if (opt === selectedOption) {
                                                    bg = "bg-red-50 border-red-300 text-red-800";
                                                } else {
                                                    bg = "opacity-50 border-slate-100";
                                                }
                                            } else if (selectedOption === opt) {
                                                bg = "bg-blue-50 border-blue-500 ring-1 ring-blue-500 text-blue-800";
                                            }
                                            return (
                                                <button 
                                                    key={opt} 
                                                    onClick={() => handleAnswer(opt)} 
                                                    disabled={isAnswerChecked} 
                                                    className={`w-full text-left p-4 border rounded-xl transition-all ${bg}`}
                                                >
                                                    <div className="flex justify-between items-center">
                                                        <span>{opt}</span>
                                                        {isAnswerChecked && opt.startsWith(currentQuestionData.correctAnswer.charAt(0)) && <Icons.Check />}
                                                        {isAnswerChecked && opt === selectedOption && !opt.startsWith(currentQuestionData.correctAnswer.charAt(0)) && <Icons.X />}
                                                    </div>
                                                </button>
                                            )
                                        })}
                                    </div>

                                    {/* è§£èªªèˆ‡æŒ‰éˆ•å€ */}
                                    <div className="mt-8">
                                        {!isAnswerChecked ? (
                                            <button 
                                                onClick={check} 
                                                disabled={!selectedOption} 
                                                className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold disabled:opacity-50 hover:bg-slate-800 transition"
                                            >
                                                é€å‡ºç­”æ¡ˆ
                                            </button>
                                        ) : (
                                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                                                {/* è§£èªªå¡ç‰‡ */}
                                                <div className={`p-5 rounded-lg mb-4 border ${selectedOption === currentQuestionData.correctAnswer ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                                                    <h3 className={`font-bold mb-2 flex items-center gap-2 ${selectedOption === currentQuestionData.correctAnswer ? 'text-green-800' : 'text-red-800'}`}>
                                                        {selectedOption === currentQuestionData.correctAnswer ? 'ğŸ‰ ç­”å°äº†ï¼' : 'ğŸ’ª åŠ æ²¹ï¼Œå†æ¥å†å²ï¼'}
                                                    </h3>
                                                    <p className="text-sm text-slate-700 leading-relaxed">
                                                        <span className="font-bold">è§£æï¼š</span>{currentQuestionData.explanation}
                                                    </p>
                                                </div>

                                                {/* æŒ‰éˆ•é‚è¼¯ï¼šç­”éŒ¯ä¸”ä¸åœ¨ç·´ç¿’æ¨¡å¼ -> é¡¯ç¤ºé¡ä¼¼é¡ŒæŒ‰éˆ• */}
                                                {selectedOption !== currentQuestionData.correctAnswer && !practiceMode ? (
                                                    <div className="flex gap-3">
                                                        <button onClick={startPractice} className="flex-1 bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 shadow-lg shadow-purple-200 transition transform active:scale-95">
                                                            ğŸ“ ç·´ç¿’é¡ä¼¼é¡Œ (ä¸è¨ˆåˆ†)
                                                        </button>
                                                        <button onClick={next} className="px-6 py-3 border border-slate-300 rounded-lg font-bold text-slate-500 hover:bg-slate-50">
                                                            ä¸‹ä¸€é¡Œ &rarr;
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <button onClick={next} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition transform active:scale-95">
                                                        {currentQuestionIndex < QUESTIONS_DATA.length - 1 || practiceMode ? 'ä¸‹ä¸€é¡Œ &rarr;' : 'æŸ¥çœ‹æˆç¸¾ ğŸ†'}
                                                    </button>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {appState === 'result' && (
                                <div className="p-8 text-center">
                                    <div className="mx-auto w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-500 mb-6">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                                    </div>
                                    <h2 className="text-2xl font-bold text-slate-900">æ¸¬é©—çµæŸï¼</h2>
                                    <p className="mt-2 text-slate-600">{studentName}ï¼Œä½ çš„åˆ†æ•¸æ˜¯</p>
                                    <div className="text-6xl font-black text-blue-600 my-6">{score} <span className="text-2xl text-slate-300 font-medium">/ 100</span></div>
                                    <div className="space-y-3">
                                        <button onClick={() => setAppState('leaderboard')} className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold hover:bg-slate-800">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
                                        <button onClick={() => setAppState('login')} className="w-full border py-3 rounded-lg font-bold hover:bg-slate-50 text-slate-600">å›é¦–é </button>
                                    </div>
                                </div>
                            )}

                            {appState === 'leaderboard' && (
                                <div className="flex flex-col h-[500px]">
                                    <div className="p-4 border-b bg-slate-50 flex justify-between items-center">
                                        <h3 className="font-bold flex gap-2 text-slate-800">ğŸ† æ’è¡Œæ¦œ</h3>
                                        <button onClick={() => setAppState('login')} className="text-sm text-blue-600 font-bold hover:underline">é—œé–‰</button>
                                    </div>
                                    <div className="flex-1 overflow-y-auto">
                                        <table className="w-full text-left text-sm">
                                            <thead className="bg-slate-50 text-slate-500 sticky top-0">
                                                <tr><th className="p-4">æ’å</th><th className="p-4">å§“å</th><th className="p-4 text-right">å¾—åˆ†</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {leaderboard.map((r, i) => (
                                                    <tr key={r.id} className={i < 3 ? 'bg-yellow-50/50' : ''}>
                                                        <td className="p-4 font-bold text-slate-500">
                                                            {i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `#${i+1}`}
                                                        </td>
                                                        <td className="p-4 font-medium text-slate-900">
                                                            {r.studentName} 
                                                            <span className="text-xs text-slate-400 block">{r.topic}</span>
                                                        </td>
                                                        <td className="p-4 text-right font-bold text-blue-600">{r.score}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}
                        </div>
                        <div className="text-center mt-6 text-xs text-slate-400">
                            Power by React & Firebase | S.2 Science
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
