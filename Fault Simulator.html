<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Safety Lab V6: Bilingual & Visual Fix</title>
<style>
    body {
        font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 5px;
        margin: 0;
        overflow: hidden;
        user-select: none;
        touch-action: none;
    }
    .container { max-width: 850px; margin: 0 auto; padding: 5px; }

    h2 { color: #f1c40f; margin: 5px 0; font-size: 1.4rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    .subtitle { color: #bdc3c7; font-size: 0.9rem; margin-bottom: 10px; }

    /* Controls */
    .controls {
        display: flex; justify-content: center; align-items: center; gap: 10px;
        margin-bottom: 10px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 15px;
    }
    .toggle-btn {
        padding: 8px 12px; border: 2px solid #7f8c8d; background: rgba(255,255,255,0.1);
        color: #bdc3c7; border-radius: 20px; cursor: pointer; font-weight: bold;
        transition: 0.2s; display: flex; align-items: center; gap: 5px; font-size: 0.85rem;
        flex-direction: column; line-height: 1.2;
    }
    .toggle-btn span { font-size: 1.2rem; }
    .toggle-btn.active {
        background: #2ecc71; border-color: #2ecc71; color: white;
        box-shadow: 0 0 10px rgba(46, 204, 113, 0.4);
    }
    
    .big-red-btn {
        background: linear-gradient(to bottom, #e74c3c, #c0392b); color: white; border: none;
        padding: 10px 20px; font-size: 0.9rem; font-weight: bold; border-radius: 30px;
        cursor: pointer; box-shadow: 0 5px 0 #922b21, 0 10px 20px rgba(0,0,0,0.4);
        animation: pulseBtn 2s infinite; white-space: pre-line; line-height: 1.2;
    }
    .big-red-btn:active { transform: scale(0.95) translateY(5px); box-shadow: 0 0 0 #922b21; }
    .big-red-btn:disabled { background: #555; cursor: not-allowed; animation: none; box-shadow: none; color: #888; }
    @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    /* Sim Box */
    .sim-box {
        position: relative; background: #ecf0f1; border-radius: 15px; height: 380px;
        border: 4px solid #bdc3c7; box-shadow: inset 0 0 30px rgba(0,0,0,0.1); overflow: hidden;
    }
    svg { width: 100%; height: 100%; display: block; overflow: visible; }

    /* Wiring */
    .wire { fill: none; stroke-width: 5; stroke-linecap: round; stroke-linejoin: round; transition: stroke 0.3s; }
    .wire-brown { stroke: #a0522d; }
    .wire-blue { stroke: #2980b9; }
    .wire-earth { stroke: #27ae60; stroke-dasharray: 8,4; opacity: 0.3; }
    .wire-earth.connected { opacity: 1; }
    
    /* The wire that replaces the fuse */
    .wire-no-fuse { stroke: #a0522d; display: none; } 

    .loose-wire { 
        stroke: #a0522d; stroke-width: 5; fill: none; stroke-linecap: round; 
        transition: d 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }

    /* Toaster */
    .toaster-body { fill: #95a5a6; stroke: #7f8c8d; stroke-width: 3; transition: fill 0.3s, stroke 0.3s; }
    .toaster-element { fill: none; stroke: #555; stroke-width: 4; transition: stroke 0.5s; }
    .toaster-element.heating { stroke: #e67e22; filter: drop-shadow(0 0 5px orange); }

    /* Animations */
    .current-path { fill: none; stroke: #f1c40f; stroke-width: 4; stroke-dasharray: 10, 10; opacity: 0; pointer-events: none; }
    .flowing { opacity: 1; animation: flowAnim 0.3s linear infinite; filter: drop-shadow(0 0 5px #f1c40f); }
    @keyframes flowAnim { to { stroke-dashoffset: -20; } }

    /* Fire */
    .fire-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    .flame { position: absolute; font-size: 24px; animation: flameFlicker 0.4s infinite alternate; }
    @keyframes flameFlicker { from { transform: scale(1) rotate(-10deg); } to { transform: scale(1.4) rotate(10deg); } }

    /* Slow Mo Fuse Overlay */
    #fuse-replay {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
        width: 320px; height: 200px; background: rgba(0,0,0,0.9); border: 2px solid #fff;
        border-radius: 10px; z-index: 100; display: flex; flex-direction: column;
        align-items: center; justify-content: center; transition: transform 0.3s; pointer-events: none;
    }
    #fuse-replay.active { transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
    .replay-label { color: #e74c3c; font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; text-transform: uppercase; animation: blink 1s infinite; text-align: center; line-height: 1.4; }
    @keyframes blink { 50% { opacity: 0; } }
    
    .fuse-macro { width: 200px; height: 80px; overflow: visible; }
    .macro-glass { fill: rgba(255,255,255,0.1); stroke: #fff; stroke-width: 2; }
    .macro-wire { stroke: #c0392b; stroke-width: 6; stroke-linecap: round; }
    
    .melting { animation: meltSequence 2s forwards linear; }
    @keyframes meltSequence {
        0% { stroke: #c0392b; stroke-width: 6; opacity: 1; }
        30% { stroke: #e67e22; stroke-width: 7; filter: drop-shadow(0 0 5px orange); }
        60% { stroke: #fff; stroke-width: 8; filter: drop-shadow(0 0 10px white); }
        65% { stroke-dasharray: 200; stroke-dashoffset: 0; }
        70% { stroke-dashoffset: 200; stroke: #333; opacity: 0; filter: none; }
        100% { stroke: #333; opacity: 0; }
    }

    /* Status Bar */
    #status-msg {
        position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 25px;
        font-weight: bold; font-size: 0.95rem; width: 90%; pointer-events: none; z-index: 20; 
        transition: background 0.3s; white-space: pre-wrap; line-height: 1.3;
    }

    /* Draggable Human */
    #draggie {
        position: absolute; top: 180px; left: 350px; width: 80px; height: 120px; cursor: grab; z-index: 10;
    }
    #draggie:active { cursor: grabbing; transform: scale(1.05); }

    .reset-btn { margin-top: 15px; padding: 8px 30px; background: #95a5a6; border: none; color: white; border-radius: 20px; cursor: pointer; font-size: 1rem; font-weight:bold; }
</style>
</head>
<body>

<div class="container">
    <h2>‚ö° Safety Lab V6: Bilingual (‰∏≠Ëã±Â∞çÁÖß)</h2>
    <p class="subtitle">Try "No Earth" or "No Fuse" to see what happens!<br>ÂòóË©¶„ÄåÁÑ°Âú∞Á∑ö„ÄçÊàñ„ÄåÁÑ°‰øùÈö™Áµ≤„Äç‰æÜÁúãÁúãÊúÉÁôºÁîü‰ªÄÈ∫ºÔºÅ</p>

    <div class="controls">
        <button class="toggle-btn active" id="btn-earth" onclick="toggleOption('earth')">
            <span>‚úÖ</span> 
            <div>Earth<br>Âú∞Á∑ö</div>
        </button>
        <button class="toggle-btn active" id="btn-fuse" onclick="toggleOption('fuse')">
            <span>‚úÖ</span>
            <div>Fuse<br>‰øùÈö™Áµ≤</div>
        </button>
        <button class="big-red-btn" id="btn-fault" onclick="startSequence()">
            üí• CREATE FAULT<br>Ë£ΩÈÄ†ÊºèÈõª
        </button>
    </div>

    <div class="sim-box">
        <svg viewBox="0 0 650 380" id="main-svg">
            <g transform="translate(20, 100)">
                <rect x="0" y="0" width="60" height="80" rx="5" class="socket-face" />
                <circle cx="30" cy="25" r="4" fill="#333" />
                <circle cx="15" cy="55" r="4" fill="#333" />
                <circle cx="45" cy="55" r="4" fill="#333" />
                <text x="30" y="75" text-anchor="middle" font-size="10" fill="#999">220V</text>
            </g>

            <path d="M 50 115 C 80 115, 80 50, 250 50 L 250 130" class="wire wire-earth connected" id="wire-E" />
            <path d="M 35 152 C 35 180, 80 280, 300 280 L 300 250" class="wire wire-blue" />
            
            <path d="M 65 152 C 80 180, 100 80, 150 80" class="wire wire-brown" id="wire-L-part1" />
            
            <g transform="translate(150, 70)" id="fuse-group">
                <rect x="0" y="0" width="50" height="20" rx="3" class="fuse-body" fill="#fff" stroke="#c0392b" stroke-width="2"/>
                <line x1="5" y1="10" x2="45" y2="10" class="fuse-wire" id="fuse-wire-vis" />
                <text x="25" y="14" text-anchor="middle" font-size="10" fill="#c0392b" font-weight="bold">FUSE</text>
            </g>

            <line x1="150" y1="80" x2="200" y2="80" class="wire wire-no-fuse" id="wire-no-fuse" stroke-width="5" />

            <circle cx="200" cy="80" r="4" fill="#a0522d" />
            <path d="M 200 80 Q 210 80, 240 150" class="loose-wire" id="wire-L-loose" />

            <g id="toaster-group" transform="translate(220, 130)">
                <rect x="0" y="0" width="160" height="120" rx="10" class="toaster-body" id="toaster-case" />
                <path d="M 20 20 L 140 20 L 140 100 L 20 100" class="toaster-element heating" id="heating-elem" />
                <text x="80" y="60" text-anchor="middle" fill="#bdc3c7" font-weight="bold" font-size="14" style="pointer-events:none">TOASTER</text>
            </g>

            <path d="M 65 152 C 80 180, 100 80, 150 80 H 200 L 220 135 L 250 130 L 250 50 C 80 50, 80 115, 50 115" class="current-path" id="path-earth" />
            <path d="" class="current-path" id="path-shock" />
        </svg>
        
        <div class="fire-container" id="fire-overlay"></div>

        <div id="fuse-replay">
            <div class="replay-label">‚ö†Ô∏è FUSE CAM (SLOW MO)<br>‰øùÈö™Áµ≤ÁâπÂØ´ (ÊÖ¢Âãï‰Ωú)</div>
            <svg class="fuse-macro" viewBox="0 0 100 40">
                <rect x="10" y="5" width="80" height="30" rx="2" class="macro-glass" />
                <rect x="5" y="5" width="10" height="30" fill="#bdc3c7" />
                <rect x="85" y="5" width="10" height="30" fill="#bdc3c7" />
                <line x1="15" y1="20" x2="85" y2="20" class="macro-wire" id="macro-wire-anim" />
            </svg>
        </div>

        <div id="draggie">
            <svg viewBox="0 0 100 150" style="width:100%; height:100%; filter:drop-shadow(0 5px 5px rgba(0,0,0,0.3));">
                <line x1="50" y1="100" x2="30" y2="150" stroke="#3498db" stroke-width="8" stroke-linecap="round"/>
                <line x1="50" y1="100" x2="70" y2="150" stroke="#3498db" stroke-width="8" stroke-linecap="round"/>
                <line x1="50" y1="40" x2="50" y2="100" stroke="#3498db" stroke-width="20" stroke-linecap="round"/>
                <line x1="50" y1="50" x2="10" y2="80" stroke="#3498db" stroke-width="8" stroke-linecap="round" id="arm-normal"/> 
                <line x1="50" y1="50" x2="0" y2="50" stroke="#3498db" stroke-width="8" stroke-linecap="round" id="arm-touch" style="display:none"/>
                <circle cx="50" cy="30" r="20" fill="#ffccbc" stroke="#e64a19" stroke-width="2"/>
                <g id="face-normal">
                    <circle cx="45" cy="25" r="2" fill="#333"/> <circle cx="55" cy="25" r="2" fill="#333"/>
                    <path d="M 45 35 Q 50 40 55 35" stroke="#333" stroke-width="2" fill="none"/>
                </g>
                <g id="face-shock" style="display:none">
                    <circle cx="45" cy="25" r="4" fill="#fff"/><circle cx="45" cy="25" r="1" fill="#000"/>
                    <circle cx="55" cy="25" r="4" fill="#fff"/><circle cx="55" cy="25" r="1" fill="#000"/>
                    <ellipse cx="50" cy="40" rx="6" ry="8" fill="#333"/>
                    <path d="M 20 10 L 10 20 M 80 10 L 90 20" stroke="#f1c40f" stroke-width="3"/>
                </g>
            </svg>
        </div>

        <div id="status-msg">System Normal. Heating element is ON.<br>Á≥ªÁµ±Ê≠£Â∏∏„ÄÇÁôºÁÜ±Á∑öÈÅã‰Ωú‰∏≠„ÄÇ</div>
    </div>
    
    <button class="reset-btn" onclick="resetSim()">Reset Simulation (ÈáçÁΩÆ)</button>
</div>

<script>
    // State
    let config = { earth: true, fuse: true };
    let status = { faulty: false, fuseBlown: false };
    
    // DOM
    const el = (id) => document.getElementById(id);
    const wireLoose = el('wire-L-loose');
    const toasterGroup = el('toaster-group');
    const heatingElem = el('heating-elem');
    const toasterCase = el('toaster-case');
    const pathEarth = el('path-earth');
    const pathShock = el('path-shock');
    const msg = el('status-msg');
    const fireOverlay = el('fire-overlay');
    const fuseReplay = el('fuse-replay');
    const macroWire = el('macro-wire-anim');
    const draggie = el('draggie');
    const btnFault = el('btn-fault');
    const fuseGroup = el('fuse-group');
    const wireNoFuse = el('wire-no-fuse');

    // Drag Logic
    let isDragging = false, dragOffset = {x:0, y:0};
    const startDrag = (e) => {
        isDragging = true;
        const cX = e.touches?e.touches[0].clientX:e.clientX;
        const cY = e.touches?e.touches[0].clientY:e.clientY;
        const r = draggie.getBoundingClientRect();
        dragOffset.x = cX - r.left; dragOffset.y = cY - r.top;
        draggie.style.cursor = 'grabbing';
    }
    const doDrag = (e) => {
        if(!isDragging) return;
        e.preventDefault();
        const cX = e.touches?e.touches[0].clientX:e.clientX;
        const cY = e.touches?e.touches[0].clientY:e.clientY;
        const box = document.querySelector('.sim-box').getBoundingClientRect();
        let nx = cX - box.left - dragOffset.x;
        let ny = cY - box.top - dragOffset.y;
        if(nx<0) nx=0; if(nx>box.width-60) nx=box.width-60;
        if(ny<0) ny=0; if(ny>box.height-100) ny=box.height-100;
        draggie.style.left = nx+'px'; draggie.style.top = ny+'px';
        checkInteraction();
    }
    const endDrag = () => { isDragging=false; draggie.style.cursor='grab'; }
    draggie.addEventListener('mousedown', startDrag); draggie.addEventListener('touchstart', startDrag);
    window.addEventListener('mousemove', doDrag); window.addEventListener('touchmove', doDrag, {passive:false});
    window.addEventListener('mouseup', endDrag); window.addEventListener('touchend', endDrag);

    // --- Main Logic ---

    function toggleOption(type) {
        if (status.faulty) { alert("‚ö†Ô∏è Please Reset first! (Ë´ãÂÖàÈáçÁΩÆÔºÅ)"); return; }
        
        if (type === 'earth') {
            config.earth = !config.earth;
            el('btn-earth').classList.toggle('active');
            el('wire-E').classList.toggle('connected', config.earth);
        }
        if (type === 'fuse') {
            config.fuse = !config.fuse;
            const btn = el('btn-fuse');
            btn.classList.toggle('active');
            
            // Visual Toggle: Group vs Straight Wire
            if (config.fuse) {
                fuseGroup.style.display = 'block';
                wireNoFuse.style.display = 'none';
            } else {
                fuseGroup.style.display = 'none';
                wireNoFuse.style.display = 'block';
            }
        }
    }

    function startSequence() {
        if (status.faulty) return;
        btnFault.disabled = true;
        
        // 1. SHAKE
        msg.innerText = "‚ö†Ô∏è Vibration detected... Screws loosening...\nÈúáÂãïÂÅµÊ∏¨‰∏≠... Ëû∫Áµ≤È¨ÜËÑ´‰∏≠...";
        let startTime = Date.now();
        let duration = 800;
        
        let shakeInt = setInterval(() => {
            let elapsed = Date.now() - startTime;
            if (elapsed > duration) {
                clearInterval(shakeInt);
                toasterGroup.setAttribute('transform', "translate(220, 130)");
                performConnect();
            } else {
                let dx = (Math.random()-0.5)*8;
                let dy = (Math.random()-0.5)*8;
                let rot = (Math.random()-0.5)*4;
                toasterGroup.setAttribute('transform', `translate(${220+dx}, ${130+dy}) rotate(${rot})`);
            }
        }, 30);
    }

    function performConnect() {
        status.faulty = true;
        // 2. SNAP WIRE
        wireLoose.setAttribute('d', "M 200 80 Q 200 100, 220 135"); 
        heatingElem.classList.remove('heating'); 
        
        evaluateCircuit();
    }

    function evaluateCircuit() {
        // 3. EVALUATE LOGIC
        
        // SCENARIO 1: EARTH + FUSE (SAFE)
        if (config.earth && config.fuse) {
            msg.innerText = "Short Circuit! Current -> Earth. Fuse heating up...\nÁü≠Ë∑ØÔºÅÈõªÊµÅÊµÅÂêëÂú∞Á∑ö„ÄÇ‰øùÈö™Áµ≤ÂçáÊ∫´‰∏≠...";
            msg.style.background = "#e67e22";
            pathEarth.classList.add('flowing');
            
            setTimeout(() => { playFuseAnimation(); }, 500);
        }
        
        // SCENARIO 2: EARTH + NO FUSE (FIRE)
        else if (config.earth && !config.fuse) {
            msg.innerText = "üî• FIRE! High Current! No Fuse! \nÁÅ´ÁÅΩÔºÅÈõªÊµÅÈÅéÂ§ß‰ΩÜÊ≤íÊúâ‰øùÈö™Áµ≤ÔºÅ";
            msg.style.background = "#c0392b";
            pathEarth.classList.add('flowing');
            
            // Visuals
            toasterCase.style.stroke = "red";
            el('wire-L-part1').style.stroke = "red";
            wireNoFuse.style.stroke = "red"; // The straight wire glows red
            wireLoose.style.stroke = "red";
            createFire();
        }
        
        // SCENARIO 3: NO EARTH (DANGER)
        else {
            let txt = "‚ö†Ô∏è Case is LIVE (220V). Fuse won't blow (No Path).\nÂ§ñÊÆºÂ∏∂Èõª (220V)„ÄÇ‰øùÈö™Áµ≤‰∏çÊúÉÊñ∑ (ÁÑ°ÈõªÊµÅË∑ØÂæë)„ÄÇ";
            msg.innerText = txt;
            msg.style.background = "#e74c3c";
            toasterCase.style.fill = "#ffcccc";
            toasterCase.style.stroke = "#e74c3c";
        }
        checkInteraction();
    }

    function playFuseAnimation() {
        fuseReplay.classList.add('active');
        macroWire.classList.remove('melting');
        void macroWire.offsetWidth;
        macroWire.classList.add('melting');
        
        setTimeout(() => {
            fuseReplay.classList.remove('active');
            status.fuseBlown = true;
            el('fuse-wire-vis').style.display = 'none';
            pathEarth.classList.remove('flowing');
            toasterCase.style.fill = "#95a5a6";
            msg.innerText = "‚úÖ Fuse Blown. Circuit Broken. SAFE.\n‰øùÈö™Áµ≤ÁÜîÊñ∑„ÄÇÈõªË∑Ø‰∏≠Êñ∑„ÄÇÂÆâÂÖ®„ÄÇ";
            msg.style.background = "#2ecc71";
            checkInteraction();
        }, 2200);
    }

    function createFire() {
        for(let i=0; i<3; i++) {
            const f = document.createElement('div');
            f.className = 'flame'; f.innerText = 'üî•';
            f.style.left = (100 + i*60) + 'px'; f.style.top = '100px';
            fireOverlay.appendChild(f);
        }
    }

    function checkInteraction() {
        const hX = parseInt(draggie.style.left);
        const hY = parseInt(draggie.style.top);
        const isTouching = (hX + 20 > 220 && hX < 380 && hY < 250);
        
        el('arm-normal').style.display = isTouching?'none':'block';
        el('arm-touch').style.display = isTouching?'block':'none';
        
        if (isTouching) {
            if (!status.faulty || status.fuseBlown) {
                // Safe
            } else if (config.earth && !config.fuse) {
                // Fire risk but simplified no shock
            } else {
                applyShock(true, hX, hY);
                return;
            }
        }
        applyShock(false);
    }

    function applyShock(isShocked, hX, hY) {
        const faceNormal = el('face-normal');
        const faceShock = el('face-shock');
        if(isShocked) {
            faceNormal.style.display = 'none';
            faceShock.style.display = 'block';
            msg.innerText = "‚ö° SHOCK! Path: Case -> YOU -> Ground!\nËß∏ÈõªÔºÅË∑ØÂæëÔºöÂ§ñÊÆº -> ‰Ω† -> Âú∞Èù¢ÔºÅ";
            msg.style.background = "#c0392b";
            const d = `M 65 152 C 80 180, 100 80, 150 80 H 200 Q 200 100, 220 135 L ${hX+10} ${hY+50} L ${hX+40} 380`;
            pathShock.setAttribute('d', d);
            pathShock.classList.add('flowing');
        } else {
            faceNormal.style.display = 'block';
            faceShock.style.display = 'none';
            pathShock.classList.remove('flowing');
            if(status.faulty && !status.fuseBlown && !config.earth) {
                msg.innerText = "‚ö†Ô∏è Case is LIVE. Fuse intact. Waiting for touch...\nÂ§ñÊÆºÂ∏∂Èõª„ÄÇ‰øùÈö™Áµ≤ÂÆåÂ•Ω„ÄÇÁ≠âÂæÖËß∏Á¢∞...";
                msg.style.background = "#e74c3c";
            }
        }
    }

    function resetSim() {
        status.faulty = false; status.fuseBlown = false;
        btnFault.disabled = false;
        
        wireLoose.setAttribute('d', "M 200 80 Q 210 80, 240 150");
        heatingElem.classList.add('heating');
        toasterCase.style.fill = "#95a5a6"; toasterCase.style.stroke = "#7f8c8d";
        el('fuse-wire-vis').style.display = 'block';
        el('wire-L-part1').style.stroke = ""; wireLoose.style.stroke = "";
        wireNoFuse.style.stroke = "#a0522d"; // reset color
        fireOverlay.innerHTML = '';
        pathEarth.classList.remove('flowing'); pathShock.classList.remove('flowing');
        msg.innerText = "System Normal. Heating element is ON.\nÁ≥ªÁµ±Ê≠£Â∏∏„ÄÇÁôºÁÜ±Á∑öÈÅã‰Ωú‰∏≠„ÄÇ";
        msg.style.background = "rgba(0,0,0,0.8)";
        checkInteraction();
    }
</script>
</body>
</html>