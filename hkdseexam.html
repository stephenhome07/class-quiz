<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE Physics Trainer (Full Syllabus 2014-2025)</title>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f1f5f9; }
        /* ËºâÂÖ•Áï´Èù¢ */
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* ÊªæÂãïÊ¢ùÁæéÂåñ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    
    <div id="loading-screen">
        <div class="spinner"></div>
        <h2 class="text-slate-600 font-bold">Á≥ªÁµ±ËºâÂÖ•‰∏≠...</h2>
        <p class="text-slate-400 text-sm mt-2">Ê≠£Âú®ÂàùÂßãÂåñÂÖ®Ë™≤Á®ãË≥áÊñôÂ∫´</p>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        // ÁßªÈô§ Loading
        setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 800);

        const { useState, useEffect, useMemo } = React;

        // --- 1. ÂÆåÊï¥Ë™≤Á®ãÂ§ßÁ∂±Êï∏Êìö (SYLLABUS) ---
        // Ê†πÊìö‰Ω†Êèê‰æõÁöÑÊñá‰ª∂ÂÆåÊï¥ÈåÑÂÖ•
        const SYLLABUS_DATA = {
            // Book 1 Heat
            "1.1.1": { book: "Book 1 Heat", topic: "Ê∏©Â∫¶ËàáÊ∏©Â∫¶Ë®à", desc: "ÈáèÂ∫¶Ê∏©Â∫¶" },
            "1.1.2": { book: "Book 1 Heat", topic: "Ê∏©Â∫¶ËàáÊ∏©Â∫¶Ë®à", desc: "ÊîùÊ∞èÊ∏©Ê®ô" },
            "1.2.1": { book: "Book 1 Heat", topic: "ÂÖßËÉΩ„ÄÅÁÜ±ËàáÁÜ±ÂÇ≥ÈÅû", desc: "ÂÖßËÉΩËàáËÉΩÈáèËΩâÁßª" },
            "1.2.2": { book: "Book 1 Heat", topic: "ÂÖßËÉΩ„ÄÅÁÜ±ËàáÁÜ±ÂÇ≥ÈÅû", desc: "ÁÜ±ÂÇ≥ÈÅûÊñπÂºè (ÂÇ≥Â∞é/Â∞çÊµÅ/ËºªÂ∞Ñ)" },
            "1.3.1": { book: "Book 1 Heat", topic: "Ê∏©Â∫¶ËÆäÂåñËàáÁÜ±ÂÆπÈáè", desc: "ÂäüÁéáËàáÈáèÂ∫¶ËΩâÁßªÁöÑËÉΩÈáè" },
            "1.3.2": { book: "Book 1 Heat", topic: "Ê∏©Â∫¶ËÆäÂåñËàáÁÜ±ÂÆπÈáè", desc: "ÁÜ±ÂÆπÈáèÂíåÊØîÁÜ±ÂÆπÈáè" },
            "1.4.1": { book: "Book 1 Heat", topic: "Áâ©ÊÖãÁöÑÊîπËÆä", desc: "ÊΩõÁÜ± (ÁÜîËß£/Ê±ΩÂåñ)" },
            "1.4.2": { book: "Book 1 Heat", topic: "Áâ©ÊÖãÁöÑÊîπËÆä", desc: "Ëí∏ÁôºËàáÂáùÁµê" },
            "1.5.1": { book: "Book 1 Heat", topic: "Ê∞£È´î (Ext)", desc: "Ê∞£È´îÂÆöÂæã (Boyle/Pressure/Charles/Ideal Gas)" },
            "1.5.2": { book: "Book 1 Heat", topic: "Ê∞£È´î (Ext)", desc: "Ê∞£È´îÂàÜÂ≠êÈÅãÂãïË´ñ (Microscopic)" },

            // Book 2 Mechanics
            "2.1.1": { book: "Book 2 Mech", topic: "ÈÅãÂãï", desc: "Èï∑Â∫¶ÂíåÊôÇÈñì" },
            "2.1.2": { book: "Book 2 Mech", topic: "ÈÅãÂãï", desc: "Ë∑ùÈõ¢Âíå‰ΩçÁßª" },
            "2.1.3": { book: "Book 2 Mech", topic: "ÈÅãÂãï", desc: "ÈÄüÁéá„ÄÅÈÄüÂ∫¶ÂíåÂä†ÈÄüÂ∫¶" },
            "2.1.4": { book: "Book 2 Mech", topic: "ÈÅãÂãï", desc: "Ë™§Â∑Æ‰º∞ÁÆó" },
            "2.2.1": { book: "Book 2 Mech", topic: "Áõ¥Á∑öÈÅãÂãï", desc: "ÊèèËø∞Áõ¥Á∑öÈÅãÂãï" },
            "2.2.2": { book: "Book 2 Mech", topic: "Áõ¥Á∑öÈÅãÂãï", desc: "ÈÅãÂãïÁ∑öÂúñ (s-t, v-t, a-t)" },
            "2.2.3": { book: "Book 2 Mech", topic: "Áõ¥Á∑öÈÅãÂãï", desc: "ÂãªÂä†ÈÄüÈÅãÂãïÊñπÁ®ã (Suvat)" },
            "2.2.4": { book: "Book 2 Mech", topic: "Áõ¥Á∑öÈÅãÂãï", desc: "ÈáçÂäõ‰∏ãÁöÑÂûÇÁõ¥ÈÅãÂãï" },
            "2.3.1": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "Âäõ (Friction, Free body diagram)" },
            "2.3.2": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "ÁâõÈ†ìÁ¨¨‰∏ÄÂÆöÂæã (Inertia)" },
            "2.3.3": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "ÁâõÈ†ìÁ¨¨‰∫åÂÆöÂæã (F=ma)" },
            "2.3.4": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "ÈáçÈáèËàáË≥™Èáè" },
            "2.3.5": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "ÊµÅÈ´îÈòªÂäõ" },
            "2.3.6": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "Êë©Êì¶Âäõ" },
            "2.3.7": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (I)", desc: "ÁâõÈ†ìÁ¨¨‰∏âÂÆöÂæã (Action/Reaction)" },
            "2.4.1": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (II)", desc: "Áâ©È´îÁµÑÊàêÁöÑÁ≥ªÁµ±" },
            "2.4.2": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (II)", desc: "ÂäõÁöÑÂêàÊàêÂíåÂàÜËß£" },
            "2.4.3": { book: "Book 2 Mech", topic: "ÂäõËàáÈÅãÂãï (II)", desc: "ÂÖ±Èù¢Âäõ" },
            "2.5.1": { book: "Book 2 Mech", topic: "ÂäõÁü©", desc: "ÂäõÁöÑËΩâÂãïÊïàÊáâ (Moment)" },
            "2.5.2": { book: "Book 2 Mech", topic: "ÂäõÁü©", desc: "ÂâõÈ´îÁöÑÂπ≥Ë°° (Equilibrium)" },
            "2.6.1": { book: "Book 2 Mech", topic: "Âäü„ÄÅËÉΩÈáèÂíåÂäüÁéá", desc: "Âäü (Work)" },
            "2.6.2": { book: "Book 2 Mech", topic: "Âäü„ÄÅËÉΩÈáèÂíåÂäüÁéá", desc: "Ê©üÊ¢∞ËÉΩ (KE/PE)" },
            "2.6.3": { book: "Book 2 Mech", topic: "Âäü„ÄÅËÉΩÈáèÂíåÂäüÁéá", desc: "ËÉΩÈáèÂÆàÊÅÜ" },
            "2.6.4": { book: "Book 2 Mech", topic: "Âäü„ÄÅËÉΩÈáèÂíåÂäüÁéá", desc: "ÂäüÁéá (Power)" },
            "2.7.1": { book: "Book 2 Mech", topic: "ÂãïÈáè", desc: "ÂãïÈáèÂÆàÊÅÜ (Collision)" },
            "2.7.2": { book: "Book 2 Mech", topic: "ÂãïÈáè", desc: "ÂãïÈáèËÆäÂåñ (Impulse)" },
            "2.8.1": { book: "Book 2 Mech", topic: "ÊããÈ´îÈÅãÂãï (Ext)", desc: "Ë™çË≠òÊããÈ´îÈÅãÂãï" },
            "2.8.2": { book: "Book 2 Mech", topic: "ÊããÈ´îÈÅãÂãï (Ext)", desc: "ÂàÜÊûêÊããÈ´îÈÅãÂãï" },
            "2.9.1": { book: "Book 2 Mech", topic: "ÂãªÈÄüÂúìÂë®ÈÅãÂãï (Ext)", desc: "ÊèèËø∞ÂúìÂë®ÈÅãÂãï (Angular velocity)" },
            "2.9.2": { book: "Book 2 Mech", topic: "ÂãªÈÄüÂúìÂë®ÈÅãÂãï (Ext)", desc: "ÂêëÂøÉÂäõËàáÂêëÂøÉÂä†ÈÄüÂ∫¶" },
            "2.9.3": { book: "Book 2 Mech", topic: "ÂãªÈÄüÂúìÂë®ÈÅãÂãï (Ext)", desc: "ÂúìÂë®ÈÅãÂãïÁöÑ‰æãÂ≠ê" },
            "2.10.1": { book: "Book 2 Mech", topic: "ÂºïÂäõ (Ext)", desc: "Ëê¨ÊúâÂºïÂäõÂÆöÂæã" },
            "2.10.2": { book: "Book 2 Mech", topic: "ÂºïÂäõ (Ext)", desc: "ÂºïÂäõ‰∏ãÁöÑÂúìÂë®ÈÅãÂãï" },

            // Book 3 Waves
            "3.1.1": { book: "Book 3 Waves", topic: "ÂÖâÁöÑÂèçÂ∞Ñ", desc: "ÂÖâÁ∑ö" },
            "3.1.2": { book: "Book 3 Waves", topic: "ÂÖâÁöÑÂèçÂ∞Ñ", desc: "ÂèçÂ∞ÑËàáÂπ≥Èù¢Èè°" },
            "3.2.1": { book: "Book 3 Waves", topic: "ÂÖâÁöÑÊäòÂ∞Ñ", desc: "ÊäòÂ∞ÑÂÆöÂæã (Snell's Law)" },
            "3.2.2": { book: "Book 3 Waves", topic: "ÂÖâÁöÑÊäòÂ∞Ñ", desc: "ÂÖ®ÂÖßÂèçÂ∞Ñ" },
            "3.3.1": { book: "Book 3 Waves", topic: "ÈÄèÈè°", desc: "Âá∏ÈÄèÈè°ËàáÂáπÈÄèÈè°" },
            "3.3.2": { book: "Book 3 Waves", topic: "ÈÄèÈè°", desc: "Âá∏ÈÄèÈè°ÊàêÂÉè" },
            "3.3.3": { book: "Book 3 Waves", topic: "ÈÄèÈè°", desc: "ÂáπÈÄèÈè°ÊàêÂÉè" },
            "3.3.4": { book: "Book 3 Waves", topic: "ÈÄèÈè°", desc: "ÈÄèÈè°ÂÖ¨Âºè" },
            "3.4.1": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÊú¨Ë≥™", desc: "Ê≥¢ÁöÑÁ∞°‰ªã" },
            "3.4.2": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÊú¨Ë≥™", desc: "Ê©´Ê≥¢ÁöÑÊ≥¢Âãï (v=fŒª)" },
            "3.4.3": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÊú¨Ë≥™", desc: "Ê©´Ê≥¢ÁöÑÁ≤íÂ≠êÊåØÂãï" },
            "3.4.4": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÊú¨Ë≥™", desc: "Ê≥¢ÁöÑÁ∑öÂúñ" },
            "3.5.1": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÁèæË±°", desc: "Ê∞¥Ê≥¢ÊßΩ" },
            "3.5.2": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÁèæË±°", desc: "ÂèçÂ∞ÑËàáÊäòÂ∞Ñ" },
            "3.5.3": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÁèæË±°", desc: "Ë°çÂ∞ÑËàáÂπ≤Ê∂â" },
            "3.5.4": { book: "Book 3 Waves", topic: "Ê≥¢ÁöÑÁèæË±°", desc: "ÈßêÊ≥¢ (Stationary Waves)" },
            "3.6.1": { book: "Book 3 Waves", topic: "ÂÖâËàáÈõªÁ£ÅÊ≥¢", desc: "ÂÖâÁöÑÊ≥¢ÂãïÊú¨Ë≥™" },
            "3.6.2": { book: "Book 3 Waves", topic: "ÂÖâËàáÈõªÁ£ÅÊ≥¢", desc: "Ê•äÊ∞èÈõôÁ∏´ÂØ¶È©ó" },
            "3.6.3": { book: "Book 3 Waves", topic: "ÂÖâËàáÈõªÁ£ÅÊ≥¢", desc: "Âπ≥Èù¢ÈÄèÂ∞ÑÂÖâÊüµ" },
            "3.6.4": { book: "Book 3 Waves", topic: "ÂÖâËàáÈõªÁ£ÅÊ≥¢", desc: "ÈõªÁ£ÅÊ≥¢Ë≠ú" },
            "3.7.1": { book: "Book 3 Waves", topic: "ËÅ≤Èü≥", desc: "Á∏±Ê≥¢" },
            "3.7.2": { book: "Book 3 Waves", topic: "ËÅ≤Èü≥", desc: "ËÅ≤Èü≥ÁöÑÊú¨Ë≥™" },
            "3.7.3": { book: "Book 3 Waves", topic: "ËÅ≤Èü≥", desc: "ËÅ≤Èü≥ÁöÑÁâπÊÄß (Ë∂ÖËÅ≤Ê≥¢/ÂàÜË≤ù)" },

            // Book 4 Electricity
            "4.1.1": { book: "Book 4 Elec", topic: "ÈùúÈõªÂ≠∏", desc: "ÈõªËç∑" },
            "4.1.2": { book: "Book 4 Elec", topic: "ÈùúÈõªÂ≠∏", desc: "ÈùúÈõªÂäõ (Coulomb's Law)" },
            "4.1.3": { book: "Book 4 Elec", topic: "ÈùúÈõªÂ≠∏", desc: "ÈõªÂ†¥ (Electric Field)" },
            "4.2.1": { book: "Book 4 Elec", topic: "ÈõªË∑Ø", desc: "ÈõªÊµÅ" },
            "4.2.2": { book: "Book 4 Elec", topic: "ÈõªË∑Ø", desc: "ÈõªÂ£ì (EMF/PD)" },
            "4.2.3": { book: "Book 4 Elec", topic: "ÈõªË∑Ø", desc: "ÈõªÈòª (Resistivity)" },
            "4.2.4": { book: "Book 4 Elec", topic: "ÈõªË∑Ø", desc: "ÈõªÈòªÂô®Á∂≤Áµ° (Series/Parallel)" },
            "4.2.5": { book: "Book 4 Elec", topic: "ÈõªË∑Ø", desc: "ÈõªÂäüÁéá (P=VI)" },
            "4.3.1": { book: "Book 4 Elec", topic: "ÂØ¶ÈöõÈõªË∑Ø", desc: "ÂàÜÊûêÈõªË∑Ø (Circuit Analysis)" },
            "4.3.2": { book: "Book 4 Elec", topic: "ÂØ¶ÈöõÈõªË∑Ø", desc: "ÂØ¶ÈöõÂÑÄË°®ËàáÂÖßÈõªÈòª" },
            "4.4.1": { book: "Book 4 Elec", topic: "ÂÆ∂Â±ÖÈõªÂ≠∏", desc: "ÂäüÁéáÂíåËÉΩÈáèÊ∂àËÄó (kW h)" },
            "4.4.2": { book: "Book 4 Elec", topic: "ÂÆ∂Â±ÖÈõªÂ≠∏", desc: "ÈõªÁ∑ö‰ΩàÁΩÆÂèäÂÆâÂÖ® (Fuse/Earth)" },
            "4.4.3": { book: "Book 4 Elec", topic: "ÂÆ∂Â±ÖÈõªÂ≠∏", desc: "‰∫§ÊµÅÈõª (AC/RMS) (Ext)" },
            "4.5.1": { book: "Book 4 Elec", topic: "Á£ÅÂ†¥", desc: "Á£ÅÂäõËàáÁ£ÅÂ†¥" },
            "4.5.2": { book: "Book 4 Elec", topic: "Á£ÅÂ†¥", desc: "ÈõªÊµÅÁöÑÁ£ÅÊïàÊáâ (B-field)" },
            "4.6.1": { book: "Book 4 Elec", topic: "Á£ÅÂäõ", desc: "ËºâÊµÅÂ∞éÈ´îÂèóÂäõ (F=BIL)" },
            "4.6.2": { book: "Book 4 Elec", topic: "Á£ÅÂäõ", desc: "Áõ¥ÊµÅÈõªÂãïÊ©ü (Motor)" },
            "4.6.3": { book: "Book 4 Elec", topic: "Á£ÅÂäõ", desc: "Ê¥õÂÄ´Ëå≤Âäõ (F=Bqv)" },
            "4.7.1": { book: "Book 4 Elec", topic: "ÈõªÁ£ÅÊÑüÊáâ", desc: "ÊÑüÁîüÈõªÊµÅ (Lenz's Law)" },
            "4.7.2": { book: "Book 4 Elec", topic: "ÈõªÁ£ÅÊÑüÊáâ", desc: "ÁôºÈõªÊ©üËàáÊ∏¶ÈõªÊµÅ" },
            "4.7.3": { book: "Book 4 Elec", topic: "ÈõªÁ£ÅÊÑüÊáâ", desc: "Ê≥ïÊãâÁ¨¨ÂÆöÂæã (Flux) (Ext)" },
            "4.8.1": { book: "Book 4 Elec", topic: "ËÆäÂ£ìÂô® (Ext)", desc: "ËÆäÂ£ìÂô®ÂéüÁêÜ" },
            "4.8.2": { book: "Book 4 Elec", topic: "ËÆäÂ£ìÂô® (Ext)", desc: "È´òÂ£ìËº∏Èõª" },

            // Book 5 Radioactivity
            "5.1.1": { book: "Book 5 Rad", topic: "ËºªÂ∞Ñ", desc: "XÂ∞ÑÁ∑ö" },
            "5.1.2": { book: "Book 5 Rad", topic: "ËºªÂ∞Ñ", desc: "Ê†∏ËºªÂ∞Ñ (Alpha/Beta/Gamma)" },
            "5.1.3": { book: "Book 5 Rad", topic: "ËºªÂ∞Ñ", desc: "ËºªÂ∞ÑÂÆâÂÖ® (Sievert)" },
            "5.2.1": { book: "Book 5 Rad", topic: "Ë°∞ËÆä", desc: "ÂéüÂ≠êÊ®°Âûã" },
            "5.2.2": { book: "Book 5 Rad", topic: "Ë°∞ËÆä", desc: "ÊîæÂ∞ÑË°∞ËÆä (Half-life)" },
            "5.2.3": { book: "Book 5 Rad", topic: "Ë°∞ËÆä", desc: "Âêå‰ΩçÁ¥†ÊáâÁî®" },
            "5.3.1": { book: "Book 5 Rad", topic: "Ê†∏ËÉΩ", desc: "Ë£ÇËÆäËàáËÅöËÆä" },
            "5.3.2": { book: "Book 5 Rad", topic: "Ê†∏ËÉΩ", desc: "Ë≥™ËÉΩÈóú‰øÇ (E=mc^2)" },
            "5.3.3": { book: "Book 5 Rad", topic: "Ê†∏ËÉΩ", desc: "Ê†∏ËÉΩÁôºÈõª" },
        };

        // Âπ¥‰ªΩÁîüÊàê (2025 - 2014)
        const YEAR_OPTIONS = Array.from({length: 12}, (_, i) => 2025 - i);

        const App = () => {
            // View: students, marking, input, dashboard
            const [view, setView] = useState('students');
            
            // Data State
            const [students, setStudents] = useState([]);
            const [answerKeys, setAnswerKeys] = useState({}); 
            const [records, setRecords] = useState([]);

            // UI State
            const [editingKey, setEditingKey] = useState({ year: 2025, paper: '1A' });
            const [inputForm, setInputForm] = useState({ studentId: '', year: '2025', paper: '1A', answers: {}, scores: {} });
            const [dashTab, setDashTab] = useState('paper'); // 'paper' or 'topic'
            const [dashStudent, setDashStudent] = useState('');

            // Load Data
            useEffect(() => {
                const saved = localStorage.getItem('dsePhysV4');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        setStudents(data.students || []);
                        setAnswerKeys(data.answerKeys || {});
                        setRecords(data.records || []);
                        if(data.students && data.students.length > 0) {
                            setDashStudent(data.students[0].id);
                            setInputForm(f => ({...f, studentId: data.students[0].id}));
                        }
                    } catch(e) { console.error(e); }
                }
            }, []);

            // Save Data
            useEffect(() => {
                const data = { students, answerKeys, records };
                localStorage.setItem('dsePhysV4', JSON.stringify(data));
            }, [students, answerKeys, records]);

            // Helper: Distribute questions to topics blindly (Mock mapping for visualization)
            // Âú®ÁúüÂØ¶ÊÉÖÊ≥Å‰∏ãÔºåÈúÄË¶ÅÊâãÂãïËº∏ÂÖ•ÊØèÂπ¥ÊØèÈ°åÂ∞çÊáâÂì™ÂÄã Topic„ÄÇÈÄôË£°ÁÇ∫‰∫ÜËÆì"Âº±È†ÖÂàÜÊûê"ËÉΩË∑ëÂá∫‰æÜÔºå
            // Êö´ÊôÇ‰ΩøÁî®ÁÆóÊ≥ïÂ∞áÈ°åËôüÂàÜÈÖçÁµ¶ Syllabus ‰∏≠ÁöÑ Topic„ÄÇ
            const getTopicForQuestion = (qNum) => {
                const topicIds = Object.keys(SYLLABUS_DATA);
                // Á∞°ÂñÆÈõúÊπäÂàÜÈÖçÔºåÁ¢∫‰øùÂêå‰∏ÄÈ°åËôüÁ∏ΩÊòØÂ∞çÊáâÂêå‰∏ÄË™≤È°å
                return topicIds[(qNum * 13) % topicIds.length]; 
            };

            // --- Sidebar Component ---
            const Sidebar = () => (
                <div className="w-64 bg-slate-900 text-white h-screen fixed left-0 top-0 flex flex-col shadow-2xl">
                    <div className="p-6 border-b border-slate-700">
                        <h1 className="text-xl font-bold italic tracking-wider">PHY MASTER</h1>
                        <span className="text-xs bg-blue-600 px-2 py-0.5 rounded text-white">Full V4.0</span>
                    </div>
                    <nav className="p-4 space-y-2">
                        {[
                            {id: 'students', icon: 'üë•', label: 'Â≠∏ÁîüÁÆ°ÁêÜ'},
                            {id: 'marking', icon: 'üîë', label: 'Ê®ôÊ∫ñÁ≠îÊ°à (ANS)'},
                            {id: 'input', icon: 'üìù', label: 'Ëº∏ÂÖ•ÊàêÁ∏æ'},
                            {id: 'dashboard', icon: 'üìä', label: 'Â≠∏ÁîüÂàÜÊûê'}
                        ].map(item => (
                            <button key={item.id} onClick={() => setView(item.id)}
                                className={`w-full flex items-center gap-3 px-4 py-3 rounded transition-all ${view===item.id ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <span>{item.icon}</span> {item.label}
                            </button>
                        ))}
                    </nav>
                </div>
            );

            // --- View 1: Student Management ---
            const StudentsView = () => {
                const [name, setName] = useState('');
                const add = () => {
                    if(!name) return;
                    const newS = { id: Date.now().toString(), name, joinDate: new Date().toLocaleDateString() };
                    setStudents([...students, newS]);
                    setName('');
                    if(!dashStudent) setDashStudent(newS.id);
                };
                return (
                    <div className="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6 text-slate-800">üë• Â≠∏ÁîüÊ™îÊ°à</h2>
                        <div className="flex gap-4 mb-8">
                            <input className="flex-1 border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" 
                                placeholder="Ëº∏ÂÖ•Â≠∏ÁîüÂßìÂêç..." value={name} onChange={e=>setName(e.target.value)} />
                            <button onClick={add} className="bg-blue-600 text-white px-8 rounded-lg font-bold hover:bg-blue-700">Êñ∞Â¢û</button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {students.map(s => (
                                <div key={s.id} className="p-4 border border-slate-200 rounded-lg flex justify-between items-center bg-slate-50">
                                    <div>
                                        <div className="font-bold text-lg">{s.name}</div>
                                        <div className="text-xs text-slate-400">{s.joinDate}</div>
                                    </div>
                                    <button onClick={() => {
                                        if(confirm('Âà™Èô§Â≠∏ÁîüÊúÉ‰∏Ä‰ΩµÂà™Èô§ÂÖ∂ÊâÄÊúâÊàêÁ∏æÔºåÁ¢∫ÂÆöÔºü')) {
                                            setStudents(students.filter(x=>x.id!==s.id));
                                            setRecords(records.filter(x=>x.studentId!==s.id));
                                        }
                                    }} className="text-slate-400 hover:text-red-500">üóë</button>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // --- View 2: Marking Scheme (ANS) ---
            const MarkingView = () => {
                const { year, paper } = editingKey;
                const keyId = `${year}_${paper}`;
                const currentKey = answerKeys[keyId] || {};

                const setKey = (q, val) => {
                    setAnswerKeys(prev => ({ ...prev, [keyId]: { ...currentKey, [q]: val } }));
                };

                return (
                    <div className="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <div className="flex justify-between items-end mb-6 border-b pb-4">
                            <h2 className="text-2xl font-bold text-slate-800">üîë Ë®≠ÂÆöÊ®ôÊ∫ñÁ≠îÊ°à (ANS)</h2>
                            <div className="flex gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase">Year</label>
                                    <select className="border p-2 rounded w-32 font-bold" value={year} onChange={e=>setEditingKey({...editingKey, year: e.target.value})}>
                                        {YEAR_OPTIONS.map(y => <option key={y} value={y}>{y}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase">Paper</label>
                                    <select className="border p-2 rounded w-32 font-bold bg-slate-100" disabled value="1A">
                                        <option value="1A">Paper 1A (MC)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-8 gap-3">
                            {Array.from({length: 33}).map((_, i) => {
                                const q = i+1;
                                const ans = currentKey[q];
                                return (
                                    <div key={q} className="p-2 border rounded bg-slate-50 flex flex-col items-center">
                                        <span className="text-xs font-bold text-slate-400 mb-2">Q{q}</span>
                                        <div className="flex gap-1">
                                            {['A','B','C','D'].map(opt => (
                                                <button key={opt} onClick={()=>setKey(q, opt)}
                                                    className={`w-6 h-6 text-xs font-bold rounded ${ans===opt ? 'bg-green-600 text-white' : 'bg-white border text-slate-500 hover:bg-slate-200'}`}>
                                                    {opt}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // --- View 3: Input Score ---
            const InputView = () => {
                const { studentId, year, paper } = inputForm;
                const keyId = `${year}_${paper}`;
                const sysKey = answerKeys[keyId] || {};
                const hasKey = Object.keys(sysKey).length > 0;
                
                // MC Logic
                const toggleMC = (q, opt) => {
                    const newAns = { ...inputForm.answers, [q]: opt };
                    // Auto Grade
                    const isCorrect = sysKey[q] === opt;
                    const newScore = { ...inputForm.scores, [q]: isCorrect ? 1 : 0 };
                    setInputForm({ ...inputForm, answers: newAns, scores: newScore });
                };

                // Save
                const save = () => {
                    if(!studentId) return alert('Ë´ãÈÅ∏ÊìáÂ≠∏Áîü');
                    const newRec = {
                        ...inputForm,
                        id: Date.now(),
                        timestamp: new Date().toISOString()
                    };
                    // Overwrite existing
                    const others = records.filter(r => !(r.studentId===studentId && r.year==year && r.paper===paper));
                    setRecords([...others, newRec]);
                    alert('‚úÖ ÊàêÁ∏æÂ∑≤ÂÑ≤Â≠ò');
                };

                return (
                    <div className="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6 text-slate-800">üìù Ëº∏ÂÖ•Â≠∏ÁîüÊàêÁ∏æ</h2>
                        
                        {/* Selectors */}
                        <div className="grid grid-cols-3 gap-6 mb-8 bg-blue-50 p-6 rounded-lg border border-blue-100">
                            <div>
                                <label className="block text-xs font-bold text-blue-800 mb-1">Â≠∏Áîü</label>
                                <select className="w-full p-2 border rounded" value={studentId} onChange={e=>setInputForm({...inputForm, studentId:e.target.value})}>
                                    <option value="">-- Ë´ãÈÅ∏Êìá --</option>
                                    {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-blue-800 mb-1">Âπ¥‰ªΩ</label>
                                <select className="w-full p-2 border rounded" value={year} onChange={e=>setInputForm({...inputForm, year:e.target.value, answers:{}, scores:{}})}>
                                    {YEAR_OPTIONS.map(y => <option key={y} value={y}>{y}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-blue-800 mb-1">Ë©¶Âç∑</label>
                                <select className="w-full p-2 border rounded" value={paper} onChange={e=>setInputForm({...inputForm, paper:e.target.value, answers:{}, scores:{}})}>
                                    <option value="1A">Paper 1A (MC)</option>
                                    <option value="1B">Paper 1B</option>
                                </select>
                            </div>
                        </div>

                        {paper === '1A' ? (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-slate-600">MC Á≠îÈ°åÂç°</h3>
                                    {hasKey ? 
                                        <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">‚óè Â∑≤ËºâÂÖ•Á≠îÊ°àÔºåËá™ÂãïË©ïÂàÜ‰∏≠</span> : 
                                        <span className="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">‚ö† Áº∫Â∞ëÂπ¥‰ªΩÁ≠îÊ°àÔºåÁÑ°Ê≥ïËá™ÂãïË©ïÂàÜ</span>
                                    }
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                    {Array.from({length: 33}).map((_,i) => {
                                        const q = i+1;
                                        const myAns = inputForm.answers[q];
                                        const realAns = sysKey[q];
                                        // Color logic
                                        let boxClass = "border-slate-200 bg-white";
                                        if(myAns && realAns) {
                                            boxClass = myAns === realAns ? "border-green-500 bg-green-50" : "border-red-500 bg-red-50";
                                        }

                                        return (
                                            <div key={q} className={`p-2 border rounded flex justify-between items-center ${boxClass}`}>
                                                <span className="font-mono font-bold text-slate-400 w-6">Q{q}</span>
                                                <div className="flex gap-1">
                                                    {['A','B','C','D'].map(opt => (
                                                        <button key={opt} onClick={()=>toggleMC(q, opt)}
                                                            className={`w-7 h-7 rounded text-xs font-bold transition-all
                                                                ${myAns===opt ? 'bg-slate-800 text-white scale-110' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}
                                                            `}>
                                                            {opt}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div>
                                <h3 className="font-bold text-slate-600 mb-4">Èï∑È°åÁõÆÂàÜÊï∏ (Paper 1B/2)</h3>
                                <div className="grid grid-cols-4 md:grid-cols-6 gap-4">
                                    {Array.from({length: 15}).map((_,i) => (
                                        <div key={i} className="flex flex-col">
                                            <span className="text-xs text-slate-500 mb-1">Q{i+1}</span>
                                            <input type="number" className="border p-2 rounded text-center"
                                                value={inputForm.scores[i+1]||''}
                                                onChange={e=>setInputForm({...inputForm, scores:{...inputForm.scores, [i+1]:e.target.value}})}
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="mt-8 pt-6 border-t">
                            <button onClick={save} className="w-full bg-slate-800 text-white py-4 rounded-lg font-bold text-lg hover:bg-slate-700 shadow-lg">
                                üíæ ÂÑ≤Â≠òÊàêÁ∏æË®òÈåÑ
                            </button>
                        </div>
                    </div>
                );
            };

            // --- View 4: Dashboard ---
            const DashboardView = () => {
                // Analysis A: Paper Performance
                const paperStats = useMemo(() => {
                    if(!dashStudent) return [];
                    const myRecs = records.filter(r => r.studentId === dashStudent);
                    // Group by Year+Paper
                    const grouped = {};
                    myRecs.forEach(r => {
                        const id = `${r.year} ${r.paper}`;
                        const total = Object.values(r.scores).reduce((a,b) => Number(a)+Number(b), 0);
                        const max = r.paper === '1A' ? 33 : 80; // MC max 33, LQ approx
                        grouped[id] = { year: r.year, paper: r.paper, score: total, max };
                    });
                    return Object.values(grouped).sort((a,b) => b.year - a.year);
                }, [records, dashStudent]);

                // Analysis B: Topic Weakness
                const topicStats = useMemo(() => {
                    if(!dashStudent) return [];
                    const myRecs = records.filter(r => r.studentId === dashStudent);
                    const tMap = {}; // { topicId: { correct, total } }

                    myRecs.forEach(r => {
                        Object.entries(r.scores).forEach(([q, score]) => {
                            const tid = getTopicForQuestion(q); // Mapping Question to Topic
                            if(!SYLLABUS_DATA[tid]) return;
                            
                            if(!tMap[tid]) tMap[tid] = { score: 0, max: 0 };
                            tMap[tid].score += Number(score);
                            tMap[tid].max += (r.paper==='1A' ? 1 : 10); // Weighting
                        });
                    });

                    return Object.entries(tMap).map(([id, stat]) => ({
                        id,
                        ...SYLLABUS_DATA[id],
                        pct: (stat.score/stat.max)*100
                    })).sort((a,b) => a.pct - b.pct); // Lowest first
                }, [records, dashStudent]);

                return (
                    <div className="max-w-6xl mx-auto space-y-6">
                        {/* Header Controls */}
                        <div className="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center">
                            <h2 className="text-xl font-bold flex items-center gap-2">üìä Â≠∏ÁøíË®∫Êñ∑Â†±Âëä</h2>
                            <div className="flex gap-4">
                                <select className="border p-2 rounded" value={dashStudent} onChange={e=>setDashStudent(e.target.value)}>
                                    {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                                <div className="bg-slate-100 p-1 rounded flex">
                                    <button onClick={()=>setDashTab('paper')} className={`px-4 py-1 rounded text-sm font-bold ${dashTab==='paper'?'bg-white shadow text-blue-600':''}`}>ÊåâË©¶Âç∑ (Paper)</button>
                                    <button onClick={()=>setDashTab('topic')} className={`px-4 py-1 rounded text-sm font-bold ${dashTab==='topic'?'bg-white shadow text-blue-600':''}`}>ÊåâË™≤È°å (Weakness)</button>
                                </div>
                            </div>
                        </div>

                        {/* Content */}
                        {dashTab === 'paper' ? (
                            <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                                <table className="w-full text-left">
                                    <thead className="bg-slate-50 border-b">
                                        <tr>
                                            <th className="p-4 text-slate-500 font-bold text-sm">Âπ¥‰ªΩ</th>
                                            <th className="p-4 text-slate-500 font-bold text-sm">Ë©¶Âç∑</th>
                                            <th className="p-4 text-slate-500 font-bold text-sm">ÂæóÂàÜ</th>
                                            <th className="p-4 text-slate-500 font-bold text-sm">ÁôæÂàÜÊØî</th>
                                            <th className="p-4 text-slate-500 font-bold text-sm">Ë°®Áèæ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {paperStats.length === 0 && <tr><td colSpan="5" className="p-8 text-center text-slate-400">ÁÑ°Êï∏Êìö</td></tr>}
                                        {paperStats.map((item, idx) => {
                                            const pct = (item.score/item.max)*100;
                                            const color = pct >= 80 ? 'text-green-600' : (pct >= 50 ? 'text-yellow-600' : 'text-red-600');
                                            return (
                                                <tr key={idx} className="border-b last:border-0 hover:bg-slate-50">
                                                    <td className="p-4 font-bold">{item.year}</td>
                                                    <td className="p-4">{item.paper}</td>
                                                    <td className="p-4">{item.score} / {item.max}</td>
                                                    <td className={`p-4 font-bold ${color}`}>{pct.toFixed(1)}%</td>
                                                    <td className="p-4">
                                                        <div className="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                                                            <div className={`h-full rounded-full ${pct>=80?'bg-green-500':(pct>=50?'bg-yellow-400':'bg-red-500')}`} style={{width: `${pct}%`}}></div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-red-500">
                                    <h3 className="font-bold text-lg mb-4 text-red-600">‚ö† ÊÄ•ÈúÄÊîπÂñÑ (Bottom 10)</h3>
                                    <div className="space-y-4">
                                        {topicStats.slice(0, 10).map((t, i) => (
                                            <div key={t.id} className="flex justify-between items-start p-3 bg-red-50 rounded-lg border border-red-100">
                                                <div>
                                                    <div className="font-bold text-slate-800">{t.topic}</div>
                                                    <div className="text-xs text-slate-500">{t.desc} ({t.book})</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-2xl font-bold text-red-600">{t.pct.toFixed(0)}%</div>
                                                    <div className="text-xs text-slate-400">Ê≠£Á¢∫Áéá</div>
                                                </div>
                                            </div>
                                        ))}
                                        {topicStats.length === 0 && <div className="text-slate-400">ÁÑ°Êï∏Êìö</div>}
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-green-500">
                                    <h3 className="font-bold text-lg mb-4 text-green-600">‚òÖ Ë°®ÁèæÂÑ™Áï∞ (Top 10)</h3>
                                    <div className="space-y-4">
                                        {[...topicStats].reverse().slice(0, 10).map((t, i) => (
                                            <div key={t.id} className="flex justify-between items-start p-3 bg-green-50 rounded-lg border border-green-100">
                                                <div>
                                                    <div className="font-bold text-slate-800">{t.topic}</div>
                                                    <div className="text-xs text-slate-500">{t.desc}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-2xl font-bold text-green-600">{t.pct.toFixed(0)}%</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="flex min-h-screen">
                    <Sidebar />
                    <div className="flex-1 ml-64 p-8 overflow-y-auto h-screen">
                        {view === 'students' && <StudentsView />}
                        {view === 'marking' && <MarkingView />}
                        {view === 'input' && <InputView />}
                        {view === 'dashboard' && <DashboardView />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
