<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE Physics Trainer V7.3.1 (History Added)</title>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f8fafc; }
        .sub-topic-tag { font-family: 'Courier New', monospace; font-weight: bold; }
        .stats-list { max-height: 500px; overflow-y: auto; padding-right: 5px; }
        .stats-list::-webkit-scrollbar { width: 6px; }
        .stats-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        .stats-list::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // ==========================================
        // 0. 預設標準答案數據庫 (PRELOADED_KEYS)
        // ==========================================
        
        const PRELOADED_KEYS = {
            "2014_1A": {
                1: "D", 2: "A", 3: "C", 4: "A", 5: "B",
                6: "D", 7: "C", 8: "C", 9: "B", 10: "B",
                11: "B", 12: "B", 13: "B", 14: "A", 15: "C",
                16: "A", 17: "B", 18: "C", 19: "A", 20: "C",
                21: "D", 22: "D", 23: "B", 24: "C", 25: "D",
                26: "A", 27: "D", 28: "D", 29: "B", 30: "B",
                31: "D", 32: "A", 33: "C"
            },
             "2014_2_E3": {
                1: "A", 2: "C", 3: "D", 4: "C", 
                5: "B", 6: "D", 7: "B", 8: "A" 
            },
            "2014_2_E4": {
                1: "A", 2: "D", 3: "B", 4: "C", 
                5: "C", 6: "D", 7: "B", 8: "A" 
            },
            "2015_1A": {
                1: "C", 2: "C", 3: "A", 4: "A", 5: "C",
                6: "B", 7: "B", 8: "B", 9: "D", 10: "D",
                11: "B", 12: "A", 13: "A", 14: "D", 15: "B",
                16: "D", 17: "A", 18: "D", 19: "D", 20: "A",
                21: "B", 22: "D", 23: "A", 24: "B", 25: "C",
                26: "D", 27: "C", 28: "C", 29: "D", 30: "C",
                31: "A", 32: "A", 33: "D"
            },
            "2015_2_E3": {
                1: "A", 2: "D", 3: "B", 4: "C", 
                5: "B", 6: "C", 7: "C", 8: "A" 
            },
            "2015_2_E4": {
                1: "B", 2: "D", 3: "D", 4: "D", 
                5: "B", 6: "C", 7: "A", 8: "A" 
            },
             "2016_1A": {
                1: "A", 2: "B", 3: "C", 4: "A", 5: "D",
                6: "D", 7: "C", 8: "C", 9: "A", 10: "C",
                11: "A", 12: "A", 13: "B", 14: "B", 15: "B",
                16: "C", 17: "B", 18: "D", 19: "D", 20: "D",
                21: "A", 22: "C", 23: "C", 24: "D", 25: "B",
                26: "D", 27: "B", 28: "A", 29: null, 30: "A", // 註：第29題在評卷參考中標註為已刪除 [1]
                31: "D", 32: "A", 33: "C"
            },
            "2016_2_E3": { // 能量和能源的使用
                1: "B", 2: "A", 3: "C", 4: "B", 
                5: "A", 6: "D", 7: "C", 8: "C" 
            },
            "2016_2_E4": { // 醫學物理學
                1: "A", 2: "A", 3: "D", 4: "C", 
                5: "B", 6: "B", 7: "D", 8: "D" 
            }
        };

        // ==========================================
        // 1. 完整課程大綱 (SYLLABUS)
        // ==========================================
        const SYLLABUS_DATA = {
            // --- 第1冊：熱和氣體 (Heat and Gases) ---
            "1.1.1": { section: "Heat", topic: "量度温度", desc: "認識温度為冷熱程度標誌；利用與温度相關的物理性質量度温度 [1]" },
            "1.1.2": { section: "Heat", topic: "攝氏温標", desc: "定義及使用攝氏度作為温度單位 [1]" },
            "1.2.1": { section: "Heat", topic: "內能與能量轉移", desc: "連繫內能與分子隨機運動動能；描述質量和温度對內能的影響；熱為因温差引致的能量轉移 [1]" },
            "1.2.2": { section: "Heat", topic: "熱傳遞方式", desc: "以分子運動闡釋傳導；認識紅外輻射及影響輻射吸收的因素；鑑定傳導、對流和輻射 [1]" },
            "1.3.1": { section: "Heat", topic: "功率", desc: "定義功率 P = E/t 為能量轉移率 [1]" },
            "1.3.2": { section: "Heat", topic: "熱容量和比熱容量", desc: "定義熱容量及比熱容量；解決 E=mcΔT 相關問題；討論水的高比熱容量 [1]" },
            "1.4.1": { section: "Heat", topic: "潛熱", desc: "定義熔解與汽化比潛熱；解決物態改變中的能量問題；闡釋潛熱為分子勢能的改變 [1]" },
            "1.4.2": { section: "Heat", topic: "蒸發與凝結", desc: "認識蒸發冷卻效應；以分子運動解釋蒸發；討論影響蒸發率的因素 [1]" },
            "1.5.1": { section: "Heat", topic: "氣體定律", desc: "查證波義耳定律；應用普適氣體定律 pV=nRT；認識絕對零度與開氏温標 [1]" },
            "1.5.2": { section: "Heat", topic: "氣體分子運動論", desc: "認識氣體壓強源於分子碰撞；理想氣體模型假定；以微觀動能闡釋理想氣體温度 [1]" },
                   // --- 第1課：運 動 (Motion) ---
            "2.1.1": { section: "Mech", topic: "長度和時間", desc: "認識國際單位制中的米(m)和秒(s)；測量基本物理量 [1]" },
            "2.1.2": { section: "Mech", topic: "距離和位移", desc: "以距離和位移描述位置改變；區別標量 (Scalar) 和矢量 (Vector) [1]" },
            "2.1.3": { section: "Mech", topic: "速率、速度和加速度", desc: "定義平均/瞬時速度；定義加速度；以速率和速度描述物體運動 [1]" },
            "2.1.4": { section: "Mech", topic: "誤差估算", desc: "認識反應時間；解決實驗中的百分誤差問題 [1]" },
        
            // --- 第2課：直線運動 (Rectilinear Motion) ---
            "2.2.1": { section: "Mech", topic: "描述直線運動", desc: "使用矢量號與符號系統描述直線運動的物理量 [1]" },
            "2.2.2": { section: "Mech", topic: "運動線圖", desc: "詮釋 s-t, v-t, a-t 圖；利用斜率求速度/加速度；利用面積求位移 [1]" },
            "2.2.3": { section: "Mech", topic: "勻加速運動方程", desc: "推導及應用 SUVAT 方程解決勻加速直線運動問題 [1]" },
            "2.2.4": { section: "Mech", topic: "重力下的垂直運動", desc: "檢測自由落體運動；估算重力加速度 g；討論空氣阻力的影響 [1]" },
        
            // --- 第3課：力與運動 I (Force and Motion I) ---
            "2.3.1": { section: "Mech", topic: "力的概念", desc: "使用牛頓(N)作為單位；明白摩擦力為阻礙運動的力；繪製隔離體圖 (FBD) [1]" },
            "2.3.2": { section: "Mech", topic: "牛頓第一定律", desc: "描述慣性 (Inertia) 與質量的關係；解釋物體靜止或勻速運動的狀況 [1]" },
            "2.3.3": { section: "Mech", topic: "牛頓第二定律", desc: "描述淨力對速度改變的影響；實驗查證並應用 F=ma 解決一維問題 [1]" },
            "2.3.4": { section: "Mech", topic: "重量與質量", desc: "區別質量和重量；應用 W=mg 計算重力 [1]" },
            "2.3.5": { section: "Mech", topic: "流體阻力", desc: "認識流體阻力及其對物體達至終端速度 (Terminal Velocity) 的影響 [1]" },
            "2.3.6": { section: "Mech", topic: "摩擦力", desc: "認識靜摩擦力與滑動摩擦力的特性與計算 [1]" },
            "2.3.7": { section: "Mech", topic: "牛頓第三定律", desc: "認識力成對作用；鑑定並描述作用力與反作用力對 (Action-reaction pair) [1]" },
        
            // --- 第4課：力與運動 II (Force and Motion II) ---
            "2.4.1": { section: "Mech", topic: "物體組成的系統", desc: "應用牛頓第二定律處理多個連接體間的運動問題 [1]" },
            "2.4.2": { section: "Mech", topic: "力的合成和分解", desc: "以圖解法或代數法合成共面力；將力分解為兩個垂直分量 [1]" },
            "2.4.3": { section: "Mech", topic: "共面力平衡", desc: "應用力的平衡條件解決受多個共面力作用的問題 [1]" },
        
            // --- 第5課：力 矩 (Moment) ---
            "2.5.1": { section: "Mech", topic: "力的轉動效應", desc: "定義力矩 (Moment)；討論轉矩及力偶 (Couple) 在日常生活中的應用 [1]" },
            "2.5.2": { section: "Mech", topic: "剛體的平衡", desc: "應用受力平衡及力矩平衡條件解決固定支點問題；測定重心位置 [1]" },
        
            // --- 第6課：功、能量和功率 (Work, Energy and Power) ---
            "2.6.1": { section: "Mech", topic: "功 (Work)", desc: "定義機械功 W = Fs cos θ；闡釋功為能量轉移的一種方式 [1]" },
            "2.6.2": { section: "Mech", topic: "機械能", desc: "推導並應用動能 (1/2 mv²) 及重力勢能 (mgh) 公式 [1]" },
            "2.6.3": { section: "Mech", topic: "能量變化和守恆", desc: "描述勢能與動能的相互轉換；考慮能量損耗 (如摩擦產熱) 的情況 [1]" },
            "2.6.4": { section: "Mech", topic: "功率 (Power)", desc: "定義功率 P=E/t；應用 P=Fv 解決相關機械功率問題 [1]" },
        
            // --- 第7課：動 量 (Momentum) ---
            "2.7.1": { section: "Mech", topic: "動量守恆", desc: "定義動量 p=mv；應用動量守恆定律解決一維碰撞及爆炸問題；區別彈性/非彈性碰撞 [1]" },
            "2.7.2": { section: "Mech", topic: "動量變化與衝量", desc: "闡釋淨力為動量變化率；認識衝量 (Impulse) 為動量的改變 [1]" },
        
            // --- 第8課：拋體運動 (Projectile Motion - Ext) ---
            "2.8.1": { section: "Mech", topic: "認識拋體運動", desc: "描述拋體運動路徑；理解水平及垂直運動的各自獨立性 [1]" },
            "2.8.2": { section: "Mech", topic: "分析拋體運動", desc: "應用 SUVAT 分解並解決各種初速、投射角的拋體運動問題 [1]" },
        
            // --- 第9課：勻速圓周運動 (Circular Motion - Ext) ---
            "2.9.1": { section: "Mech", topic: "描述圓周運動", desc: "定義角速度 (ω)；連繫角速度與線速度 (v=rω) [1]" },
            "2.9.2": { section: "Mech", topic: "向心力與加速度", desc: "認識向心力指向圓心；應用 a = v²/r 或 a = rω² 公式 [1]" },
            "2.9.3": { section: "Mech", topic: "圓周運動應用", desc: "分析傾斜路面上的汽車、圓錐擺等日常圓周運動例子 [1]" },
        
            // --- 第10課：引 力 (Gravitation - Ext) ---
            "2.10.1": { section: "Mech", topic: "萬有引力", desc: "應用萬有引力定律 F = GMm/r²；定義及計算引力場強度 g = GM/r² [2]" },
            "2.10.2": { section: "Mech", topic: "引力下的圓周運動", desc: "分析衛星或行星軌道運動；計算軌道速度與週期 [2]" },
        // --- 第1課：光的反射 (Reflection of Light) ---
            "3.1.1": { section: "Waves", topic: "光線", desc: "認識光線和光束的基本性質 [1]" },
            "3.1.2": { section: "Waves", topic: "反射與平面鏡", desc: "應用反射定律；利用作圖法繪畫平面鏡的成像 [1]" },
        
            // --- 第2課：光的折射 (Refraction of Light) ---
            "3.2.1": { section: "Waves", topic: "折射", desc: "檢測折射定律；定義折射率 n = sin i / sin r；利用波速定義折射率 [1]" },
            "3.2.2": { section: "Waves", topic: "全內反射", desc: "檢測全內反射條件（密介質進入疏介質、入射角大於臨界角）；解決相關應用問題 [1]" },
        
            // --- 第3課：透鏡 (Lenses) ---
            "3.3.1": { section: "Waves", topic: "透鏡種類", desc: "區別凸透鏡（會聚）與凹透鏡（發散） [1]" },
            "3.3.2": { section: "Waves", topic: "凸透鏡成像", desc: "區別實像與虛像；以作圖法（三條特徵光線）繪畫凸透鏡成像 [1]" },
            "3.3.3": { section: "Waves", topic: "凹透鏡成像", desc: "以作圖法繪畫凹透鏡成像（始終為正立縮小虛像） [1]" },
            "3.3.4": { section: "Waves", topic: "物、像與透鏡關係", desc: "應用透鏡公式 1/u + 1/v = 1/f 解決單一薄鏡成像問題 [1]" },
        
            // --- 第4課：波的本質 (Nature of Waves) ---
            "3.4.1": { section: "Waves", topic: "波的簡介", desc: "以振盪闡釋波動；認識波動傳播能量不帶物質；區別橫波與縱波 [1]" },
            "3.4.2": { section: "Waves", topic: "橫波的波動", desc: "使用術語描述波動（波峯、波谷等）；應用 f = 1/T 及 v = fλ；測定影響絃線波速的因素 [1]" },
            "3.4.3": { section: "Waves", topic: "相位", desc: "使用相位描述波動中不同粒子的振動關係 [1]" },
            "3.4.4": { section: "Waves", topic: "波動線圖分析", desc: "詮釋及區別位移—距離關係線圖與位移—時間關係線圖 [1]" },
        
            // --- 第5課：波的現象和駐波 (Wave Phenomena and Stationary Waves) ---
            "3.5.1": { section: "Waves", topic: "水波", desc: "使用水波槽實驗認識波陣面、波速等水波特徵 [1]" },
            "3.5.2": { section: "Waves", topic: "反射與折射(波)", desc: "繪畫波陣面圖展現反射與折射；認識深淺水域交界處波速與波長的改變 [1]" },
            "3.5.3": { section: "Waves", topic: "衍射與干涉", desc: "描述衍射現象；理解相干源；以程差判定相長干涉（ΔL=nλ）與相消干涉條件 [1]" },
            "3.5.4": { section: "Waves", topic: "駐波", desc: "解釋駐波的形成（兩列相反方向行波疊加）；描述波腹與波節特性 [1]" },
        
            // --- 第6課：光的波動本質與電磁波 (Wave Nature of Light and EM Waves) ---
            "3.6.1": { section: "Waves", topic: "光的波動證據", desc: "指出光為橫波；認識衍射和干涉為光具備波動本質的證據 [2]" },
            "3.6.2": { section: "Waves", topic: "楊氏雙縫實驗", desc: "檢測干涉圖形；應用 Δy = λD/a 解決條紋間距問題 [2]" },
            "3.6.3": { section: "Waves", topic: "平面透射光柵", desc: "檢測光柵衍射圖案；應用 d sin θ = nλ 解決多級亮點問題 [2]" },
            "3.6.4": { section: "Waves", topic: "電磁波譜", desc: "認識電磁波譜成分（無線電至伽瑪射線）及真空波速 3.0 x 10^8 m/s [2]" },
        
            // --- 第7課：聲音 (Sound) ---
            "3.7.1": { section: "Waves", topic: "縱波與聲音", desc: "使用密部和疏部描述聲波；應用波動公式解決聲音問題 [2]" },
            "3.7.2": { section: "Waves", topic: "聲音的本質", desc: "認識聲音為縱波且需介質傳播；描述聲音的反射、折射、衍射和干涉 [2]" },
            "3.7.3": { section: "Waves", topic: "聲音的其他特性", desc: "測定聽頻範圍（20-20kHz）；音調（頻率）、響度（振幅）與音品；聲強級（分貝 dB）與噪音影響 [2]" },
                        // --- 第1課：靜電學 (Electrostatics) ---
            "4.1.1": { section: "Elec", topic: "電荷", desc: "檢測兩種電荷及吸力/斥力；以電子轉移闡釋起電過程 [383, 4.1.1]" },
            "4.1.2": { section: "Elec", topic: "靜電力", desc: "應用庫倫定律解決點電荷間的受力問題 [383, 4.1.2]" },
            "4.1.3": { section: "Elec", topic: "電場", desc: "定義電場強度 E；描述點電荷與平行板間的電場；以場力線表達電場 [383, 4.1.3]" },
        
            // --- 第2課：電流、電壓與電阻 (Current, Voltage and Resistance) ---
            "4.2.1": { section: "Elec", topic: "電流", desc: "定義電流為電荷流動率 I=Q/t；認識電流方向協定 [383, 4.2.1]" },
            "4.2.2": { section: "Elec", topic: "電壓", desc: "定義電動勢 (e.m.f.) 與電勢差 (p.d.)；描述電路中的能量變換 [383, 4.2.2]" },
            "4.2.3": { section: "Elec", topic: "電阻", desc: "定義電阻 R=V/I；量度燈泡及二極管的 V-I 特性；定義電阻率；描述温度對電阻的影響 [383, 4.2.3]" },
            "4.2.4": { section: "Elec", topic: "電阻器網絡", desc: "推導並應用串聯與並聯電路的合成電阻規律；比較網絡中各元件的電壓及電流 [383, 4.2.4]" },
            "4.2.5": { section: "Elec", topic: "電功率", desc: "應用 P=VI 解決電路問題；檢測電流通過導體時的熱效應 [383, 4.2.5]" },
        
            // --- 第3課：實際電路 (Practical Circuits) ---
            "4.3.1": { section: "Elec", topic: "分析電路", desc: "應用分壓器 (Potential Divider) 概念解決簡單電路問題 [383, 4.3.1]" },
            "4.3.2": { section: "Elec", topic: "實際儀表與電池", desc: "認識安培計及伏特計的負載效應；連繫電源電動勢、端電壓與內電阻 [383, 4.3.2]" },
        
            // --- 第4課：家居電學 (Domestic Electricity) ---
            "4.4.1": { section: "Elec", topic: "能量消耗", desc: "以千瓦特小時 (kWh) 計算電能消耗及其費用 [383, 4.4.1]" },
            "4.4.2": { section: "Elec", topic: "安全措施", desc: "理解室內佈線、保險絲、接地與三腳插頭的作用及選擇原則 [383, 4.4.2]" },
            "4.4.3": { section: "Elec", topic: "交流電 (Ext)", desc: "定義交流電方均根值 (r.m.s.)；連繫方均根值與峯值 (Peak Value) [383, 4.4.3]" },
        
            // --- 第5課：磁 場 (Magnetic Field) ---
            "4.5.1": { section: "Elec", topic: "磁力和磁場", desc: "檢測磁鐵磁場圖樣；以場力線表達磁場 [383, 4.5.1]" },
            "4.5.2": { section: "Elec", topic: "電流磁效應", desc: "檢測長直導線及螺線管磁場圖樣；應用 B=μ₀I/2πr 及 B=μ₀NI/l 公式解決問題 [383, 4.5.2]" },
        
            // --- 第6課：磁場產生的力 (Magnetic Force) ---
            "4.6.1": { section: "Elec", topic: "作用於載流導體的磁力", desc: "測定磁力方向；應用 F = BIl sin θ 公式計算受力 [383, 4.6.1]" },
            "4.6.2": { section: "Elec", topic: "直流電動機", desc: "描述直流電動機結構及換向器 (Commutator) 的運作原理 [383, 4.6.2]" },
            "4.6.3": { section: "Elec", topic: "洛倫茲力 (Ext)", desc: "處理載流平行導線間的作用力；應用 F=Bqv sin θ 解決電荷在磁場中運動問題 [383, 4.6.3]" },
        
            // --- 第7課：電磁感應 (Electromagnetic Induction) ---
            "4.7.1": { section: "Elec", topic: "感生電動勢", desc: "檢測感生電流；應用楞次定律 (Lenz's Law) 判定感生電流方向 [383, 4.7.1]" },
            "4.7.2": { section: "Elec", topic: "電磁感應應用", desc: "描述發電機運作；討論渦電流 (Eddy Current) 的產生及其應用 [383, 4.7.2]" },
            "4.7.3": { section: "Elec", topic: "法拉第定律 (Ext)", desc: "定義磁通量 Φ=BA cos θ；應用法拉第定律 ε = -N(ΔΦ/Δt) 計算感生電動勢 [383, 4.7.3]" },
        
            // --- 第8課：變壓器及輸電 (Transformers and Power Transmission - Ext) ---
            "4.8.1": { section: "Elec", topic: "變壓器", desc: "描述變壓器結構；應用 Vp/Vs = Np/Ns 公式；討論提高效率的方法 [383, 4.8.1]" },
            "4.8.2": { section: "Elec", topic: "輸 電", desc: "討論以高壓交流電傳輸電能的好處；描述網電系統的升壓及降壓過程 [383, 4.8.2]" },
                        // --- 第1課：輻射與放射現象 (Radiation and Radioactivity) ---
            "5.1.1": { section: "Rad", topic: "致電離輻射與X射線", desc: "認識X射線性質及產生原理（高速電子撞擊重金屬靶）；討論X射線用途 [383, 5.1.1]" },
            "5.1.2": { section: "Rad", topic: "核輻射", desc: "比較 α、β 和 γ 輻射的本質、穿透力、致電離能力及在電磁場中的偏轉；使用蓋革-彌勒計數器探測輻射 [383, 5.1.2]" },
            "5.1.3": { section: "Rad", topic: "輻射安全", desc: "定義有效劑量單位希沃特 (Sv)；討論致電離輻射的健康風險及減少吸收劑量的安全措施 [383, 5.1.3]" },
        
            // --- 第2課：原子結構與放射衰變 (Atomic Structure and Radioactive Decay) ---
            "5.2.1": { section: "Rad", topic: "原子模型", desc: "描述原子結構；定義原子序、質量數及同位素；以符號表示核素 [383, 5.2.1]" },
            "5.2.2": { section: "Rad", topic: "放射衰變", desc: "寫出 α、β、γ 衰變方程；應用 N = N₀e⁻ᵏᵗ 解決衰變問題；定義半衰期並連繫衰變常數 [383, 5.2.2]" },
            "5.2.3": { section: "Rad", topic: "放射性同位素的應用", desc: "討論同位素作為示蹤物 (Tracer) 及在碳-14定年法等領域的實際應用 [383, 5.2.3]" },
        
            // --- 第3課：核 能 (Nuclear Energy) ---
            "5.3.1": { section: "Rad", topic: "核裂變與核聚變", desc: "認識裂變中的連鎖反應及聚變（太陽能量來源）；了解核反應中的能量釋放原理 [383, 5.3.1]" },
            "5.3.2": { section: "Rad", topic: "質能關係", desc: "應用 ΔE = Δmc² 計算核反應能量；使用原子質量單位 (u) 進行能量計算 [383, 5.3.2]" },
            "5.3.3": { section: "Rad", topic: "核能發電", desc: "認識受控核裂變反應堆運作；討論核能作為能源的優點和缺點 [383, 5.3.3]" },
            
            // ==========================================
            // Elective Section Syllabus Details
            // ==========================================
            
            // --- Elective E3: Energy and Use of Energy (能量和能源的使用) ---
            "E3.1.1": { section: "E3", topic: "家用耗能電器", desc: "電能作為主要能源；家用電器能量轉換；定義最終能源效益；香港能源效益標籤計劃 (EELS) 的使用及計算 [1]" },
            "E3.1.2": { section: "E3", topic: "無火烹調", desc: "電熱平板爐、電磁爐和微波爐運作原理；炊具最終能源效益比較；優缺點討論及運作成本測定 [1]" },
            "E3.1.3": { section: "E3", topic: "抽熱", desc: "空調機與熱泵原理；定義製冷能力 (kW)；定義性能係數 COP；中央空調系統排放熱量的用途 [1]" },
            "E3.2.1": { section: "E3", topic: "電燈", desc: "描述白熾燈、氣體放電燈和 LED 運作原理；以原子能量改變闡釋光的放射；討論成本效益 [1]" },
            "E3.2.2": { section: "E3", topic: "量度亮度", desc: "定義光通量 (lm) 與照明度 (lux)；應用平方反比定律和朗伯餘弦定律；定義電燈效能 (lm/W) [1]" },
            "E3.3.1": { section: "E3", topic: "樓宇的能源效益", desc: "熱傳遞率方程應用；定義建築材料 U 值；定義及討論影響 OTTV 的因素；太陽隔熱膜的用途 [1]" },
            "E3.3.2": { section: "E3", topic: "交通工具的能源效益", desc: "電動車與混合動力車動力系統主要部件；比較電動車與化石燃料車的最終能源效益 [1]" },
            "E3.4.1": { section: "E3", topic: "能源與結合能", desc: "不可再生能源與可再生能源特徵；定義結合能 (eV)；核裂變反應堆原理；風力發電功率方程 P=1/2ηρAv³；太陽常數與太陽能電池 [2]" },
            "E3.4.2": { section: "E3", topic: "環境衝擊", desc: "能源提取與使用的社會衝擊；温室氣體對全球暖化的影響；分析香港不同燃料消耗量 [2]" },
            
            // --- Elective E4: Medical Physics (醫學物理學) ---
            "E4.1.1": { section: "E4", topic: "人類視覺", desc: "眼睛的視覺調節過程；視桿及視錐細胞的功能；光感細胞對光譜的反應及吸收曲線 [2]" },
            "E4.1.2": { section: "E4", topic: "視覺缺陷", desc: "定義透鏡焦強 (Dioptre)；眼睛近點與遠點；近視、遠視、散光及其糾正方法 [2]" },
            "E4.1.3": { section: "E4", topic: "光纖內窺鏡", desc: "內窺鏡運作原理與光纖特性；相干與非相干光纖管束造像；內窺鏡診斷的優點與限制 [2]" },
            "E4.2.1": { section: "E4", topic: "人類聽覺", desc: "中耳壓強增益功能；內耳對聲音反應；相對聲強級對數標度 (L = 10 log I/I₀)；等響曲線與噪音影響 [2]" },
            "E4.2.2": { section: "E4", topic: "超聲波醫學影像", desc: "壓電換能器運作原理；定義聲阻抗 (Z)；比較人體組織聲阻抗；應用反射聲強係數解決問題 [2]" },
            "E4.2.3": { section: "E4", topic: "超聲波掃描", desc: "A-掃描與 B-掃描運作及圖像闡釋；超聲波衰減與頻率關係；診斷的優點和限制 [2]" },
            "E4.3.1": { section: "E4", topic: "X射線成像", desc: "應用 I = I₀e⁻ᵐˣ 測定強度；線衰減係數與半值厚度；人工顯影劑（如鋇餐）的用途及風險 [2]" },
            "E4.3.2": { section: "E4", topic: "CT 掃描", desc: "電腦斷層造影掃描儀運作原理；圖像重建過程；比較 CT 與常規 X 射線圖像 [2]" },
            "E4.3.3": { section: "E4", topic: "放射性核素造影", desc: "放射性同位素作為示蹤物 (Tracer)；伽瑪攝影儀原理；定義生物半衰期；鑑定鍀-99m特性 [2]" },
            "E4.3.4": { section: "E4", topic: "輻射風險", desc: "致電離輻射成像的健康風險與安全措施；比較醫學診斷中不同輻射的有效劑量 [2]" }
        };

        // ==========================================
        // 2. QUESTION MAP DATABASE
        // ==========================================
        const FULL_QUESTION_MAP = {
            "2014_1A": {
                // --- 1-2: Heat and Gases ---
                1: { tid: "1.2.2", detail: "真空瓶減少熱增益（輻射/傳導）原理分析 [2]" },
                2: { tid: "1.4.1", detail: "利用温度-時間圖計算熔解比潛熱 [2]" },
            
                // --- 3-12: Force and Motion ---
                3: { tid: "2.5.2", detail: "剛體平衡下的力矩比例計算 [2]" },
                4: { tid: "2.4.3", detail: "懸掛系統的共面力平衡分析 [3]" },
                5: { tid: "2.2.3", detail: "應用 SUVAT 公式計算勻加速度 [3]" },
                6: { tid: "2.2.3", detail: "比較不同斜面上滑下的速度與時間 [3]" },
                7: { tid: "2.7.1", detail: "一維碰撞中的動量守恆與速度判斷 [3]" },
                8: { tid: "2.4.1", detail: "分析滑輪連接體系統的加速度 [4]" },
                9: { tid: "2.2.4", detail: "垂直下拋運動的位移估計 [4]" },
                10: { tid: "2.8.2", detail: "計算水平拋體運動的初速度 [4]" },
                11: { tid: "2.10.2", detail: "解釋軌道運動中的失重現象原因 [5]" },
                12: { tid: "2.10.1", detail: "萬有引力定律與引力場強度計算 [5]" },
                // --- 13-19: Waves ---
                13: { tid: "3.5.2", detail: "水波在平直障礙物上的反射圖樣分析 [5]" },
                14: { tid: "3.4.4", detail: "橫波快照中粒子的運動方向分析 [6]" },
                15: { tid: "3.2.1", detail: "平行介質中的折射路徑與波速比較 [6]" },
                16: { tid: "3.5.3", detail: "影響波穿過狹縫時衍射程度的因素 [7]" },
                17: { tid: "3.7.1", detail: "利用超聲波反射估算移動汽車的速度 [7]" },
                18: { tid: "3.5.3", detail: "反相聲源的相長與相消干涉判定 [7]" },
                19: { tid: "3.7.2", detail: "聲波的本質與傳播特性辨析 [8]" },
            
                // --- 20-30: Electricity and Magnetism ---
                20: { tid: "4.1.1", detail: "靜電感應與接觸起電的電荷分佈 [8]" },
                21: { tid: "4.1.2", detail: "點電荷系統的合靜電力分析 [8]" },
                22: { tid: "4.1.3", detail: "電場強度與場力線分佈概念" },
                23: { tid: "4.1.3", detail: "點電荷周圍的電勢與電場關係" },
                24: { tid: "4.3.2", detail: "實際儀表在電路中的負載效應" },
                25: { tid: "4.3.1", detail: "分壓器電路中的電壓分配計算" },
                26: { tid: "4.5.2", detail: "右手螺旋定則判定磁場圖樣" },
                27: { tid: "4.7.3", detail: "法拉第定律應用：感生電流方向判定 [9]" },
                28: { tid: "4.5.2", detail: "影響長螺線管內磁通量密度的因素 [9]" },
                29: { tid: "4.6.3", detail: "應用洛倫茲力解釋霍爾效應電勢差 [10]" },
                30: { tid: "4.4.3", detail: "比較直流電與交流電的功率及 r.m.s. 值 [10]" },
            
                // --- 31-33: Radioactivity ---
                31: { tid: "5.2.2", detail: "放射衰變序列中的質子與中子數變化 [10]" },
                32: { tid: "5.1.2", detail: "比較不同物質對核輻射的穿透能力 [11]" },
                33: { tid: "5.3.2", detail: "核反應中的質能關係與釋放能量計算 [11]" }
            },
            // 您的輸入範例 (2014_1B)
            "2014_1B": [
                // --- 第1題：熱容量實驗 (Heat) ---
                { id: "1a", max: 1, tid: "1.3.1", detail: "根據温度-時間圖表找出加熱器的開啟時間 [1, 2]" }, 
                { id: "1b", max: 1, tid: "1.2.2", detail: "解釋加熱器關閉後温度繼續上升的原因（熱傳遞延遲）[1, 2]" },
                { id: "1ci", max: 2, tid: "1.3.2", detail: "利用最高温度升幅計算金屬塊的比熱容量 (E=mcΔT) [2]" },
                { id: "1cii", max: 2, tid: "1.3.2", detail: "分析實驗系統誤差（熱量散失）對計算結果的影響 [3]" },
                { id: "1d", max: 1, tid: "1.2.2", detail: "解釋為何該方法不適用於導熱性差的玻璃塊 [3]" },
            
                // --- 第2題：氣體定律 (Gases) ---
                { id: "2ai", max: 3, tid: "1.5.1", detail: "應用波義耳定律 (pV=const) 計算所需的空氣體積 [4]" },
                { id: "2aii", max: 1, tid: "1.5.1", detail: "根據泵的單次壓縮體積估算所需的抽氣次數 [5]" },
                { id: "2b", max: 2, tid: "1.5.2", detail: "應用氣體分子運動論解釋壓強增加的微觀原因 [5]" },
            
                // --- 第3題：兩車運動分析 (Motion) ---
                { id: "3a", max: 2, tid: "2.2.2", detail: "描述 v-t 圖中汽車 A 在整個旅程中的運動狀態 [6]" },
                { id: "3bi", max: 2, tid: "2.1.3", detail: "從 v-t 圖斜率計算並比較兩車的最大加速度 [7]" },
                { id: "3bii", max: 2, tid: "2.2.2", detail: "根據 v-t 圖繪製汽車 B 對應的 a-t 圖 [7]" },
                { id: "3ci", max: 2, tid: "2.2.2", detail: "利用圖下面積計算特定時刻兩車之間的距離 [7]" },
                { id: "3cii", max: 2, tid: "2.2.2", detail: "推導兩車位移相等時的追上時間 [7]" },
                { id: "3d", max: 2, tid: "2.6.4", detail: "考慮阻力與速度平方成正比，計算引擎輸出功率比例 [8]" },
            
                // --- 第4題：加速度計原理 (Forces) ---
                { id: "4a", max: 4, tid: "2.3.1", detail: "繪製受力隔離體圖 (FBD) 並解釋向上加速時物體高度下降原因 [9, 10]" },
                { id: "4b", max: 3, tid: "2.3.3", detail: "根據彈簧秤讀數變化與 F=ma 計算盒子的加速度 [11]" },
                { id: "4c", max: 2, tid: "2.3.3", detail: "分析智能電話旋轉時加速度計感應值的變化與顯示判定 [12]" },
            
                // --- 第5題：折射與全內反射 (Optics) ---
                { id: "5a", max: 2, tid: "3.2.1", detail: "利用 Snell's Law 計算半圓形玻璃塊對紅光的折射率 [13]" },
                { id: "5b", max: 2, tid: "3.2.2", detail: "判定並解釋光線在界面發生全內反射的物理條件 [13]" },
                { id: "5c", max: 2, tid: "3.2.2", detail: "補完並繪畫光線在玻璃塊內及射入空氣的後續路徑 [14]" },
                { id: "5d", max: 1, tid: "3.2.1", detail: "描述白光射入後在出射界面觀察到的色散現象 [14]" },
            
                // --- 第6題：透鏡成像 (Lenses) ---
                { id: "6a", max: 2, tid: "3.3.1", detail: "根據光線路徑判定透鏡種類（凸透鏡）並解釋理由 [15]" },
                { id: "6bi", max: 2, tid: "3.3.2", detail: "利用作圖法（特徵光線）標示遠處物點的像位置 [15]" },
                { id: "6bii", max: 1, tid: "3.3.4", detail: "根據作圖結果測量並求出透鏡的焦距 [15]" },
                { id: "6c", max: 1, tid: "3.3.2", detail: "完成來自同一物點的第三條特徵光線的路徑 [15]" },
                { id: "6d", max: 2, tid: "3.3.4", detail: "描述一種測定薄透鏡焦距的簡單實驗方法 [16]" },
            
                // --- 第7題：光柵衍射實驗 (Diffraction) ---
                { id: "7ai", max: 1, tid: "3.6.3", detail: "根據幾何距離計算第二級亮點的衍射角 [17]" },
                { id: "7aii", max: 3, tid: "3.6.3", detail: "應用光柵方程 (d sin θ = nλ) 計算激光波長 [17]" },
                { id: "7aiii", max: 1, tid: "3.6.3", detail: "指出量度較高階亮點位置對提高實驗準確度的優點 [18]" },
                { id: "7b", max: 2, tid: "3.6.3", detail: "建議減低狹縫與米尺對準誤差的實驗改善方法 [19]" },
            
                // --- 第8題：家居電學 (Electricity) ---
                { id: "8a", max: 1, tid: "4.2.3", detail: "計算額定值為 500W 220V 的加熱元件電阻 [20]" },
                { id: "8b", max: 2, tid: "4.2.5", detail: "分析特定開關模式下電熱器的總消耗功率 [20]" },
                { id: "8c", max: 2, tid: "4.3.1", detail: "判斷何種模式具有最大功率並解釋電阻連接關係 [20]" },
                { id: "8di", max: 3, tid: "4.4.2", detail: "根據總電流計算選擇最合適的保險絲規格 [21]" },
                { id: "8dii", max: 2, tid: "4.4.2", detail: "評論開關安裝位置（火線 vs 零線）對用電安全的影響 [21]" },
                { id: "8diii", max: 2, tid: "4.4.2", detail: "解釋接地線如何預防漏電導致的觸電風險 [21]" },
            
                // --- 第9題：電磁感應 (Electromagnetism) ---
                { id: "9a", max: 6, tid: "4.7.1", detail: "描述演示楞次定律的實驗步驟、觀察結果及物理解釋 [22, 23]" },
                { id: "9bi", max: 1, tid: "4.7.1", detail: "預測改用交流電供應時鋁環產生的物理現象 [23]" },
                { id: "9bii", max: 1, tid: "4.7.2", detail: "解釋鋁環有裂縫時無法懸浮的原因（渦電流受阻）[23]" },
            
                // --- 第10題：放射現象 (Radioactivity) ---
                { id: "10a", max: 1, tid: "5.1.3", detail: "解釋放射源密封在金屬殼內對 α 輻射的防護作用 [24]" },
                { id: "10bi", max: 3, tid: "5.2.2", detail: "利用原子數目及半衰期計算放射源的初始放射強度 [24, 25]" },
                { id: "10bii", max: 2, tid: "5.3.2", detail: "結合衰變能量釋放率估算放射源的發電功率 [25, 26]" },
                { id: "10biii", max: 2, tid: "5.2.2", detail: "計算經過 36 年後放射源剩餘功率的百分比 [25, 26]" }
            ],
            // ==========================================
            // 2014 DSE PHY Paper 2 (Elective) Map
            // ==========================================
            
            // --- Elective Section C: Energy and Use of Energy ---
            "2014_2_E3": {
                1: { tid: "E3.2.2", detail: "比較不同單色光源在流明與功率下的亮度感" },
                2: { tid: "E3.1.1", detail: "分析能源標籤數據以判定冷氣機的能源效益" },
                3: { tid: "E3.3.1", detail: "根據熱傳導係數與厚度選擇最佳隔熱建築材料" },
                4: { tid: "E3.3.1", detail: "低放射率塗層（Low-e）對反射紅外輻射的作用" },
                5: { tid: "E3.4.1", detail: "應用風力發電功率方程計算平均輸出功率" },
                6: { tid: "E3.3.2", detail: "辨析混合動力車的能量來源與驅動特徵" },
                7: { tid: "E3.4.1", detail: "利用每一核子結合能曲線分析核裂變與聚變的穩定性" },
                8: { tid: "E3.4.1", detail: "分析壓水式核反應堆（PWR）運作中的放射性安全問題" }
            },
            "2014_2_E3_LQ": [
                { id: "3a", max: 2, tid: "E3.1.1", detail: "計算電動車電池充電至滿電所需的估計時間" },
                { id: "3bi", max: 3, tid: "E3.3.2", detail: "描述再生制動系統在車輛前進加速與制動時的能量轉換" },
                { id: "3bii", max: 2, tid: "E3.3.2", detail: "分析行車速度對再生制動系統收集能量效能的影響" },
                { id: "3biii", max: 1, tid: "E3.3.2", detail: "解釋電動車配備傳統機械制動系統的必要性" },
                { id: "3c", max: 2, tid: "E3.3.2", detail: "綜合比較汽油、煤電及核電驅動模式的總體能源效益與污染" }
            ],
            
            // --- Elective Section D: Medical Physics ---
            "2014_2_E4": {
                1: { tid: "E4.1.2", detail: "分析雙光鏡片對老花眼（Presbyopia）及遠處物體的矯正原理" },
                2: { tid: "E4.2.1", detail: "辨析聽閾的聲強級（dB）與頻率的依賴關係" },
                3: { tid: "E4.2.3", detail: "分析超聲波 A-掃描中脂肪與骨骼界面的反射信號波峯" },
                4: { tid: "E4.1.3", detail: "區別相干與非相干光纖管束在內窺鏡影像傳輸中的角色" },
                5: { tid: "E4.2.3", detail: "判定最適合穿刺活檢實時監控（Real-time imaging）的影像方法" },
                6: { tid: "E4.3.1", detail: "應用 X 射線衰減定律與線衰減係數計算強度透射比" },
                7: { tid: "E4.3.1", detail: "說明人工顯影劑（ACM/鋇餐）在提高 X 射線影像對比度的機制" },
                8: { tid: "E4.3.3", detail: "結合生物與物理半衰期計算體內放射性示蹤劑的衰減時間" }
            },
            "2014_2_E4_LQ": [
                { id: "4ai", max: 2, tid: "E4.2.2", detail: "描述壓電換能器產生醫學用超聲波脈衝的工作原理" },
                { id: "4aii", max: 2, tid: "E4.2.3", detail: "指出在醫學成像中使用高頻超聲波的一項優點與限制" },
                { id: "4bi", max: 2, tid: "E4.1.2", detail: "利用眼睛總焦強（Dioptre）估計晶狀體至視網膜的距離" },
                { id: "4bii", max: 2, tid: "E4.1.1", detail: "應用瑞利判據（Rayleigh criterion）計算人眼對手機像素的解像力" },
                { id: "4biii", max: 2, tid: "E4.1.1", detail: "估算在特定視距下，人眼無法分辨相鄰像素時的最小像素邊長" }
            ],
            "2015_1A": {
                // --- 熱學 (Heat and Gases) ---
                1: { tid: "1.2.2", detail: "分析汽車在陽光下停泊時的熱傳遞方式（如輻射、傳導） [1]" },
                2: { tid: "1.3.2", detail: "從温度-時間圖線比較不同物體的熱容量與質量比例 [1]" },
                3: { tid: "1.2.1", detail: "理解熱傳導的方向性與內能/温度的物理定義 [2]" },
            
                // --- 力學 (Force and Motion) ---
                4: { tid: "2.1.3", detail: "計算質點在二維路徑（東、北）運動後的平均速度量值 [2, 3]" },
                5: { tid: "2.3.3", detail: "應用牛頓第二定律 (F=ma) 處理合併質量系統的加速度問題 [1]" },
                6: { tid: "2.7.2", detail: "利用力-時間圖（衝量概念）計算物體在特定時間的速率 [4]" },
                7: { tid: "2.2.2", detail: "辨識彈性碰撞地面之彈跳球的速度-時間 (v-t) 關係圖 [2]" },
                8: { tid: "2.3.5", detail: "分析受空氣阻力影響下物體下落時速度與加速度的變化 [5, 6]" },
                9: { tid: "2.2.2", detail: "從 v-t 圖分析兩車的相對位移、最大間距及追趕時刻 [4, 6]" },
                10: { tid: "2.9.2", detail: "分析汽車在無摩擦力作用的傾斜圓形道路上的向心力來源 [6, 7]" },
                11: { tid: "2.10.1", detail: "應用牛頓第三定律比較天體間萬有引力的方向與量值 [6]" },
            
                // --- 波動 (Waves) ---
                12: { tid: "3.4.2", detail: "根據波粒子位置快照估算縱波的振動頻率 [6]" },
                13: { tid: "3.5.2", detail: "分析水波槽中圓形波脈衝經平直障礙物反射後的圖樣 [8]" },
                14: { tid: "3.5.3", detail: "分析兩脈衝在固定端反射及疊加後的合成波形 [6, 9]" },
                15: { tid: "3.3.3", detail: "判定物體在凹透鏡前成像的正確折射光線路徑圖 [6, 9]" },
                16: { tid: "3.3.4", detail: "利用 1/v 對 1/u 圖線分析透鏡焦距改變後的實驗預期結果 [6, 10]" },
                17: { tid: "3.6.3", detail: "比較白光分別經玻璃稜鏡與衍射光柵產生的光譜特徵 [11]" },
                18: { tid: "3.5.4", detail: "判定在張力改變及頻率恆定下絃線可能出現的駐波振動模式 [6]" },
                19: { tid: "3.7.1", detail: "利用聲波回聲時間計算上升氣球與地面的距離 [11]" },
                20: { tid: "3.6.4", detail: "辨識紫外輻射與微波在真空中波長的數量級範圍 [11]" },
            
                // --- 電磁學 (Electricity and Magnetism) ---
                21: { tid: "4.1.1", detail: "根據三個懸掛球體間的相互吸引特性判定其帶電狀態 [12]" },
                22: { tid: "4.1.3", detail: "找出兩個不等量點電荷系統中合電場強度為零的空間位置 [12]" },
                23: { tid: "4.1.2", detail: "計算點電荷系統的靜電勢能改變（由無窮遠移近所需的功） [12]" },
                24: { tid: "4.7.1", detail: "分析金屬框在均勻磁場中旋轉時的感生電流及阻礙轉動的力矩 [12, 13]" },
                25: { tid: "4.3.1", detail: "根據司機座椅及安全帶的邏輯設計最佳警示燈電路 [12, 13]" },
                26: { tid: "4.2.4", detail: "分析複雜電路中元件短路或斷路對電流表及電壓表讀數的影響 [12]" },
                27: { tid: "4.2.1", detail: "應用電流與載流子密度公式計算導線中電子的漂移速率 [12]" },
                28: { tid: "4.4.2", detail: "解釋家居市電插座採用並聯連接而非法連連接的安全原因 [14]" },
                29: { tid: "4.2.5", detail: "分析不同地區市電電壓與頻率對電暖器實際功率的影響 [14]" },
                30: { tid: "4.6.3", detail: "分析磁場中薄片導體的尺寸改變對霍爾電壓 (Hall voltage) 的影響 [15]" },
            
                // --- 放射現象 (Radioactivity) ---
                31: { tid: "5.3.1", detail: "辨識自發核衰變反應與人工引發核反應（如聚變、裂變） [14, 15]" },
                32: { tid: "5.1.2", detail: "分析膠片劑量計探測不同核輻射（α, β, γ）的物理局限 [15, 16]" },
                33: { tid: "5.2.2", detail: "利用碳-14 定年法及修正計數率估算古木樣本的年齡 [14, 17]" }
            },
            "2015_1B": [
                // --- 第 1 題：電阻溫度計與熱容量 [來源 39, 44] ---
                { id: "1ai", max: 2, tid: "4.2.3", detail: "根據電阻-溫度關係計算特定溫度下的預期電阻" },
                { id: "1aii", max: 1, tid: "1.1.2", detail: "分析非線性電阻變化對溫度測量準確度的影響" },
                { id: "1b", max: 2, tid: "1.3.2", detail: "分析水比熱容量實驗中的熱量交換誤差" },
            
                // --- 第 2 題：氣體定律 (Gases) ---
                { id: "2", max: 6, tid: "1.5.1", detail: "應用普適氣體定律 pV=nRT 處理狀態改變問題" },
            
                // --- 第 3 題：斜面運動與能量守恆 [來源 44] ---
                { id: "3", max: 9, tid: "2.6.3", detail: "分析物體在不同斜面位置的動能與勢能轉換" },
            
                // --- 第 4 題：牛頓定律應用 (Force and Motion) ---
                { id: "4", max: 11, tid: "2.3.3", detail: "應用 F=ma 解決複雜系統的受力與運動問題" },
            
                // --- 第 5 題：火車內的加速度計實驗 [來源 46] ---
                { id: "5", max: 6, tid: "2.3.3", detail: "利用懸掛金屬球與量角器在加速火車中測定加速度的原理與推導" },
            
                // --- 第 6 題：海市蜃樓與折射現象 [來源 47] ---
                { id: "6a", max: 1, tid: "3.2.2", detail: "指出觀察海市蜃樓所需的特定大氣折射條件" },
                { id: "6bi", max: 3, tid: "3.2.1", detail: "根據 Snell's Law 推導層狀空氣間的折射率與入射角關係" },
                { id: "6bii", max: 2, tid: "3.2.1", detail: "計算特定觀察高度下光線的路徑距離" },
                { id: "6c", max: 2, tid: "3.2.1", detail: "解釋觀察者移動位置時對虛像視距離的物理影響" },
            
                // --- 第 7 題：波動現象 (Waves) ---
                { id: "7", max: 10, tid: "3.6.2", detail: "干涉或衍射實驗（如楊氏雙縫）的圖樣分析與計算" },
            
                // --- 第 8 題：直流電路分析 (Electricity) ---
                { id: "8", max: 13, tid: "4.3.1", detail: "分析分壓器電路及包含多個電阻與開關的網絡" },
            
                // --- 第 9 題：旋轉金屬棒與電磁感應 [來源 40] ---
                { id: "9a", max: 3, tid: "4.7.1", detail: "應用楞次定律判定旋轉金屬棒的感生電流方向" },
                { id: "9bi", max: 2, tid: "4.6.1", detail: "計算作用在金屬棒上的磁力及產生的阻礙力矩" },
                { id: "9bii", max: 2, tid: "4.5.2", detail: "利用導線電流強度估算特定點的磁場強度 B" },
                { id: "9c", max: 2, tid: "4.7.2", detail: "討論架空電纜輸送電功率時的能量損耗與效率 [來源 40]" },
            
                // --- 第 10 題：放射衰變 (Radioactivity) ---
                { id: "10", max: 7, tid: "5.2.2", detail: "利用放射強度與時間圖線計算放射源的半衰期" }
            ],
                        // ==========================================
            // 2015 DSE Physics Paper 1B Question Map
            // ==========================================
            "2015_1B": [
                // --- 第 1 題：電阻溫度計與熱容量 [來源 48, 71] ---
                { id: "1ai", max: 2, tid: "4.2.3", detail: "利用線性假設，根據電阻-溫度關係計算 60°C 下的預期電阻 [1]" },
                { id: "1aii", max: 1, tid: "1.1.2", detail: "分析金屬電阻非線性變化對實際測量溫度的影響 [1]" },
                { id: "1b", max: 2, tid: "1.3.2", detail: "分析測定水比熱容量實驗中，熱量散失對實驗值的誤差影響 [1]" },
            
                // --- 第 2 題：潛水與氣體定律 [來源 49, 72] ---
                { id: "2a", max: 2, tid: "1.5.1", detail: "應用波義耳定律計算特定水深（壓強）下可提供的空氣總體積 [2]" },
                { id: "2bi", max: 1, tid: "1.5.1", detail: "計算在特定時間內的空氣消耗率 V0 [2]" },
                { id: "2bii", max: 3, tid: "1.5.1", detail: "結合壓強與溫度變化，估算水肺空氣在深水處的維持時間 [2]" },
            
                // --- 第 3 題：雜技飛人（拋體運動與機械能） [來源 50, 71] ---
                { id: "3a", max: 3, tid: "2.6.3", detail: "應用能量守恆定律計算雜技飛人盪至最低點 B 時的速度 [1]" },
                { id: "3bi", max: 2, tid: "2.8.2", detail: "利用水平匀速運動分量計算飛人放手後到達平台 C 的水平距離 [1]" },
                { id: "3bii", max: 3, tid: "2.8.2", detail: "利用垂直勻加速運動分量計算平台 C 與 B 點之間的垂直距離 [1]" },
                { id: "3c", max: 1, tid: "2.6.3", detail: "判定物體在整個運動過程中的總機械能是否守恆 [1]" },
            
                // --- 第 4 題：方塊在斜面上運動（力學線圖） [來源 51, 52, 72] ---
                { id: "4a", max: 2, tid: "2.2.2", detail: "根據 v-t 圖描述方塊由推動至滑下斜面的完整運動過程 [2]" },
                { id: "4bi", max: 2, tid: "2.1.3", detail: "從 v-t 圖斜率計算方塊在特定時間段內的加速度量值 [2]" },
                { id: "4bii", max: 2, tid: "2.2.2", detail: "根據速度變化繪畫對應的加速度-時間 (a-t) 關係圖 [2]" },
                { id: "4c", max: 2, tid: "2.3.1", detail: "繪畫受力隔離體圖 (FBD) 顯示方塊在斜面上行時的受力情況 [2]" },
                { id: "4d", max: 3, tid: "2.3.3", detail: "應用牛頓第二定律 (F=ma) 結合兩個階段的加速度計算摩擦力量值 [3]" },
            
                // --- 第 5 題：火車加速度測量實驗 [來源 53, 73] ---
                { id: "5", max: 6, tid: "2.3.3", detail: "描述使用量角器、懸掛金屬球測量火車加速度的方法及數學推導 (a=g tanθ) [3]" },
            
                // --- 第 6 題：公路上的海市蜃樓 [來源 53, 54, 73] ---
                { id: "6a", max: 1, tid: "3.2.2", detail: "指出觀察到海市蜃樓所需的氣溫梯度或全內反射條件 [3]" },
                { id: "6bi", max: 3, tid: "3.2.1", detail: "根據 Snell's Law 推導層狀空氣折射率與入射角之間的比例關係 [3]" },
                { id: "6bii", max: 2, tid: "3.2.1", detail: "結合幾何條件與折射定律計算光線偏折的水平距離 L [4]" },
                { id: "6c", max: 2, tid: "3.2.2", detail: "解釋為何旅客前行時，「水源」虛像始終與其保持恆定距離 [4]" },
            
                // --- 第 7 題：波動干涉現象 [來源 54, 55, 74] ---
                { id: "7a", max: 2, tid: "3.6.2", detail: "應用楊氏雙縫干涉公式 Δy=λD/a 計算亮紋間距 [4]" },
                { id: "7b", max: 2, tid: "3.5.3", detail: "解釋為何兩枚獨立 LED 燈在屏幕上不會產生干涉圖樣（相干源概念） [4]" },
                { id: "7c", max: 3, tid: "3.5.3", detail: "在水波槽干涉圖中繪畫波腹線並判定相長干涉點 [4]" },
                { id: "7di", max: 1, tid: "3.4.4", detail: "根據標度從圖表中讀取並計算相鄰波腹線的間距 [4]" },
                { id: "7dii", max: 2, tid: "3.5.3", detail: "分析小角度近似前提不成立時，對估計條紋間距準確度的影響 [4]" },
            
                // --- 第 8 題：高壓輸電與變壓器 [來源 55, 56, 74] ---
                { id: "8ai", max: 2, tid: "4.2.3", detail: "利用電阻率公式計算輸電電線每公里的電阻 [4]" },
                { id: "8aii", max: 2, tid: "4.2.4", detail: "解釋多股並聯連接如何有效減低輸電電纜的總電阻 [4]" },
                { id: "8aiii", max: 2, tid: "4.4.2", detail: "以分流原理分析為何小鳥站在高壓電纜上不會觸電 [4]" },
                { id: "8bi", max: 2, tid: "4.2.5", detail: "根據輸電功率與電壓計算架空電纜上的電流 [5]" },
                { id: "8bii", max: 2, tid: "4.2.5", detail: "計算總長度下的功率損耗並證明其百分比低於 0.1% [5]" },
                { id: "8biii(I)", max: 1, tid: "4.8.1", detail: "利用匝數比 (Np/Ns) 計算理想變壓器的輸出電壓 [5]" },
                { id: "8biii(II)", max: 2, tid: "4.8.1", detail: "指出導致變壓器能量損耗的因素（如渦電流）及其改善方法 [5]" },
            
                // --- 第 9 題：旋轉金屬棒與磁場力 [來源 56, 57, 75] ---
                { id: "9a", max: 3, tid: "4.6.1", detail: "根據左手定則判定金屬棒受力方向並描述其隨後的循環運動 [5]" },
                { id: "9bi", max: 2, tid: "2.5.1", detail: "應用力矩公式 (Moment = F x d) 從給定數據反求作用於金屬棒的磁力 [5]" },
                { id: "9bii", max: 2, tid: "4.6.1", detail: "根據 F=BIl 公式計算勻強磁場的強度 B [6]" },
                { id: "9ci", max: 1, tid: "4.5.1", detail: "草繪磁棒在金屬棒周圍產生的磁場力線圖樣 [6]" },
                { id: "9cii", max: 1, tid: "4.7.1", detail: "描述金屬棒在磁棒磁場作用下，通電後的旋轉運動模式 [6]" },
            
                // --- 第 10 題：核聚變與能量釋放 [來源 58, 60, 76] ---
                { id: "10a", max: 2, tid: "5.3.2", detail: "根據質量虧損 (Mass defect) 計算核聚變反應釋放的能量 (MeV) [6]" },
                { id: "10bi", max: 2, tid: "4.1.2", detail: "解釋為何需要作功來克服原子核間的靜電斥力並將其轉化為電勢能 [6]" },
                { id: "10bii", max: 1, tid: "1.2.1", detail: "解釋核聚變需要極高溫度以克服排斥力的物理原因 [6]" },
                { id: "10biii", max: 2, tid: "1.5.2", detail: "利用平均動能公式估算進行聚變所需最低溫度的數量級 [7]" }
            ],
            // --- Elective Section C : Energy and Use of Energy (能量和能源的使用) ---
            "2015_2_E3": {
                1: { tid: "E3.2.2", detail: "計算單一光源在地面特定點產生的照明度 (Lux) [16]" },
                2: { tid: "E3.4.1", detail: "判定太陽能電池內部電荷流動與能量轉換的正確順序 [18]" },
                3: { tid: "E3.4.1", detail: "估算衛星太陽能電池板在特定照射角下的電功率輸出 [18]" },
                4: { tid: "E3.1.1", detail: "計算煤電廠經傳輸損耗後供應予白熾燈的最終能源效益 [18]" },
                5: { tid: "E3.3.1", detail: "根據吸收百分率選擇符合建築能源效益的窗戶玻璃種類 [18]" },
                6: { tid: "E3.3.1", detail: "分析雙層隔牆材料對降低熱傳導速率及温差變化的影響 [18]" },
                7: { tid: "E3.1.3", detail: "利用抽水蓄能系統數據計算儲水庫所需的最少容量 [18]" },
                8: { tid: "E3.4.1", detail: "指出核裂變反應堆中減速劑 (Moderator) 的具體功能 [18]" }
            },
            "2015_2_E3_LQ": [
                { id: "3ai", max: 2, tid: "1.3.2", detail: "利用熱容量公式計算空調系統移走房間熱量所需的時間 [17]" },
                { id: "3aii", max: 1, tid: "E3.3.1", detail: "列舉導致房間冷卻時間長於理論計算值的實際物理因素 [19, 20]" },
                { id: "3bi", max: 1, tid: "E3.1.3", detail: "計算空調機運作時的輸入電功率 [19]" },
                { id: "3bii", max: 3, tid: "E3.1.3", detail: "計算冷氣機的性能係數 (COP) 並解釋其能量轉換含義 [19, 20]" },
                { id: "3ci", max: 2, tid: "E3.1.3", detail: "標示逆循環空調機在制熱模式下製冷劑的流動方向 [19, 20]" },
                { id: "3cii", max: 1, tid: "E3.1.3", detail: "解釋逆循環空調機與淨冷式空調機在結構上的主要區別 [8]" }
            ],
            
            // --- Elective Section D : Medical Physics (醫學物理學) ---
            "2015_2_E4": {
                1: { tid: "E4.1.2", detail: "計算遠視眼佩戴矯正透鏡後所需的焦強 (Dioptre) [4]" },
                2: { tid: "E4.2.1", detail: "分析人耳對不同頻率聲音的聽覺反應與聲強級關係 [4]" },
                3: { tid: "E4.2.3", detail: "辨識超聲波 B-掃描中探頭、凝膠與皮膚界面的物理作用 [4]" },
                4: { tid: "E4.3.3", detail: "選擇最適合器官放射性核素成像的示蹤物（考慮半衰期與射線種類） [4]" },
                5: { tid: "E4.3.1", detail: "計算 X 射線穿過人體組織後的強度衰減比例 [6]" },
                6: { tid: "E4.3.2", detail: "指出 CT 掃描相比常規 X 射線造影在解像力上的優點 [6]" },
                7: { tid: "E4.1.3", detail: "分析內窺鏡中相干光纖管束損壞對影像質量的影響 [6]" },
                8: { tid: "E4.3.4", detail: "比較不同醫學診斷方法（如 X 射線、超聲波）的輻射風險 [6]" }
            },
            "2015_2_E4_LQ": [
                { id: "4ai", max: 2, tid: "E4.2.1", detail: "配對人耳結構（如耳膜、耳蝸）並說明其功能 [4, 6]" },
                { id: "4aii", max: 1, tid: "E4.2.1", detail: "計算中耳聽小骨系統產生的壓力增益百分比 [6]" },
                { id: "4bi", max: 2, tid: "E4.2.1", detail: "指出正常人聽覺閾曲線圖中縱座標的物理意義 [6]" },
                { id: "4bii", max: 3, tid: "E4.2.1", detail: "分析長期受噪音環境影響的人士聽覺閾曲線的特徵變化 [6, 19]" },
                { id: "4ci", max: 3, tid: "E4.2.1", detail: "應用對數標度公式 L = 10 log(I/I0) 計算耳罩減低的聲強級 [19]" }
            ]
        };

        const YEAR_OPTIONS = Array.from({length: 12}, (_, i) => 2025 - i);

        const App = () => {
            const [view, setView] = useState('students');
            const [students, setStudents] = useState([]);
            const [records, setRecords] = useState([]);
            // New State for Generation History
            const [genHistory, setGenHistory] = useState([]);

            const [answerKeys, setAnswerKeys] = useState(() => {
                const saved = localStorage.getItem('dsePhysV7');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        const savedKeys = parsed.answerKeys || {};
                        return { ...savedKeys, ...PRELOADED_KEYS }; 
                    } catch(e) { return PRELOADED_KEYS; }
                }
                return PRELOADED_KEYS;
            });

            // UI State
            const [inputForm, setInputForm] = useState({ studentId: '', year: '2016', paper: '1A', answers: {}, scores: {} });
            const [dashStudent, setDashStudent] = useState('');
            const [dashPaperType, setDashPaperType] = useState('core'); 
            
            // AI Settings
            const [genSettings, setGenSettings] = useState({ difficulty: 'medium', type: 'mixed', lang: 'zh' });
            const [selectedTopics, setSelectedTopics] = useState([]);
            const [generatedPrompt, setGeneratedPrompt] = useState('');

            // Load Data
            useEffect(() => {
                const saved = localStorage.getItem('dsePhysV7');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        setStudents(data.students || []);
                        setRecords(data.records || []);
                        setGenHistory(data.genHistory || []); // Load History
                        if(data.students?.[0]) setDashStudent(data.students[0].id);
                    } catch(e) {}
                }
            }, []);

            // Save Data
            useEffect(() => {
                localStorage.setItem('dsePhysV7', JSON.stringify({ 
                    students, 
                    answerKeys, 
                    records,
                    genHistory // Save History
                }));
            }, [students, answerKeys, records, genHistory]);

// [MODIFIED V2] 讀取 Topic Info (支援 MC 和 LQ 的 Detail)
            const getTopicInfo = (year, paper, qNum) => {
                let mapKeyMC = `${year}_${paper}`;
                let mapKeyLQ = `${year}_${paper}`;
                if (paper.includes('2_')) mapKeyLQ = `${year}_${paper}_LQ`;

                const mapDataMC = FULL_QUESTION_MAP[mapKeyMC];
                const mapDataLQ = FULL_QUESTION_MAP[mapKeyLQ];
                
                let topicId = null;
                let specificDetail = null; // 儲存具體弱點描述

                // --- 處理 MC (Paper 1A 或 Paper 2 前8題) ---
                if (paper === '1A' || (paper.includes('2_') && !isNaN(qNum) && parseInt(qNum) <= 8)) {
                    if (mapDataMC && mapDataMC[qNum]) {
                        const rawData = mapDataMC[qNum];
                        
                        // 判斷格式：是物件 {tid, detail} 還是純字串 "1.2.3"
                        if (typeof rawData === 'object') {
                            topicId = rawData.tid;
                            specificDetail = rawData.detail;
                        } else {
                            topicId = rawData; // 舊格式，只有 ID
                        }
                    }
                } 
                // --- 處理 LQ (Paper 1B 或 Paper 2 LQ) ---
                else {
                    if (Array.isArray(mapDataLQ)) {
                        const qItem = mapDataLQ.find(item => item.id === qNum);
                        if (qItem) {
                            topicId = qItem.tid;
                            specificDetail = qItem.detail; // 讀取 LQ 的 detail
                        }
                    }
                }

                // 如果找不到 Topic ID，使用 Hash 算法隨機分配一個 (防止報錯)
                if (!topicId) {
                    const ids = Object.keys(SYLLABUS_DATA);
                    const hash = String(qNum).split('').reduce((a,b)=>a+b.charCodeAt(0),0);
                    topicId = ids[hash % ids.length];
                }
                
                const topicData = SYLLABUS_DATA[topicId] || { section: 'Gen', topic: `Topic ${topicId}`, desc: 'Unknown' };
                
                // 返回完整的資訊
                return { id: topicId, ...topicData, detail: specificDetail };
            };

            const Sidebar = () => (
                <div className="w-64 bg-slate-900 text-white h-screen fixed left-0 top-0 flex flex-col shadow-2xl z-10">
                    <div className="p-6 border-b border-slate-700">
                        <h1 className="text-xl font-bold tracking-wider italic">PHY MASTER</h1>
                        <div className="text-xs text-orange-400 mt-1">V7.3.0 History Added</div>
                    </div>
                    <nav className="p-4 space-y-2 flex-1 overflow-y-auto">
                        {[
                            {id: 'students', icon: '👥', label: '學生管理'},
                            {id: 'input', icon: '📝', label: '輸入成績'},
                            {id: 'dashboard', icon: '📊', label: '診斷報告'},
                            {id: 'generate', icon: '🤖', label: 'AI 練習生成'},
                            {id: 'history', icon: '📜', label: '生成紀錄'}, // New Item
                            {id: 'data', icon: '💾', label: '數據備份 (Data)'} 
                        ].map(item => (
                            <button key={item.id} onClick={() => setView(item.id)}
                                className={`w-full flex items-center gap-3 px-4 py-3 rounded transition-all ${view===item.id ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <span>{item.icon}</span> {item.label}
                            </button>
                        ))}
                    </nav>
                </div>
            );

            // ==========================
            // Data Management View
            // ==========================
            const DataView = () => {
                const fileInputRef = useRef(null);

                const handleExport = () => {
                    const data = {
                        version: "7.3.0",
                        timestamp: new Date().toISOString(),
                        students,
                        answerKeys,
                        records,
                        genHistory // Included in backup
                    };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = `PHY_MASTER_BACKUP_${new Date().toISOString().slice(0,10)}.json`;
                    a.click();
                };

                const handleImport = (e) => {
                    const file = e.target.files[0];
                    if(!file) return;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if(confirm(`確認從檔案導入數據嗎？\n這將覆蓋現有數據！\n(包含 ${data.students?.length||0} 位學生, ${data.records?.length||0} 筆成績)`)) {
                                if(data.students) setStudents(data.students);
                                if(data.answerKeys) setAnswerKeys(prev => ({...prev, ...data.answerKeys}));
                                if(data.records) setRecords(data.records);
                                if(data.genHistory) setGenHistory(data.genHistory); // Import History
                                alert("✅ 導入成功！");
                            }
                        } catch(err) {
                            alert("❌ 檔案格式錯誤");
                        }
                    };
                    reader.readAsText(file);
                };

                return (
                    <div className="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6 text-slate-800">💾 數據備份與還原</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className="p-6 border-2 border-dashed border-blue-200 rounded-xl bg-blue-50 flex flex-col items-center justify-center text-center">
                                <span className="text-4xl mb-4">📤</span>
                                <h3 className="text-xl font-bold text-slate-700 mb-2">導出數據 (Export)</h3>
                                <p className="text-sm text-slate-500 mb-4">將所有學生、成績、答案設定及<b>生成紀錄</b>下載為 JSON 檔案。</p>
                                <button onClick={handleExport} className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow transition">
                                    下載備份檔案
                                </button>
                            </div>

                            <div className="p-6 border-2 border-dashed border-orange-200 rounded-xl bg-orange-50 flex flex-col items-center justify-center text-center">
                                <span className="text-4xl mb-4">📥</span>
                                <h3 className="text-xl font-bold text-slate-700 mb-2">導入數據 (Import)</h3>
                                <p className="text-sm text-slate-500 mb-4">從電腦上傳 JSON 檔案以還原數據。</p>
                                <input type="file" accept=".json" ref={fileInputRef} onChange={handleImport} className="hidden" />
                                <button onClick={()=>fileInputRef.current.click()} className="bg-orange-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-orange-600 shadow transition">
                                    選擇檔案上傳
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const StudentsView = () => {
                const [name, setName] = useState('');
                const add = () => {
                    if(!name) return;
                    setStudents([...students, { id: Date.now().toString(), name, joinDate: new Date().toLocaleDateString() }]);
                    setName('');
                };
                return (
                    <div className="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6 text-slate-800">👥 學生檔案</h2>
                        <div className="flex gap-4 mb-8">
                            <input className="flex-1 border p-3 rounded-lg outline-none focus:border-blue-500" placeholder="學生姓名" value={name} onChange={e=>setName(e.target.value)} />
                            <button onClick={add} className="bg-blue-600 text-white px-8 rounded-lg font-bold hover:bg-blue-700">新增</button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {students.map(s => (
                                <div key={s.id} className="p-4 border rounded-lg bg-slate-50 flex justify-between">
                                    <span className="font-bold">{s.name}</span>
                                    <button onClick={()=>{setStudents(students.filter(x=>x.id!==s.id)); setRecords(records.filter(r=>r.studentId!==s.id))}} className="text-red-400 hover:text-red-600">刪除</button>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const InputView = () => {
                const { studentId, year, paper } = inputForm;
                const keyId = `${year}_${paper}`;
                const sysKey = answerKeys[keyId] || {};
                
                let lqConfig = null;
                if (paper === '1B') lqConfig = FULL_QUESTION_MAP[`${year}_1B`];
                else if (paper.includes('2_')) lqConfig = FULL_QUESTION_MAP[`${year}_${paper}_LQ`];

                useEffect(() => {
                    if (!studentId && students.length > 0) setInputForm(prev => ({ ...prev, studentId: students[0].id }));
                }, [students]);

                const toggleMC = (q, opt) => {
                    const isCorrect = sysKey[q] === opt;
                    setInputForm({
                        ...inputForm, 
                        answers: {...inputForm.answers, [q]: opt},
                        scores: {...inputForm.scores, [q]: isCorrect ? 1 : 0}
                    });
                };

                const updateScore = (qKey, val, max) => {
                    let numVal = parseFloat(val);
                    if(val === '') numVal = ''; 
                    else if(numVal < 0) numVal = 0;
                    else if(numVal > max) numVal = max;
                    setInputForm({ ...inputForm, scores: {...inputForm.scores, [qKey]: numVal} });
                };

                const save = () => {
                    if(!studentId) return alert('請選擇學生');
                    const newRec = { ...inputForm, id: Date.now(), timestamp: new Date().toISOString() };
                    const others = records.filter(r => !(r.studentId===studentId && r.year==year && r.paper===paper));
                    setRecords([...others, newRec]);
                    alert('✅ 已儲存');
                };

                const showMC = paper === '1A' || paper.includes('2_');
                const mcCount = paper === '1A' ? 33 : 8;
                const showLQ = paper === '1B' || paper.includes('2_');

                return (
                    <div className="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6">📝 輸入成績</h2>
                        <div className="grid grid-cols-3 gap-4 mb-6 bg-blue-50 p-4 rounded-lg">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">學生</label>
                                <select className="w-full border p-2 rounded" value={studentId} onChange={e=>setInputForm({...inputForm, studentId:e.target.value})}>
                                    <option value="">-- 請選擇 --</option>
                                    {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">年份</label>
                                <select className="w-full border p-2 rounded" value={year} onChange={e=>setInputForm({...inputForm, year:e.target.value, answers:{}, scores:{}})}>
                                    {YEAR_OPTIONS.map(y => <option key={y} value={y}>{y}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">試卷</label>
                                <select className="w-full border p-2 rounded font-bold" value={paper} onChange={e=>setInputForm({...inputForm, paper:e.target.value, answers:{}, scores:{}})}>
                                    <optgroup label="Core (必修)">
                                        <option value="1A">Paper 1A (MC)</option>
                                        <option value="1B">Paper 1B (LQ)</option>
                                    </optgroup>
                                    <optgroup label="Electives (選修 Paper 2)">
                                        <option value="2_E3">E3 - Energy (MC+LQ)</option>
                                        <option value="2_E4">E4 - Medical (MC+LQ)</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        
                        {showMC && (
                            <div className="mb-8">
                                <h3 className="font-bold text-slate-600 mb-3 border-b pb-2">MC 部份 (Q1-{mcCount})</h3>
                                {Object.keys(sysKey).length === 0 && <div className="text-red-500 text-xs mb-2">⚠ 注意：此年份/試卷尚未設定標準答案，系統無法自動評分。</div>}
                                <div className={`grid gap-3 ${paper==='1A'?'grid-cols-2 md:grid-cols-4':'grid-cols-2 md:grid-cols-4'}`}>
                                    {Array.from({length: mcCount}).map((_, i) => {
                                        const q = i+1;
                                        const myAns = inputForm.answers[q];
                                        const realAns = sysKey[q];
                                        let statusClass = "border-slate-200";
                                        if(myAns && realAns) statusClass = myAns===realAns ? "bg-green-50 border-green-300" : "bg-red-50 border-red-300";

                                        return (
                                            <div key={q} className={`p-2 border rounded flex flex-col ${statusClass}`}>
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="font-bold text-slate-500">Q{q}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    {['A','B','C','D'].map(opt => (
                                                        <button key={opt} onClick={()=>toggleMC(q, opt)} 
                                                            className={`w-6 h-6 text-xs rounded font-bold ${myAns===opt?'bg-slate-800 text-white':'bg-white text-slate-400 border'}`}>
                                                            {opt}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        )}

                        {showLQ && (
                            <div>
                                <h3 className="font-bold text-slate-600 mb-3 border-b pb-2">長題目部份 (LQ)</h3>
                                {lqConfig ? (
                                    <div className="grid grid-cols-3 md:grid-cols-5 gap-4">
                                        {lqConfig.map((item) => (
                                            <div key={item.id} className="flex flex-col">
                                                <div className="flex justify-between items-end mb-1">
                                                    <span className="text-sm font-bold text-slate-700">Q{item.id}</span>
                                                    <span className="text-[10px] text-slate-400 bg-slate-100 px-1 rounded">/{item.max}</span>
                                                </div>
                                                <input type="number" className="border p-2 rounded text-center focus:ring-2 focus:ring-blue-500 outline-none"
                                                    value={inputForm.scores[item.id] ?? ''}
                                                    onChange={e => updateScore(item.id, e.target.value, item.max)}
                                                />
                                                <span className="text-[9px] text-center text-slate-300 mt-1 truncate" title={item.tid}>{item.tid}</span>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="text-sm text-yellow-600 bg-yellow-50 p-2 rounded">
                                        此年份 ({year}) 尚未載入詳細題目地圖。
                                    </div>
                                )}
                            </div>
                        )}

                        <button onClick={save} className="w-full mt-6 bg-slate-800 text-white py-3 rounded font-bold hover:bg-slate-700 shadow-lg">儲存成績</button>
                    </div>
                );
            };

            const DashboardView = () => {
                useEffect(() => {
                    if (!dashStudent && students.length > 0) setDashStudent(students[0].id);
                }, [students, dashStudent]);

                const subTopicStats = useMemo(() => {
                    if(!dashStudent) return [];
                    const myRecs = records.filter(r => {
                        if (r.studentId !== dashStudent) return false;
                        const isPaper1 = r.paper === '1A' || r.paper === '1B';
                        return dashPaperType === 'core' ? isPaper1 : !isPaper1;
                    });

                    const stats = {};
                    myRecs.forEach(r => {
                        Object.entries(r.scores).forEach(([q, score]) => {
                            const numericScore = parseFloat(score) || 0;
                            const info = getTopicInfo(r.year, r.paper, q);
                            const tid = info.id;
                            
                            if(!stats[tid]) stats[tid] = { ...info, earned: 0, max: 0, count: 0 };
                            
                            stats[tid].earned += numericScore;
                            let qMax = 0;
                            if (r.paper === '1A') qMax = 1;
                            else if (r.paper.includes('2_') && !isNaN(q) && parseInt(q)<=8) qMax = 1;
                            else {
                                let mapKeyLQ = r.paper === '1B' ? `${r.year}_1B` : `${r.year}_${r.paper}_LQ`;
                                const lqList = FULL_QUESTION_MAP[mapKeyLQ];
                                if(Array.isArray(lqList)) {
                                    const qItem = lqList.find(i => i.id === q);
                                    qMax = qItem ? qItem.max : 10;
                                } else qMax = 10;
                            }
                            stats[tid].max += qMax;
                            stats[tid].count++;
                        });
                    });

                    return Object.values(stats).sort((a,b) => {
                        const pctA = a.max > 0 ? (a.earned/a.max) : 0;
                        const pctB = b.max > 0 ? (b.earned/b.max) : 0;
                        return pctA - pctB;
                    });
                }, [records, dashStudent, dashPaperType]);

                const weakestList = subTopicStats.slice(0, 50); 
                const strongestList = [...subTopicStats].reverse().slice(0, 50);

                return (
                    <div className="max-w-6xl mx-auto space-y-6">
                        <div className="bg-white p-4 rounded-xl shadow-sm flex flex-col md:flex-row justify-between items-center gap-4">
                            <h2 className="text-xl font-bold">📊 子課題診斷報告</h2>
                            
                            <div className="flex gap-4 items-center">
                                <div className="bg-slate-100 p-1 rounded-lg flex font-bold text-sm">
                                    <button onClick={()=>setDashPaperType('core')} className={`px-4 py-2 rounded-md transition ${dashPaperType==='core'?'bg-white text-blue-600 shadow':'text-slate-400'}`}>Paper 1 (Core)</button>
                                    <button onClick={()=>setDashPaperType('elective')} className={`px-4 py-2 rounded-md transition ${dashPaperType==='elective'?'bg-white text-purple-600 shadow':'text-slate-400'}`}>Paper 2 (Electives)</button>
                                </div>
                                <select className="border p-2 rounded" value={dashStudent} onChange={e=>setDashStudent(e.target.value)}>
                                    {students.length === 0 && <option value="">無學生資料</option>}
                                    {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                            </div>
                        </div>

                        {subTopicStats.length === 0 ? (
                            <div className="p-12 text-center text-slate-400 bg-white rounded-xl">
                                {students.length === 0 ? "請先新增學生" : "暫無此類別的成績數據。"}
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-[70vh]">
                                <div className="bg-white p-4 rounded-xl shadow-sm border-t-4 border-red-500 flex flex-col h-full">
                                    <h3 className="font-bold text-lg mb-4 text-red-600 flex items-center gap-2 flex-shrink-0">
                                        <span className="text-2xl">⚠</span> 待改善 (Weakest)
                                    </h3>
                                    <div className="stats-list space-y-3 flex-1">
                                        {weakestList.map(t => (
                                            <div key={t.id} className="p-3 bg-red-50 border border-red-100 rounded-lg flex justify-between items-center">
                                                <div className="overflow-hidden">
                                                    <div className="flex items-center gap-2">
                                                        <span className="sub-topic-tag bg-white text-red-600 px-1 border border-red-200 rounded text-sm">{t.id}</span>
                                                        <span className="font-bold text-slate-800 truncate">{t.topic}</span>
                                                    </div>
                                                    <div className="text-xs text-slate-500 mt-1 pl-1 truncate">{t.desc}</div>
                                                </div>
                                                <div className="text-right flex-shrink-0 ml-2">
                                                    <div className="text-xl font-bold text-red-600">{((t.earned/t.max)*100).toFixed(0)}%</div>
                                                    <div className="text-[10px] text-slate-400">{t.count} 題</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-white p-4 rounded-xl shadow-sm border-t-4 border-green-500 flex flex-col h-full">
                                    <h3 className="font-bold text-lg mb-4 text-green-600 flex items-center gap-2 flex-shrink-0">
                                        <span className="text-2xl">★</span> 表現優異 (Strongest)
                                    </h3>
                                    <div className="stats-list space-y-3 flex-1">
                                        {strongestList.map(t => (
                                            <div key={t.id} className="p-3 bg-green-50 border border-green-100 rounded-lg flex justify-between items-center">
                                                <div className="overflow-hidden">
                                                    <div className="flex items-center gap-2">
                                                        <span className="sub-topic-tag bg-white text-green-600 px-1 border border-green-200 rounded text-sm">{t.id}</span>
                                                        <span className="font-bold text-slate-800 truncate">{t.topic}</span>
                                                    </div>
                                                </div>
                                                <div className="text-xl font-bold text-green-600 flex-shrink-0 ml-2">{((t.earned/t.max)*100).toFixed(0)}%</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const GenerateView = () => {
                const [studentStats, setStudentStats] = useState({});

                useEffect(() => {
                    if (!dashStudent) return;
                    const myRecs = records.filter(r => r.studentId === dashStudent);
                    const stats = {};
                    Object.keys(SYLLABUS_DATA).forEach(tid => {
                        stats[tid] = { earned: 0, max: 0 };
                    });

                    myRecs.forEach(r => {
                        Object.entries(r.scores).forEach(([q, score]) => {
                            const numericScore = parseFloat(score) || 0;
                            const info = getTopicInfo(r.year, r.paper, q);
                            const tid = info.id;
                            
                            let qMax = 0;
                            if (r.paper === '1A' || (r.paper.includes('2_') && parseInt(q)<=8)) qMax = 1;
                            else {
                                let mapKeyLQ = r.paper === '1B' ? `${r.year}_1B` : `${r.year}_${r.paper}_LQ`;
                                const lqList = FULL_QUESTION_MAP[mapKeyLQ];
                                if(Array.isArray(lqList)) {
                                    const qItem = lqList.find(i => i.id === q);
                                    qMax = qItem ? qItem.max : 10;
                                } else qMax = 10;
                            }

                            if(stats[tid]) {
                                stats[tid].earned += numericScore;
                                stats[tid].max += qMax;
                            }
                        });
                    });
                    setStudentStats(stats);
                }, [dashStudent, records]);

                const toggleTopic = (tid) => {
                    if (selectedTopics.includes(tid)) setSelectedTopics(selectedTopics.filter(t => t !== tid));
                    else setSelectedTopics([...selectedTopics, tid]);
                };

                const toggleAll = () => {
                    if (selectedTopics.length === Object.keys(SYLLABUS_DATA).length) setSelectedTopics([]);
                    else setSelectedTopics(Object.keys(SYLLABUS_DATA));
                };

               // [MODIFIED] 生成函數，加入 detail 處理
                const generate = () => {
                    if (!dashStudent) return alert("請先選擇學生");
                    if (selectedTopics.length === 0) return alert("請至少選擇一個課題");

                    // 1. 收集學生在選定課題中的「具體弱項 (Details)」
                    const myRecs = records.filter(r => r.studentId === dashStudent);
                    let weakConcepts = [];

                    myRecs.forEach(r => {
                        Object.entries(r.scores).forEach(([q, score]) => {
                            const info = getTopicInfo(r.year, r.paper, q);
                            // 如果這題屬於我們選定的課題，且有具體描述 (detail)
                            if (selectedTopics.includes(info.id) && info.detail) {
                                const earned = parseFloat(score) || 0;
                                // 判斷滿分 (如果是 MC 則為 1，LQ 查表)
                                let max = 1; 
                                if (r.paper !== '1A' && !r.paper.includes('2_') || (r.paper.includes('2_') && isNaN(q))) {
                                     // 簡易邏輯：如果能查到 max 就用，查不到預設 10 (防止除以0)
                                     // 這裡為了簡化，只要拿不到滿分就算弱項
                                     // 您可以根據需要調整閾值，例如得分率 < 50%
                                }
                                
                                // 邏輯：如果這一題沒拿滿分 (或得分率低)，就將 detail 加入弱項列表
                                // 這裡假設：只要有扣分，就值得複習
                                // 若要嚴格一點，可以去查 map 裡的 max score，這裡簡化處理
                                if (earned === 0 || (earned < 2)) { // 假設 MC錯 或 LQ 低分
                                    weakConcepts.push(`- [${info.id}] ${info.detail}`);
                                }
                            }
                        });
                    });

                    // 去除重複的 Weak Concepts
                    weakConcepts = [...new Set(weakConcepts)].slice(0, 8); // 最多取 8 個具體弱點以免 Prompt 太長

                    const topicListText = selectedTopics.sort().map(tid => {
                        const s = studentStats[tid] || {earned:0, max:0};
                        const pct = s.max > 0 ? Math.round((s.earned / s.max) * 100) + '%' : 'No Data';
                        return `- [${tid}] ${SYLLABUS_DATA[tid].topic} (Score: ${pct})`;
                    }).join('\n');

                    const difficultyMap = { low: 'Foundation/Easy', medium: 'Standard HKDSE', high: 'Challenging/5**' };
                    const typeMap = { mc: 'Multiple Choice (MC) ONLY', lq: 'Long Questions (LQ) ONLY', mixed: 'Mixed (MC & LQ)' };
                    const langMap = { zh: 'Traditional Chinese (繁體中文)', en: 'English' };

                    // [MODIFIED] Prompt Template
                    const prompt = `
Role: Professional HKDSE Physics Tutor.
Task: Create a practice exercise.

**Configuration:**
- **Level:** HKDSE Physics
- **Difficulty:** ${difficultyMap[genSettings.difficulty]}
- **Format:** ${typeMap[genSettings.type]}
- **Language:** ${langMap[genSettings.lang]}

**Targeted Topics:**
${topicListText}

**Specific Weakness Concepts (CRITICAL):**
The student has previously failed questions involving these specific concepts. 
**Please ensure ~20% of the new questions specifically target these misconceptions:**
${weakConcepts.length > 0 ? weakConcepts.join('\n') : "(General practice on topics above)"}

**Requirements:**
1. Generate distinctive questions for the selected topics.
2. Integrate the "Specific Weakness Concepts" into the questions where natural.
3. Provide a Marking Scheme with detailed explanations.
4. If MC, provide 4 options (A,B,C,D).
`.trim();

                    setGeneratedPrompt(prompt);

                    // Save History
                    const sName = students.find(s=>s.id === dashStudent)?.name || "Unknown";
                    const newHistoryItem = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        studentId: dashStudent,
                        studentName: sName,
                        topics: selectedTopics,
                        settings: genSettings,
                        note: `Weaknesses: ${weakConcepts.length} items targeted.`
                    };
                    setGenHistory(prev => [newHistoryItem, ...prev]);
                    alert("Prompt 生成成功 (包含針對性弱點)！");
                };
                
                const sortedTopicKeys = Object.keys(SYLLABUS_DATA).sort((a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' }));

                return (
                    <div className="max-w-6xl mx-auto flex gap-6 h-[85vh]">
                        <div className="w-5/12 bg-white p-5 rounded-xl shadow-sm flex flex-col h-full border border-slate-200">
                            <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-slate-700">🛠️ 生成設定 (Settings)</h2>
                            <div className="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">目標學生</label>
                                    <select className="w-full border p-2 rounded text-sm bg-slate-50" value={dashStudent} onChange={e=>setDashStudent(e.target.value)}>
                                        {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">語言 (Lang)</label>
                                    <select className="w-full border p-2 rounded text-sm" value={genSettings.lang} onChange={e=>setGenSettings({...genSettings, lang:e.target.value})}>
                                        <option value="zh">繁體中文</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">難度 (Difficulty)</label>
                                    <select className="w-full border p-2 rounded text-sm" value={genSettings.difficulty} onChange={e=>setGenSettings({...genSettings, difficulty:e.target.value})}>
                                        <option value="low">低 (基礎鞏固)</option>
                                        <option value="medium">中 (DSE 標準)</option>
                                        <option value="high">高 (5** 挑戰)</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">題型 (Type)</label>
                                    <select className="w-full border p-2 rounded text-sm" value={genSettings.type} onChange={e=>setGenSettings({...genSettings, type:e.target.value})}>
                                        <option value="mixed">MC + LQ (混合)</option>
                                        <option value="mc">MC Only</option>
                                        <option value="lq">LQ Only</option>
                                    </select>
                                </div>
                            </div>
                            <div className="flex-1 flex flex-col min-h-0 border rounded-lg bg-slate-50">
                                <div className="p-2 border-b bg-slate-100 flex justify-between items-center">
                                    <span className="text-xs font-bold text-slate-600">選擇課題 ({selectedTopics.length})</span>
                                    <button onClick={toggleAll} className="text-xs text-blue-600 hover:underline">{selectedTopics.length === sortedTopicKeys.length ? '全不選' : '全選'}</button>
                                </div>
                                <div className="overflow-y-auto p-2 space-y-1 flex-1">
                                    {sortedTopicKeys.map(tid => {
                                        const s = studentStats[tid] || {earned:0, max:0};
                                        const hasData = s.max > 0;
                                        const pct = hasData ? Math.round((s.earned / s.max) * 100) : 0;
                                        let scoreColor = 'text-slate-400';
                                        if (hasData) {
                                            if (pct < 40) scoreColor = 'text-red-500 font-bold';
                                            else if (pct < 70) scoreColor = 'text-yellow-600 font-bold';
                                            else scoreColor = 'text-green-600 font-bold';
                                        }

                                        return (
                                            <label key={tid} className="flex items-center gap-2 p-2 hover:bg-white rounded cursor-pointer border border-transparent hover:border-slate-200">
                                                <input type="checkbox" checked={selectedTopics.includes(tid)} onChange={() => toggleTopic(tid)} className="w-4 h-4 rounded text-blue-600" />
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-xs font-mono font-bold text-slate-700">{tid}</span>
                                                        <span className={`text-xs ${scoreColor}`}>{hasData ? `${pct}%` : '--'}</span>
                                                    </div>
                                                    <div className="text-xs text-slate-500 truncate">{SYLLABUS_DATA[tid].topic}</div>
                                                </div>
                                            </label>
                                        );
                                    })}
                                </div>
                            </div>
                            <button onClick={generate} className="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-bold mt-4 shadow hover:shadow-lg">生成 Prompt ✨</button>
                        </div>
                        <div className="flex-1 bg-white p-6 rounded-xl shadow-sm h-full flex flex-col border border-slate-200">
                            <h3 className="font-bold text-slate-700 mb-2">📝 生成結果 (Prompt Output)</h3>
                            <textarea className="flex-1 w-full bg-slate-50 border p-4 rounded-lg font-mono text-sm resize-none outline-none" value={generatedPrompt} readOnly placeholder="請在左側選擇課題與設定，然後點擊「生成 Prompt」..."></textarea>
                            <button onClick={()=>{navigator.clipboard.writeText(generatedPrompt); alert("已複製!")}} className="mt-4 py-3 bg-slate-800 text-white rounded-lg hover:bg-slate-700 font-bold flex justify-center gap-2">📋 複製並貼給 AI</button>
                        </div>
                    </div>
                );
            };

            // ==========================
            // NEW: History View
            // ==========================
            const HistoryView = () => {
                const updateNote = (id, newNote) => {
                    setGenHistory(prev => prev.map(item => item.id === id ? { ...item, note: newNote } : item));
                };

                const deleteHistory = (id) => {
                    if(confirm("確定刪除此紀錄?")) {
                        setGenHistory(prev => prev.filter(item => item.id !== id));
                    }
                };

                return (
                    <div className="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow-sm min-h-[80vh]">
                        <h2 className="text-2xl font-bold mb-6 text-slate-800 flex items-center gap-2">📜 練習生成紀錄 (History)</h2>
                        
                        {genHistory.length === 0 ? (
                            <div className="text-center py-20 text-slate-400 bg-slate-50 rounded-lg">
                                尚未生成任何練習。前往「AI 練習生成」開始吧！
                            </div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="bg-slate-100 text-slate-600 text-sm">
                                            <th className="p-3 rounded-tl-lg">時間 / 學生</th>
                                            <th className="p-3">設定</th>
                                            <th className="p-3">課題 (Topics)</th>
                                            <th className="p-3 w-1/3">備註 / 分數 (Note & Score)</th>
                                            <th className="p-3 rounded-tr-lg text-right">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-sm">
                                        {genHistory.map(item => (
                                            <tr key={item.id} className="border-b border-slate-100 hover:bg-slate-50">
                                                <td className="p-3 align-top">
                                                    <div className="font-bold text-slate-800">{new Date(item.timestamp).toLocaleDateString()}</div>
                                                    <div className="text-xs text-slate-400">{new Date(item.timestamp).toLocaleTimeString()}</div>
                                                    <div className="mt-1 text-blue-600 font-bold">{item.studentName}</div>
                                                </td>
                                                <td className="p-3 align-top">
                                                    <div className="flex flex-col gap-1">
                                                        <span className="bg-gray-200 text-gray-700 px-2 py-0.5 rounded text-xs w-fit">{item.settings.difficulty}</span>
                                                        <span className="bg-gray-200 text-gray-700 px-2 py-0.5 rounded text-xs w-fit">{item.settings.type}</span>
                                                        <span className="bg-gray-200 text-gray-700 px-2 py-0.5 rounded text-xs w-fit">{item.settings.lang}</span>
                                                    </div>
                                                </td>
                                                <td className="p-3 align-top">
                                                    <div className="flex flex-wrap gap-1">
                                                        {item.topics.map(t => (
                                                            <span key={t} className="border border-slate-300 px-1 rounded text-xs font-mono" title={SYLLABUS_DATA[t]?.topic}>
                                                                {t}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </td>
                                                <td className="p-3 align-top">
                                                    <textarea 
                                                        className="w-full border border-blue-200 bg-blue-50 p-2 rounded text-xs focus:ring-1 focus:ring-blue-500 outline-none resize-none"
                                                        rows="3"
                                                        placeholder="在此輸入分數或備註..."
                                                        value={item.note || ''}
                                                        onChange={(e) => updateNote(item.id, e.target.value)}
                                                    ></textarea>
                                                </td>
                                                <td className="p-3 align-top text-right">
                                                    <button onClick={() => deleteHistory(item.id)} className="text-slate-400 hover:text-red-500 p-2">
                                                        ✕
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="flex min-h-screen">
                    <Sidebar />
                    <div className="flex-1 ml-64 p-8 overflow-y-auto h-screen">
                        {view === 'students' && <StudentsView />}
                        {view === 'input' && <InputView />}
                        {view === 'dashboard' && <DashboardView />}
                        {view === 'generate' && <GenerateView />}
                        {view === 'history' && <HistoryView />}
                        {view === 'data' && <DataView />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>








