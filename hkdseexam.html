<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE Physics AI Trainer (v2.0 - å¯¦æˆ°ç‰ˆ)</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #f1f5f9; }
        .mc-btn { width: 40px; height: 40px; border-radius: 50%; font-weight: bold; transition: all 0.2s; border: 2px solid #e2e8f0; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .mc-btn:hover { background-color: #e2e8f0; }
        .mc-btn.selected { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .mc-btn.correct { background-color: #22c55e; color: white; border-color: #22c55e; } /* ç¶ è‰² */
        .mc-btn.wrong { background-color: #ef4444; color: white; border-color: #ef4444; } /* ç´…è‰² */
        
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { Users, FileText, Key, BarChart3, Settings, Save, Trash2, Plus, CheckCircle, XCircle } = lucide;

        // --- 1. æ ¸å¿ƒæ•¸æ“šï¼šèª²ç¨‹å¤§ç¶± (Syllabus) ---
        // æ ¹æ“šä½ æä¾›çš„æ–‡ä»¶æ•´åˆçš„çœŸå¯¦æ•¸æ“š
        const SYLLABUS_DATA = {
            // Heat & Gas
            "1.1.1": { section: "Heat", topic: "æ¸©åº¦èˆ‡æ¸©åº¦è¨ˆ", desc: "èªè­˜æ¸©åº¦ç‚ºç‰©é«”å†·ç†±ç¨‹åº¦çš„æ¨™èªŒ" },
            "1.2.1": { section: "Heat", topic: "å…§èƒ½èˆ‡èƒ½é‡è½‰ç§»", desc: "é—¡é‡‹æ¸©åº¦ç‚ºç³»çµ±å…§åˆ†å­éš¨æ©Ÿé‹å‹•å¹³å‡å‹•èƒ½çš„å®šé‡é—œä¿‚" },
            "1.2.2": { section: "Heat", topic: "ç†±å‚³éæ–¹å¼", desc: "é‘‘å®šèƒ½é‡è½‰ç§»çš„æ–¹å¼å¯åˆ†ç‚ºå‚³å°ã€å°æµå’Œè¼»å°„" },
            "1.3.2": { section: "Heat", topic: "ç†±å®¹é‡å’Œæ¯”ç†±å®¹é‡", desc: "æ‡‰ç”¨ E=mcÎ”T è§£æ±ºå•é¡Œ" },
            "1.4.1": { section: "Heat", topic: "æ½›ç†±", desc: "æ‡‰ç”¨ E=ml è§£æ±ºæœ‰é—œç‰©æ…‹è®ŠåŒ–çš„å•é¡Œ" },
            "1.5.1": { section: "Heat", topic: "æ°£é«”å®šå¾‹", desc: "æ‡‰ç”¨æ™®é©æ°£é«”å®šå¾‹ pV=nRT" },
            // Mechanics
            "2.1.1": { section: "Mechanics", topic: "ä½ç½®å’Œç§»å‹•", desc: "åˆ†æä½ç§»-æ™‚é–“åŠé€Ÿåº¦-æ™‚é–“åœ–åƒ" },
            "2.2.1": { section: "Mechanics", topic: "ç‰›é “å®šå¾‹", desc: "æ‡‰ç”¨ç‰›é “ç¬¬äºŒå®šå¾‹ F=ma" },
            "2.4.1": { section: "Mechanics", topic: "å‹•é‡", desc: "å‹•é‡å®ˆæ†åŸç†" },
            "2.9.2": { section: "Mechanics", topic: "åœ“å‘¨é‹å‹•", desc: "æ‡‰ç”¨å‘å¿ƒåŠ›å…¬å¼ F=mvÂ²/r" },
            // Energy (E3)
            "E3.1.1": { section: "Energy", topic: "å®¶å±…ç”¨é›»", desc: "è¨ˆç®—é›»å™¨çš„èƒ½æºæ•ˆç›Šèˆ‡æˆæœ¬" },
            "E3.2.1": { section: "Energy", topic: "ç…§æ˜", desc: "æ¯”è¼ƒç™½ç†¾ç‡ˆã€LEDç­‰çš„æ•ˆèƒ½" },
            "E3.3.1": { section: "Energy", topic: "è»Šè¼›èƒ½æº", desc: "åˆ†æé›»å‹•è»Šèˆ‡æ±½æ²¹è»Šçš„æ•ˆç›Š" },
            "E3.4.1": { section: "Energy", topic: "å¯å†ç”Ÿèƒ½æº", desc: "æè¿°æ ¸è£‚è®Šèˆ‡æ ¸èšè®ŠåŠå¯å†ç”Ÿèƒ½æºç‰¹å¾µ" }
        };

        // --- 2. é¡Œç›®å°æ‡‰è¡¨ (Question Mapping) ---
        // é€™è£¡æš«æ™‚ç”¨æ¨¡æ“¬æ•¸æ“šã€‚æœªä¾†ä½ å¯ä»¥æ“´å±•é€™å€‹ Mapï¼Œå°‡æ¯ä¸€å¹´çš„æ¯ä¸€é¡Œå°æ‡‰åˆ°ä¸Šé¢çš„ IDã€‚
        // å¦‚æœæ²’æœ‰ Mapï¼Œç³»çµ±æœƒéš¨æ©Ÿåˆ†é…ä¸€å€‹èª²é¡Œä»¥ä¾›æ¸¬è©¦ã€‚
        const DEFAULT_MAPPING = {
            "2023_1A_1": "1.1.1", "2023_1A_2": "1.2.2", "2023_1A_3": "1.3.2",
            "2023_1A_4": "1.4.1", "2023_1A_5": "1.5.1", "2023_1A_6": "2.1.1",
            // ... é€™è£¡éœ€è¦æ›´å¤šçœŸå¯¦æ•¸æ“š
        };

        const App = () => {
            // --- State ---
            const [view, setView] = useState('students'); // students, marking, input, dashboard, generate
            
            // Data Store
            const [students, setStudents] = useState([]);
            const [answerKeys, setAnswerKeys] = useState({}); // { "2023_1A": { 1: "A", 2: "C"... } }
            const [records, setRecords] = useState([]); // { studentId, year, paper, type, answers: {}, scores: {} }
            
            // UI State
            const [currentStudentId, setCurrentStudentId] = useState('');
            const [editingKey, setEditingKey] = useState({ year: 2023, paper: '1A' });
            
            // --- Load / Save ---
            useEffect(() => {
                const saved = localStorage.getItem('dsePhysV2');
                if (saved) {
                    const data = JSON.parse(saved);
                    setStudents(data.students || []);
                    setAnswerKeys(data.answerKeys || {});
                    setRecords(data.records || []);
                }
            }, []);

            useEffect(() => {
                const data = { students, answerKeys, records };
                localStorage.setItem('dsePhysV2', JSON.stringify(data));
            }, [students, answerKeys, records]);

            // --- Logic Helpers ---
            
            // è¨ˆç®— MC åˆ†æ•¸
            const calculateMCScore = (year, paper, qNum, studentAns) => {
                const key = answerKeys[`${year}_${paper}`];
                if (!key) return 0; // æ²’æœ‰æ¨™æº–ç­”æ¡ˆ
                const correctAns = key[qNum];
                return studentAns === correctAns ? 1 : 0;
            };

            // å–å¾—å°æ‡‰èª²é¡Œ
            const getTopicForQuestion = (year, paper, qNum) => {
                const mapKey = `${year}_${paper}_${qNum}`;
                // å¦‚æœæœ‰è¨­å®š mapping å‰‡ç”¨ mappingï¼Œå¦å‰‡ç‚ºäº†ä¸è®“ç³»çµ±æ›æ‰ï¼Œæš«æ™‚ç”¨ Hash ç®—æ³•åˆ†é…ä¸€å€‹ Topic (æ¸¬è©¦ç”¨)
                if (DEFAULT_MAPPING[mapKey]) return DEFAULT_MAPPING[mapKey];
                
                // Fallback: æ ¹æ“šé¡Œè™Ÿåˆ†é…çµ¦ä¸åŒ Section (æ¨¡æ“¬)
                const ids = Object.keys(SYLLABUS_DATA);
                return ids[(qNum * 7) % ids.length]; 
            };

            // --- Components ---

            const Sidebar = () => (
                <div className="w-64 bg-slate-900 text-white h-screen fixed left-0 top-0 flex flex-col shadow-2xl">
                    <div className="p-6 border-b border-slate-700">
                        <h1 className="text-xl font-bold flex items-center gap-2">
                            <BarChart3 className="text-blue-400"/> Phy Trainer <span className="text-xs bg-blue-600 px-1 rounded">Pro</span>
                        </h1>
                    </div>
                    <nav className="flex-1 p-4 space-y-2">
                        <MenuBtn id="students" icon={Users} label="å­¸ç”Ÿç®¡ç†" />
                        <MenuBtn id="marking" icon={Key} label="æ¨™æº–ç­”æ¡ˆè¨­å®š" />
                        <MenuBtn id="input" icon={FileText} label="è¼¸å…¥æˆç¸¾" />
                        <MenuBtn id="dashboard" icon={BarChart3} label="åˆ†æå ±å‘Š" />
                        <MenuBtn id="generate" icon={Settings} label="ç”Ÿæˆç·´ç¿’ (AI)" />
                    </nav>
                </div>
            );

            const MenuBtn = ({id, icon: Icon, label}) => (
                <button onClick={() => setView(id)} 
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${view === id ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                    <Icon size={18} /> {label}
                </button>
            );

            // --- View: 1. å­¸ç”Ÿç®¡ç† ---
            const StudentsView = () => {
                const [newName, setNewName] = useState('');
                const addStudent = () => {
                    if (!newName) return;
                    const newStudent = { id: Date.now().toString(), name: newName, date: new Date().toLocaleDateString() };
                    setStudents([...students, newStudent]);
                    setNewName('');
                };
                const removeStudent = (id) => {
                    if (confirm('ç¢ºå®šåˆªé™¤æ­¤å­¸ç”ŸåŠå…¶æ‰€æœ‰è¨˜éŒ„ï¼Ÿ')) {
                        setStudents(students.filter(s => s.id !== id));
                        setRecords(records.filter(r => r.studentId !== id));
                    }
                };

                return (
                    <div className="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Users /> å­¸ç”Ÿè³‡æ–™åº«</h2>
                        
                        <div className="flex gap-4 mb-8">
                            <input 
                                type="text" 
                                className="flex-1 border-2 border-slate-200 rounded-lg p-3 focus:border-blue-500 outline-none"
                                placeholder="è¼¸å…¥å­¸ç”Ÿå§“å (e.g. é™³å¤§æ–‡)"
                                value={newName}
                                onChange={e => setNewName(e.target.value)}
                            />
                            <button onClick={addStudent} className="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 flex items-center gap-2">
                                <Plus size={18}/> æ–°å¢
                            </button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {students.map(s => (
                                <div key={s.id} className="p-4 border border-slate-200 rounded-lg hover:shadow-md transition bg-slate-50 relative group">
                                    <div className="font-bold text-lg text-slate-800">{s.name}</div>
                                    <div className="text-xs text-slate-500 mt-1">åŠ å…¥æ—¥æœŸ: {s.date}</div>
                                    <button onClick={() => removeStudent(s.id)} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                                        <Trash2 size={18} />
                                    </button>
                                </div>
                            ))}
                            {students.length === 0 && <div className="text-slate-400 col-span-3 text-center py-8">æš«ç„¡å­¸ç”Ÿè³‡æ–™</div>}
                        </div>
                    </div>
                );
            };

            // --- View: 2. æ¨™æº–ç­”æ¡ˆè¨­å®š (Marking Scheme) ---
            const MarkingSchemeView = () => {
                const { year, paper } = editingKey;
                const keyId = `${year}_${paper}`;
                const currentKeys = answerKeys[keyId] || {};
                const qCount = paper === '1A' ? 33 : 0; // ç›®å‰åªæ”¯æ´ 1A çš„ ANS è¼¸å…¥

                const updateKey = (qNum, val) => {
                    const newKeys = { ...currentKeys, [qNum]: val };
                    setAnswerKeys({ ...answerKeys, [keyId]: newKeys });
                };

                return (
                    <div className="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-2"><Key /> æ¨™æº–ç­”æ¡ˆè¨­å®š (Marking Scheme)</h2>
                            <div className="bg-yellow-50 text-yellow-800 px-4 py-2 rounded text-sm border border-yellow-200">
                                ğŸ’¡ åœ¨æ­¤è¼¸å…¥æ­£ç¢ºç­”æ¡ˆï¼Œç³»çµ±å°‡ç”¨æ–¼è‡ªå‹•è©•åˆ†
                            </div>
                        </div>

                        <div className="bg-slate-50 p-4 rounded-lg flex gap-4 mb-6 border border-slate-200">
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">å¹´ä»½</label>
                                <select className="p-2 rounded border" value={year} onChange={e => setEditingKey({...editingKey, year: e.target.value})}>
                                    {[2025,2024,2023,2022,2021,2020,2019,2018,2017,2016,2015,2014].map(y => <option key={y} value={y}>{y}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">è©¦å·</label>
                                <select className="p-2 rounded border" value={paper} onChange={e => setEditingKey({...editingKey, paper: e.target.value})}>
                                    <option value="1A">Paper 1A (MC)</option>
                                    {/* Paper 1B/2 é€šå¸¸æ˜¯é•·é¡Œç›®ï¼Œæ‰‹å‹•è¼¸å…¥åˆ†æ•¸ï¼Œä¸éœ€é è¨­ç­”æ¡ˆ Key */}
                                </select>
                            </div>
                        </div>

                        {paper === '1A' ? (
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                {Array.from({length: 33}).map((_, i) => {
                                    const q = i + 1;
                                    const val = currentKeys[q] || '';
                                    return (
                                        <div key={q} className="flex flex-col items-center bg-white p-2 border rounded">
                                            <span className="text-xs font-bold text-slate-400 mb-1">Q{q}</span>
                                            <div className="flex gap-1">
                                                {['A','B','C','D'].map(opt => (
                                                    <button 
                                                        key={opt}
                                                        onClick={() => updateKey(q, opt)}
                                                        className={`w-8 h-8 rounded text-sm font-bold transition-colors ${val === opt ? 'bg-green-600 text-white' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}`}
                                                    >
                                                        {opt}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        ) : (
                            <div className="text-center py-10 text-slate-400">
                                æ­¤è©¦å·ç‚ºé•·é¡Œç›®ï¼Œç„¡éœ€è¨­å®š MC ç­”æ¡ˆï¼Œè«‹ç›´æ¥æ–¼ã€Œè¼¸å…¥æˆç¸¾ã€é é¢è¼¸å…¥åˆ†æ•¸ã€‚
                            </div>
                        )}
                    </div>
                );
            };

            // --- View: 3. è¼¸å…¥æˆç¸¾ (Input) ---
            const InputView = () => {
                const [form, setForm] = useState({ 
                    studentId: students.length > 0 ? students[0].id : '', 
                    year: '2023', 
                    paper: '1A',
                    answers: {}, // for MC: { 1: 'A', 2: 'B' }
                    scores: {}   // for Long Q: { 1: 5, 2: 3 } or Auto-calc for MC
                });

                // ç•¶é¸æ“‡æ”¹è®Šæ™‚ï¼Œé‡ç½®è¼¸å…¥
                const handlePaperChange = (key, val) => {
                    setForm(prev => ({ ...prev, [key]: val, answers: {}, scores: {} }));
                };

                const qCount = form.paper === '1A' ? 33 : (form.paper === '1B' ? 15 : 10);
                const isMC = form.paper === '1A';

                // MC: é»æ“Šé¸é …
                const handleMCOptionClick = (q, opt) => {
                    const newAnswers = { ...form.answers, [q]: opt };
                    // å³æ™‚è¨ˆç®—åˆ†æ•¸ (Preview)
                    const isCorrect = answerKeys[`${form.year}_${form.paper}`]?.[q] === opt;
                    const newScores = { ...form.scores, [q]: isCorrect ? 1 : 0 };
                    
                    setForm({ ...form, answers: newAnswers, scores: newScores });
                };

                // Save
                const handleSave = () => {
                    if (!form.studentId) return alert("è«‹å…ˆå»ºç«‹å­¸ç”Ÿè³‡æ–™");
                    
                    // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨è¨˜éŒ„ (Update existing)
                    const existingIdx = records.findIndex(r => r.studentId === form.studentId && r.year == form.year && r.paper === form.paper);
                    let newRecords = [...records];
                    
                    const recordData = {
                        ...form,
                        id: Date.now(),
                        timestamp: new Date().toISOString()
                    };

                    if (existingIdx >= 0) {
                        newRecords[existingIdx] = recordData;
                    } else {
                        newRecords.push(recordData);
                    }
                    
                    setRecords(newRecords);
                    alert("âœ… æˆç¸¾å·²å„²å­˜ï¼");
                };

                // å–å¾—ç•¶å‰æ¨™æº–ç­”æ¡ˆä»¥ä¾›é¡¯ç¤º (Visual Feedback)
                const currentKey = answerKeys[`${form.year}_${form.paper}`] || {};

                return (
                    <div className="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-sm">
                        <h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><FileText /> è¼¸å…¥æˆç¸¾</h2>
                        
                        <div className="grid grid-cols-3 gap-6 mb-8 bg-slate-50 p-6 rounded-lg border border-slate-200">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase block mb-1">å­¸ç”Ÿ</label>
                                <select className="w-full p-2 border rounded" value={form.studentId} onChange={e => setForm({...form, studentId: e.target.value})}>
                                    {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase block mb-1">å¹´ä»½</label>
                                <select className="w-full p-2 border rounded" value={form.year} onChange={e => handlePaperChange('year', e.target.value)}>
                                    {[2025,2024,2023,2022,2021,2020,2019,2018].map(y => <option key={y} value={y}>{y}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase block mb-1">è©¦å·</label>
                                <select className="w-full p-2 border rounded" value={form.paper} onChange={e => handlePaperChange('paper', e.target.value)}>
                                    <option value="1A">Paper 1A (MC)</option>
                                    <option value="1B">Paper 1B (Long Q)</option>
                                    <option value="2">Paper 2 (Elective)</option>
                                </select>
                            </div>
                        </div>

                        {/* Input Area */}
                        {isMC ? (
                            <div>
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold text-slate-700">MC ç­”é¡Œç´™</h3>
                                    {!currentKey[1] && <span className="text-red-500 text-sm flex items-center gap-1"><XCircle size={14}/> æ³¨æ„ï¼šå°šæœªè¨­å®šæ­¤å¹´ä»½çš„æ¨™æº–ç­”æ¡ˆï¼Œå°‡ç„¡æ³•è‡ªå‹•è¨ˆåˆ†ã€‚</span>}
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-4">
                                    {Array.from({length: qCount}).map((_, i) => {
                                        const q = i + 1;
                                        const selected = form.answers[q];
                                        const correct = currentKey[q];
                                        // é¡¯ç¤ºç‹€æ…‹ï¼šå¦‚æœæœ‰é¸ä¸”æœ‰ç­”æ¡ˆ -> é¡¯ç¤ºå°éŒ¯é¡è‰²
                                        let statusColor = 'border-slate-200';
                                        if (selected && correct) {
                                            statusColor = selected === correct ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
                                        }

                                        return (
                                            <div key={q} className={`flex items-center justify-between p-2 rounded border ${statusColor}`}>
                                                <span className="font-mono font-bold text-slate-500 w-8">Q{q}</span>
                                                <div className="flex gap-2">
                                                    {['A','B','C','D'].map(opt => (
                                                        <button 
                                                            key={opt}
                                                            onClick={() => handleMCOptionClick(q, opt)}
                                                            className={`w-8 h-8 rounded-full text-sm font-bold border transition
                                                                ${selected === opt 
                                                                    ? (correct && correct !== opt ? 'bg-red-500 text-white border-red-500' : 'bg-blue-600 text-white border-blue-600')
                                                                    : 'bg-white text-slate-500 hover:bg-slate-100'
                                                                }
                                                                ${correct === opt && selected !== opt && selected ? 'ring-2 ring-green-500' : ''} 
                                                            `}
                                                        >
                                                            {opt}
                                                        </button>
                                                    ))}
                                                </div>
                                                <div className="w-6 text-center">
                                                    {selected && correct ? (selected === correct ? <CheckCircle size={16} className="text-green-500"/> : <XCircle size={16} className="text-red-500"/>) : null}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div>
                                <h3 className="font-bold text-slate-700 mb-4">é•·é¡Œç›®åˆ†æ•¸è¼¸å…¥</h3>
                                <div className="grid grid-cols-4 md:grid-cols-6 gap-4">
                                    {Array.from({length: qCount}).map((_, i) => (
                                        <div key={i} className="flex flex-col">
                                            <label className="text-xs text-slate-500 mb-1">Q{i+1}</label>
                                            <input 
                                                type="number" 
                                                className="border rounded p-2 text-center focus:ring-2 focus:ring-blue-500 outline-none"
                                                min="0"
                                                value={form.scores[i+1] || ''}
                                                onChange={e => setForm({...form, scores: {...form.scores, [i+1]: e.target.value}})}
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="mt-8 pt-6 border-t border-slate-200">
                            <button onClick={handleSave} className="w-full py-4 bg-slate-800 text-white rounded-lg font-bold hover:bg-slate-700 shadow-lg flex justify-center items-center gap-2">
                                <Save size={20}/> å„²å­˜æˆç¸¾è¨˜éŒ„
                            </button>
                        </div>
                    </div>
                );
            };

            // --- View: 4. Dashboard (åˆ†æ) ---
            const DashboardView = () => {
                const [targetStudent, setTargetStudent] = useState(students.length > 0 ? students[0].id : '');
                
                // è¨ˆç®—å¼±é»
                const analysis = useMemo(() => {
                    if (!targetStudent) return [];
                    const myRecords = records.filter(r => r.studentId === targetStudent);
                    const topicStats = {}; // { topicId: { correct: 0, total: 0 } }

                    myRecords.forEach(rec => {
                        Object.entries(rec.scores).forEach(([q, score]) => {
                            const topicId = getTopicForQuestion(rec.year, rec.paper, q);
                            if (!topicStats[topicId]) topicStats[topicId] = { earned: 0, max: 0, count: 0 };
                            
                            // å‡è¨­ MC æ»¿åˆ† 1, é•·é¡Œç›®æ»¿åˆ†æš«å®š 10 (æˆ–ä¹‹å¾ŒåŠ å…¥ max score è¨­å®š)
                            const maxScore = rec.paper === '1A' ? 1 : 10; 
                            
                            topicStats[topicId].earned += parseFloat(score || 0);
                            topicStats[topicId].max += maxScore;
                            topicStats[topicId].count += 1;
                        });
                    });

                    // è½‰ç‚º Array ä¸¦æ’åº
                    return Object.entries(topicStats).map(([id, stat]) => {
                        const pct = (stat.earned / stat.max) * 100;
                        const info = SYLLABUS_DATA[id] || { topic: id, desc: 'æœªçŸ¥èª²é¡Œ' };
                        return { ...info, id, pct, ...stat };
                    }).sort((a, b) => a.pct - b.pct);

                }, [records, targetStudent]);

                return (
                    <div className="max-w-6xl mx-auto space-y-6">
                        <div className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm">
                            <h2 className="text-xl font-bold flex items-center gap-2">ğŸ“Š å­¸ç¿’è¨ºæ–·å ±å‘Š</h2>
                            <select className="border p-2 rounded" value={targetStudent} onChange={e => setTargetStudent(e.target.value)}>
                                {students.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                            </select>
                        </div>

                        {analysis.length === 0 ? (
                            <div className="p-12 text-center text-slate-400 bg-white rounded-xl">
                                å°šæœªæœ‰è¶³å¤ æ•¸æ“šé€²è¡Œåˆ†æï¼Œè«‹å…ˆè¼¸å…¥æˆç¸¾ã€‚
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-xl shadow-sm">
                                    <h3 className="font-bold text-red-600 mb-4 flex items-center gap-2"><CheckCircle size={18}/> æ€¥éœ€æ”¹å–„çš„å¼±é … (Bottom 5)</h3>
                                    <div className="space-y-3">
                                        {analysis.slice(0, 5).map(item => (
                                            <div key={item.id} className="flex justify-between items-center p-3 bg-red-50 border border-red-100 rounded-lg">
                                                <div>
                                                    <div className="font-bold text-slate-700">{item.topic} <span className="text-xs text-slate-400 font-normal">({item.id})</span></div>
                                                    <div className="text-xs text-slate-500">{item.desc}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-xl font-bold text-red-600">{item.pct.toFixed(0)}%</div>
                                                    <div className="text-xs text-slate-400">å¾—åˆ†ç‡</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm">
                                    <h3 className="font-bold text-green-600 mb-4">è¡¨ç¾æœ€å¥½çš„ç¯„ç–‡</h3>
                                    <div className="space-y-3">
                                        {[...analysis].reverse().slice(0, 5).map(item => (
                                            <div key={item.id} className="flex justify-between items-center p-3 bg-green-50 border border-green-100 rounded-lg">
                                                <div>
                                                    <div className="font-bold text-slate-700">{item.topic}</div>
                                                </div>
                                                <div className="font-bold text-green-600">{item.pct.toFixed(0)}%</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // --- Main Layout Render ---
            return (
                <div className="flex min-h-screen">
                    <Sidebar />
                    <div className="flex-1 ml-64 p-8 overflow-y-auto h-screen">
                        {view === 'students' && <StudentsView />}
                        {view === 'marking' && <MarkingSchemeView />}
                        {view === 'input' && <InputView />}
                        {view === 'dashboard' && <DashboardView />}
                        {view === 'generate' && <div className="p-10 text-center text-slate-500">AI Prompt ç”ŸæˆåŠŸèƒ½ (å¯æ²¿ç”¨ä¸Šä¸€ç‰ˆä»£ç¢¼ï¼Œæ­¤è™•çœç•¥ä»¥èšç„¦æ ¸å¿ƒåŠŸèƒ½)</div>}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
