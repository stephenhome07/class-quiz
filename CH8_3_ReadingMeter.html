<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Voltmeter Scale Master V2</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #2c3e50;
        color: white;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
    }

    .container {
        background: white;
        color: #333;
        width: 90%;
        max-width: 500px;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    }

    h2 { margin: 0; color: #e67e22; }
    p.subtitle { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px; }

    /* 儀表板區域 */
    .meter-box {
        position: relative;
        width: 100%;
        height: 250px; /* 稍微加高 */
        background: #fdfefe;
        border: 2px solid #bdc3c7;
        border-radius: 10px 10px 0 0;
        overflow: hidden;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    canvas { 
        width: 100%; 
        height: 100%; 
        display: block; /* 消除間隙 */
    }

    /* 控制區 */
    .controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
    }
    .range-btn {
        padding: 8px 15px;
        border: 2px solid #3498db;
        background: white;
        color: #3498db;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
        font-size: 1rem;
    }
    .range-btn.active {
        background: #3498db;
        color: white;
    }

    /* 輸入區 */
    .input-area {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    input[type="number"] {
        padding: 10px;
        font-size: 1.2rem;
        width: 100px;
        text-align: center;
        border: 2px solid #bdc3c7;
        border-radius: 8px;
        -webkit-appearance: none; /* 移除 iOS 默認樣式 */
        margin: 0;
    }
    button.check-btn {
        padding: 10px 20px;
        font-size: 1rem;
        background-color: #27ae60;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    button.check-btn:active { transform: scale(0.95); }

    .feedback { font-size: 1.1rem; font-weight: bold; min-height: 1.5em; margin-bottom: 15px; }
    .hint { font-size: 0.85rem; color: #555; background: #ecf0f1; padding: 5px 10px; border-radius: 5px; display: inline-block; font-weight: bold;}

</style>
</head>
<body>

<div class="container">
    <h2>Scale Master</h2>
    <p class="subtitle">Voltmeter Reading (Mobile Fix)</p>

    <div class="controls">
        <button class="range-btn active" id="btn-3v" onclick="setRange(3)">0-3 V</button>
        <button class="range-btn" id="btn-15v" onclick="setRange(15)">0-15 V</button>
    </div>

    <div class="meter-box" id="meter-container">
        <canvas id="meterCanvas"></canvas>
    </div>

    <div class="hint" id="hint-text">1 small div = 0.1 V (每一小格)</div>

    <div class="feedback" id="feedback"></div>

    <div class="input-area">
        <input type="number" id="user-input" placeholder="0.0" step="0.1">
        <button class="check-btn" onclick="checkAnswer()">Check</button>
    </div>
    
    <button onclick="newQuestion()" style="background:none; border:none; color:#3498db; text-decoration:underline; cursor:pointer; margin-top:10px; padding: 10px;">Skip / Next Question</button>
</div>

<script>
    const canvas = document.getElementById('meterCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('meter-container');
    
    let currentRange = 3; 
    let currentValue = 0;
    
    // 強制重設 Canvas 大小，適配手機高解析度
    function resizeCanvas() {
        const w = container.clientWidth;
        const h = container.clientHeight;
        
        // 設定 Canvas 內部解析度為顯示大小的 2 倍 (Retina)
        canvas.width = w * 2;
        canvas.height = h * 2;
        
        // 設定 CSS 顯示大小
        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
        
        // 所有繪圖放大 2 倍
        ctx.resetTransform();
        ctx.scale(2, 2);
    }

    // 監聽視窗改變，重新調整並繪圖
    window.addEventListener('resize', () => { 
        resizeCanvas(); 
        drawMeter(); 
    });

    function setRange(range) {
        currentRange = range;
        
        document.getElementById('btn-3v').className = range === 3 ? 'range-btn active' : 'range-btn';
        document.getElementById('btn-15v').className = range === 15 ? 'range-btn active' : 'range-btn';
        
        const hint = range === 3 ? "1 small div = 0.1 V (每格 0.1)" : "1 small div = 0.5 V (每格 0.5)";
        document.getElementById('hint-text').innerText = hint;

        newQuestion();
    }

    function newQuestion() {
        document.getElementById('feedback').innerText = "";
        document.getElementById('user-input').value = "";
        
        // 隨機生成讀數
        if (currentRange === 3) {
            const steps = Math.floor(Math.random() * 31); 
            currentValue = (steps * 0.1).toFixed(1);
        } else {
            const steps = Math.floor(Math.random() * 31);
            currentValue = (steps * 0.5).toFixed(1);
        }

        drawMeter();
    }

    function drawMeter() {
        // 因為已經 scale(2,2)，這裡直接用 CSS 寬高計算
        const w = container.clientWidth;
        const h = container.clientHeight;
        const cx = w / 2;
        const cy = h * 0.85; // 圓心位置
        const radius = Math.min(w, h) * 0.85; // 半徑

        ctx.clearRect(0, 0, w, h);

        // 1. 畫外框弧線 (變粗)
        ctx.beginPath();
        ctx.arc(cx, cy, radius, Math.PI * 1.1, Math.PI * 1.9);
        ctx.strokeStyle = "#2c3e50";
        ctx.lineWidth = 3; 
        ctx.stroke();

        // 2. 畫刻度線
        const totalDivs = 30;
        const startAngle = Math.PI * 1.1;
        const endAngle = Math.PI * 1.9;
        const totalAngle = endAngle - startAngle;

        for (let i = 0; i <= totalDivs; i++) {
            const angle = startAngle + (i / totalDivs) * totalAngle;
            
            // 計算起點
            const x1 = cx + Math.cos(angle) * (radius - 2); 
            const y1 = cy + Math.sin(angle) * (radius - 2);
            
            let len = 10;
            let isMajor = false;
            let isMedium = false;

            if (i % 10 === 0) { isMajor = true; len = 25; }
            else if (i % 5 === 0) { isMedium = true; len = 18; }
            else { len = 10; } // 小刻度

            // 計算終點
            const x2 = cx + Math.cos(angle) * (radius - len);
            const y2 = cy + Math.sin(angle) * (radius - len);

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            
            // 手機優化：加粗線條顏色與寬度
            ctx.strokeStyle = isMajor ? "#000000" : (isMedium ? "#333333" : "#7f8c8d");
            ctx.lineWidth = isMajor ? 4 : (isMedium ? 3 : 2); // 最小也是 2px
            ctx.lineCap = "round"; // 圓頭線條，看起來更清晰
            ctx.stroke();

            // 畫數字
            if (isMajor) {
                const val = (i / totalDivs) * currentRange;
                const tx = cx + Math.cos(angle) * (radius - 45);
                const ty = cy + Math.sin(angle) * (radius - 45);
                ctx.font = "bold 18px Arial";
                ctx.fillStyle = "#000000";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(val, tx, ty);
            }
        }

        // 3. 畫指針
        const ratio = currentValue / currentRange;
        const needleAngle = startAngle + ratio * totalAngle;
        const nx = cx + Math.cos(needleAngle) * (radius - 15);
        const ny = cy + Math.sin(needleAngle) * (radius - 15);

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(nx, ny);
        ctx.strokeStyle = "#e74c3c"; // 紅色
        ctx.lineWidth = 4; // 加粗
        ctx.lineCap = "round";
        ctx.stroke();

        // 4. 指針中心圓點
        ctx.beginPath();
        ctx.arc(cx, cy, 6, 0, Math.PI * 2);
        ctx.fillStyle = "#333";
        ctx.fill();
        
        // 5. V 標誌
        ctx.font = "bold 30px Arial";
        ctx.fillStyle = "#95a5a6";
        ctx.textAlign = "center";
        ctx.fillText("V", cx, cy - 60);
    }

    function checkAnswer() {
        const input = parseFloat(document.getElementById('user-input').value);
        const feedback = document.getElementById('feedback');
        
        if (isNaN(input)) {
            feedback.innerHTML = "<span style='color:#e67e22'>Please enter a number!</span>";
            return;
        }

        if (Math.abs(input - currentValue) < 0.05) {
            feedback.innerHTML = "<span style='color:#27ae60'>✅ Correct!</span>";
            navigator.vibrate(50);
            setTimeout(newQuestion, 1200);
        } else {
            feedback.innerHTML = `<span style='color:#c0392b'>❌ Answer: ${currentValue} V</span>`;
            navigator.vibrate([50, 50, 50]);
        }
    }

    // 初始化：延遲 100ms 確保手機瀏覽器排版完成
    setTimeout(() => {
        resizeCanvas();
        setRange(3);
    }, 100);

</script>
</body>
</html>
