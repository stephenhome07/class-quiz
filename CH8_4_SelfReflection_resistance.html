<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Circuit Builder V3 - Electron Flow</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 10px;
        margin: 0;
        overflow-x: hidden;
    }
    .container {
        max-width: 600px;
        margin: 0 auto;
        background: #34495e;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    }
    h2 { color: #f1c40f; margin: 0 0 10px 0; text-shadow: 0 2px 0px rgba(0,0,0,0.3); }
    
    .mission-box {
        background: #e67e22; color: white; padding: 12px; border-radius: 10px;
        margin-bottom: 20px; font-weight: bold; border: 2px solid #d35400;
        box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
    }

    /* --- é›»è·¯ç•«å¸ƒå€åŸŸ --- */
    .circuit-board {
        background: #ecf0f1; 
        border-radius: 15px; 
        height: 280px;
        position: relative; 
        margin-bottom: 20px;
        border: 4px solid #bdc3c7;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden; /* é‡è¦ï¼šéš±è—è¶…å‡ºç¯„åœçš„é›»å­ */
    }

    /* é›»è·¯è¿´è·¯å®¹å™¨ (æœƒéš¨é•·åº¦è®Šå¯¬) */
    .circuit-loop {
        position: relative;
        width: 220px; /* åˆå§‹å¯¬åº¦ (Short) */
        height: 180px;
        transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* å°ç·šåŸºç¤æ¨£å¼ */
    .wire-path {
        position: absolute;
        background: #2c3e50;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        z-index: 1;
    }
    
    /* å››é‚Šå°ç·š */
    .w-left { width: 10px; height: 100%; left: 0; top: 0; }
    .w-right { width: 10px; height: 100%; right: 0; top: 0; }
    .w-bottom { width: 100%; height: 10px; bottom: 0; left: 0; }
    .w-top-L { width: 30px; height: 10px; top: 0; left: 0; } /* å·¦ä¸Šè§’é€£æ¥è™• */
    .w-top-R { width: 30px; height: 10px; top: 0; right: 0; } /* å³ä¸Šè§’é€£æ¥è™• */

    /* --- æ¸¬è©¦å°ç·š (ä¸»è¦äº’å‹•å€) --- */
    .test-wire-container {
        position: absolute; top: 0; left: 30px; right: 30px; height: 40px;
        display: flex; align-items: center; justify-content: center; z-index: 2;
    }
    .test-wire {
        width: 100%; 
        height: 25px; /* åˆå§‹ Thick */
        background: linear-gradient(180deg, #bdc3c7 0%, #95a5a6 100%);
        border: 2px solid #7f8c8d;
        transition: height 0.3s ease, background 0.3s;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        display: flex; align-items: center; justify-content: center;
    }
    .wire-label { font-size: 10px; color: #555; font-weight: bold; letter-spacing: 1px; }

    /* --- å…ƒä»¶ --- */
    .battery {
        position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%);
        font-size: 40px; z-index: 10;
        filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
    }
    
    .bulb-pos {
        position: absolute; top: 50%; right: -30px; transform: translateY(-50%);
        z-index: 10;
    }
    .bulb {
        font-size: 60px; color: #555;
        transition: color 0.2s, text-shadow 0.2s, transform 0.2s;
    }

    /* å®‰åŸ¹è¨ˆ (æ–°å¢) */
    .ammeter {
        position: absolute; top: 50%; left: -25px; transform: translateY(-50%);
        width: 50px; height: 50px; background: white; border: 3px solid #333;
        border-radius: 50%; z-index: 10; display: flex; justify-content: center; align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .ammeter-face { font-weight: bold; font-size: 14px; color: #333; margin-top: 10px;}
    .ammeter-pointer {
        position: absolute; top: 25%; left: 50%; height: 25px; width: 2px; background: red;
        transform-origin: bottom center; transform: rotate(-45deg); transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .ammeter-label { position: absolute; top: 5px; font-size: 10px; color: #333; font-weight: bold; }

    /* --- é›»å­æµå‹•ç•« --- */
    .electron {
        position: absolute;
        width: 8px; height: 8px;
        background: #f1c40f;
        border-radius: 50%;
        box-shadow: 0 0 6px #f1c40f, 0 0 10px orange;
        z-index: 5;
        pointer-events: none;
        will-change: left, top;
    }

    /* --- æ§åˆ¶é¢æ¿ --- */
    .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
    .control-group { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; }
    .control-label { font-size: 0.9rem; color: #bdc3c7; margin-bottom: 8px; display: block; font-weight: bold; }
    
    .btn-group { display: flex; gap: 8px; }
    .btn {
        flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer;
        font-weight: bold; font-size: 1rem; transition: 0.2s;
        background: #2c3e50; color: #ecf0f1; border: 2px solid #34495e;
    }
    .btn:active { transform: scale(0.95); }
    .btn.active { background: #3498db; border-color: #5dade2; color: white; box-shadow: 0 0 10px rgba(52, 152, 219, 0.4); }

    /* å„€è¡¨æ¿ */
    .dashboard {
        display: flex; justify-content: space-between; margin-top: 20px;
        background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;
    }
    .stat-box { text-align: left; }
    .stat-title { font-size: 0.8rem; color: #bdc3c7; text-transform: uppercase; }
    .stat-val { font-size: 1.4rem; font-weight: bold; color: #f1c40f; }

</style>
</head>
<body>

<div class="container">
    <h2>âš¡ Circuit Builder V3</h2>
    
    <div class="mission-box" id="mission-text">
        Mission: Make the electrons flow FAST!<br>ä»»å‹™ï¼šè®“é›»å­æµå‹•å¾—æœ€å¿«ï¼
    </div>

    <div class="circuit-board">
        <div class="circuit-loop" id="loop-container">
            <div class="wire-path w-left"></div>
            <div class="wire-path w-bottom"></div>
            <div class="wire-path w-right"></div>
            <div class="wire-path w-top-L"></div>
            <div class="wire-path w-top-R"></div>

            <div class="test-wire-container">
                <div class="test-wire" id="test-wire">
                    <span class="wire-label">RESISTANCE WIRE</span>
                </div>
            </div>

            <div class="battery">ğŸ”‹</div>
            
            <div class="bulb-pos">
                <div class="bulb" id="bulb-obj">ğŸ’¡</div>
            </div>

            <div class="ammeter">
                <div class="ammeter-label">A</div>
                <div class="ammeter-pointer" id="pointer"></div>
                <div class="ammeter-face">.</div>
            </div>
            
            <div id="electron-container"></div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <span class="control-label">Length (é•·åº¦)</span>
            <div class="btn-group">
                <button class="btn active" onclick="setProp('len', 'short', this)">Short (çŸ­)</button>
                <button class="btn" onclick="setProp('len', 'long', this)">Long (é•·)</button>
            </div>
        </div>

        <div class="control-group">
            <span class="control-label">Thickness (ç²—å¹¼)</span>
            <div class="btn-group">
                <button class="btn" onclick="setProp('thick', 'thin', this)">Thin (å¹¼)</button>
                <button class="btn active" onclick="setProp('thick', 'thick', this)">Thick (ç²—)</button>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="stat-box">
            <div class="stat-title">Resistance (é›»é˜»)</div>
            <div class="stat-val" id="res-val">Low</div>
        </div>
        <div class="stat-box" style="text-align:right;">
            <div class="stat-title">Current Speed (æµé€Ÿ)</div>
            <div class="stat-val" id="curr-val">High</div>
        </div>
    </div>

    <button onclick="checkMission()" style="width:100%; margin-top:20px; padding:15px; background:#27ae60; color:white; border:none; border-radius:10px; font-size:1.1rem; font-weight:bold; cursor:pointer; box-shadow: 0 5px 0 #1e8449; transition:0.1s;">Check Mission (æª¢æŸ¥ä»»å‹™)</button>
</div>

<script>
    // åƒæ•¸ç‹€æ…‹
    let currentLen = 'short';
    let currentThick = 'thick';
    let electrons = [];
    const numElectrons = 15; // é›»å­æ•¸é‡
    let speed = 4; // åƒç´ /å¹€

    // DOM å…ƒç´ 
    const loopContainer = document.getElementById('loop-container');
    const testWire = document.getElementById('test-wire');
    const bulb = document.getElementById('bulb-obj');
    const resVal = document.getElementById('res-val');
    const currVal = document.getElementById('curr-val');
    const pointer = document.getElementById('pointer');
    const eContainer = document.getElementById('electron-container');
    const missionText = document.getElementById('mission-text');

    // åˆå§‹åŒ–é›»å­
    function initElectrons() {
        eContainer.innerHTML = '';
        electrons = [];
        for (let i = 0; i < numElectrons; i++) {
            let el = document.createElement('div');
            el.className = 'electron';
            eContainer.appendChild(el);
            // å¹³å‡åˆ†ä½ˆåœ¨è»Œé“ä¸Š (0% to 100%)
            electrons.push({
                el: el,
                pos: (i / numElectrons) * 100 // 0-100 percentage of loop
            });
        }
    }

    function setProp(type, val, btn) {
        // UI æ›´æ–°
        const parent = btn.parentElement;
        Array.from(parent.children).forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if (type === 'len') currentLen = val;
        if (type === 'thick') currentThick = val;

        updateCircuit();
    }

    function updateCircuit() {
        // 1. å¹¾ä½•è®Šå½¢
        let loopWidth = 220;
        if (currentLen === 'long') loopWidth = 360; // æ‹‰é•·
        
        loopContainer.style.width = loopWidth + 'px';

        if (currentThick === 'thick') {
            testWire.style.height = "25px";
            testWire.style.background = "linear-gradient(180deg, #bdc3c7 0%, #95a5a6 100%)";
        } else {
            testWire.style.height = "6px";
            testWire.style.background = "#555";
        }

        // 2. ç‰©ç†è¨ˆç®— (Resistance Score)
        // Short(0) Long(1) + Thick(0) Thin(1)
        let rScore = 0;
        if (currentLen === 'long') rScore += 1;
        if (currentThick === 'thin') rScore += 1;

        // è¨­å®šæ•ˆæœ
        let brightness = 1;
        let pointerAngle = 45; // Max current
        
        if (rScore === 0) { // Short Thick (Best)
            speed = 5.5; // Fast
            resVal.innerText = "Very Low";
            currVal.innerText = "Max Speed";
            brightness = 1;
            pointerAngle = 45; // Right
        } else if (rScore === 1) { // Mixed
            speed = 2.5; // Medium
            resVal.innerText = "Medium";
            currVal.innerText = "Medium";
            brightness = 0.5;
            pointerAngle = 0; // Center
        } else { // Long Thin (Worst)
            speed = 0.8; // Very Slow (Traffic Jam)
            resVal.innerText = "Very High";
            currVal.innerText = "Crawling";
            brightness = 0.2;
            pointerAngle = -45; // Left
        }

        // 3. è¦–è¦ºåé¥‹
        // ç‡ˆæ³¡
        if (brightness > 0.8) {
            bulb.style.color = "#f1c40f"; 
            bulb.style.textShadow = "0 0 30px #f1c40f, 0 0 60px orange";
            bulb.style.transform = "scale(1.2)";
        } else if (brightness > 0.4) {
            bulb.style.color = "#f39c12"; 
            bulb.style.textShadow = "0 0 10px #f39c12";
            bulb.style.transform = "scale(1.0)";
        } else {
            bulb.style.color = "#444"; 
            bulb.style.textShadow = "none";
            bulb.style.transform = "scale(0.9)";
        }

        // å®‰åŸ¹è¨ˆæŒ‡é‡
        pointer.style.transform = `rotate(${pointerAngle}deg)`;
    }

    // --- å‹•ç•«æ ¸å¿ƒå¾ªç’° ---
    function animate() {
        const w = loopContainer.offsetWidth;
        const h = loopContainer.offsetHeight;
        const wireThick = 10;
        
        // è¨ˆç®—ç¸½å‘¨é•· (è¿‘ä¼¼å€¼ï¼Œç”¨æ–¼æ¨™æº–åŒ–é€Ÿåº¦)
        const perimeter = 2 * (w + h);
        
        // æ¯ä¸€å¹€ç§»å‹•çš„ç™¾åˆ†æ¯” (ç¢ºä¿é€Ÿåº¦åœ¨ä¸åŒé•·åº¦ä¸‹è¦–è¦ºä¸Šä¸€è‡´)
        // speed æ˜¯ pixel per frame, è½‰æ›æˆ perimeter percentage
        const stepPercent = (speed / perimeter) * 100;

        electrons.forEach(p => {
            p.pos += stepPercent;
            if (p.pos >= 100) p.pos -= 100;

            // æ ¹æ“šç™¾åˆ†æ¯”è¨ˆç®— XY åº§æ¨™ (é€†æ™‚é‡æµå‹•ï¼šé›»æ±  -> ç‡ˆæ³¡(å³) -> æ¸¬è©¦ç·š(ä¸Š) -> å®‰åŸ¹è¨ˆ(å·¦) -> é›»æ± )
            // ç‚ºäº†ç¬¦åˆç‰©ç†(é›»æµæ­£->è² )ï¼Œæˆ‘å€‘æ¨¡æ“¬ Convention Current (é †æ™‚é‡: å·¦->ä¸Š->å³->ä¸‹)
            // æˆ–è€…æ˜¯é€†æ™‚é‡? è®“æˆ‘å€‘è·Ÿéš¨é›»æ± åœ–ç¤º
            // é›»æ± ï¼šå‡¸èµ·åœ¨å³é‚Š(æ­£)ï¼Œå¹³åº•åœ¨å·¦é‚Š(è² )
            // é›»æµå¾ æ­£ -> è² ã€‚æ‰€ä»¥æ˜¯ é€†æ™‚é‡ (å³ -> ä¸Š -> å·¦ -> ä¸‹)
            
            // å®šç¾©è·¯å¾‘åˆ†æ®µ (ä»¥ç¸½å‘¨é•·æ¯”ä¾‹åŠƒåˆ†)
            // 1. Right Wall (Bottom to Top)
            // 2. Top Wall (Right to Left)
            // 3. Left Wall (Top to Bottom)
            // 4. Bottom Wall (Left to Right)
            
            const pRight = h / perimeter * 100;
            const pTop = w / perimeter * 100;
            const pLeft = h / perimeter * 100;
            // const pBottom = w / perimeter * 100; 
            
            let x, y;
            
            // èª¿æ•´åº§æ¨™ä»¥ç½®ä¸­æ–¼å°ç·š
            const offset = wireThick / 2 - 4; // 4 is half electron size

            if (p.pos < pRight) {
                // å³å´ (å‘ä¸Šç§») : 0% ~ 
                const localPct = p.pos / pRight;
                x = w - wireThick;
                y = h - (localPct * h); 
            } else if (p.pos < pRight + pTop) {
                // é ‚éƒ¨ (å‘å·¦ç§»)
                const localPct = (p.pos - pRight) / pTop;
                x = w - (localPct * w);
                y = 0;
            } else if (p.pos < pRight + pTop + pLeft) {
                // å·¦å´ (å‘ä¸‹ç§»)
                const localPct = (p.pos - (pRight + pTop)) / pLeft;
                x = 0;
                y = localPct * h;
            } else {
                // åº•éƒ¨ (å‘å³ç§»)
                const localPct = (p.pos - (pRight + pTop + pLeft)) / (100 - (pRight + pTop + pLeft));
                x = localPct * w;
                y = h - wireThick;
            }

            // ä¿®æ­£åº§æ¨™ä½¿é›»å­åœ¨å°ç·šä¸­é–“
            // Top/Bottom wires: y needs fix. Left/Right wires: x needs fix.
            if (p.pos < pRight) { x = w - 15; /* Right wire padding */ } 
            else if (p.pos < pRight + pTop) { y = 8; /* Top wire padding */ } 
            else if (p.pos < pRight + pTop + pLeft) { x = 6; /* Left wire padding */ } 
            else { y = h - 15; /* Bottom wire padding */ }

            p.el.style.left = x + 'px';
            p.el.style.top = y + 'px';
        });

        requestAnimationFrame(animate);
    }

    // ä»»å‹™æª¢æŸ¥
    let stage = 1;
    function checkMission() {
        let success = false;
        let msg = "";
        
        // Stage 1: Fast (Low R)
        if (stage === 1) {
            if (currentLen === 'short' && currentThick === 'thick') {
                success = true;
                msg = "Correct! Short & Thick wires let current flow fastest! \n(çŸ­è€Œç²—çš„å°ç·šé›»é˜»æœ€å°ï¼Œé›»æµæœ€å¿«ï¼)";
            } else {
                msg = "Not quite. Look at the speed. Is it fast? \n(é‚„ä¸å¤ å¿«ã€‚è©¦è‘—æŠŠè·¯è®ŠçŸ­ã€è·¯é¢è®Šé—Šã€‚)";
            }
        } 
        // Stage 2: Slow (High R)
        else {
            if (currentLen === 'long' && currentThick === 'thin') {
                success = true;
                msg = "Correct! Long & Thin wires cause a 'traffic jam'. \n(é•·è€Œå¹¼çš„å°ç·šé›»é˜»æœ€å¤§ï¼Œé›»æµæœ€æ…¢ï¼)";
            } else {
                msg = "Not quite. We want to slow them down. \n(é‚„ä¸å¤ æ…¢ã€‚è©¦è‘—æŠŠè·¯æ‹‰é•·ã€è·¯é¢æ”¶çª„ã€‚)";
            }
        }

        if (success) {
            alert("ğŸ‰ " + msg);
            if (stage === 1) {
                stage = 2;
                missionText.innerText = "Mission 2: Make the electrons flow SLOWEST (High R).";
                missionText.style.background = "#34495e";
            } else {
                missionText.innerText = "ğŸ† Current Master! You understand Resistance!";
                missionText.style.background = "#27ae60";
            }
        } else {
            alert("âŒ " + msg);
        }
    }

    // å•Ÿå‹•
    initElectrons();
    updateCircuit(); // Apply initial settings
    animate();

</script>
</body>
</html>
