<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Circuit Logic Lab V4 (S2 Level)</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 10px;
        margin: 0;
        /* 禁止選取與拖拽 */
        -webkit-user-select: none;
        user-select: none;
        touch-action: manipulation;
    }
    
    .container {
        max-width: 900px;
        margin: 0 auto;
        padding-bottom: 50px;
    }

    h2 { color: #f1c40f; margin: 15px 0 5px 0; font-size: 1.6rem; }
    .subtitle { color: #bdc3c7; font-size: 0.9rem; margin-bottom: 25px; line-height: 1.4; }

    /* Grid 佈局：現在只有 3 個，會自動排版 */
    .lab-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        justify-content: center;
    }

    .circuit-box {
        background: #34495e;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        border: 2px solid #5a6b7c;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .box-title { 
        font-weight: bold; color: #3498db; margin-bottom: 10px; font-size: 1.2rem; width: 100%;
        border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;
    }
    .parallel-title { color: #e74c3c; }
    .complex-title { color: #9b59b6; }

    /* SVG 設定 */
    svg { 
        width: 100%; 
        max-width: 320px; 
        height: auto; 
        display: block; 
        overflow: visible; 
    }
    
    .interactive { cursor: pointer; }
    
    /* === 修正：防止點擊時飛走 === */
    .bulb-group:active .bulb-glass { 
        transform: scale(0.9); 
        transform-box: fill-box; /* 關鍵：以自身中心縮放 */
        transform-origin: center; 
    }
    .switch-group:active circle { fill: #bdc3c7; }

    /* 導線樣式 */
    .wire { fill: none; stroke: #7f8c8d; stroke-width: 4; stroke-linecap: round; transition: stroke 0.3s; }
    .wire-active { stroke: #f1c40f; filter: drop-shadow(0 0 5px #f39c12); }
    
    /* 燈泡樣式 */
    .bulb-glass { 
        fill: #555; stroke: #2c3e50; stroke-width: 2; 
        transition: fill 0.2s; 
    }
    .bulb-on { fill: #f1c40f; filter: drop-shadow(0 0 15px #f1c40f); }
    .bulb-broken-x { display: none; stroke: #c0392b; stroke-width: 4; }

    /* 開關樣式 */
    .switch-arm { 
        stroke: #ecf0f1; stroke-width: 4; stroke-linecap: round;
        transition: transform 0.2s ease-out; 
        transform-origin: 0 0; 
    }
    
    .label { font-size: 14px; fill: #bdc3c7; font-weight: bold; text-anchor: middle; pointer-events: none; }
    
    .status-text { 
        width: 100%;
        margin-top: 10px; 
        font-size: 0.9rem; 
        min-height: 3.5em; 
        color: #ecf0f1; 
        background: rgba(0,0,0,0.2); 
        padding: 10px; 
        border-radius: 6px; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        line-height: 1.3;
    }

    .reset-btn {
        margin-top: 40px;
        padding: 12px 40px; background:#e67e22; border:none; color:white; font-weight:bold; font-size:1.1rem;
        border-radius: 30px; cursor:pointer; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4); 
    }
    .reset-btn:active { transform: scale(0.95); background: #d35400; }

</style>
</head>
<body>

<div class="container">
    <h2>⚡ Circuit Logic Lab</h2>
    <p class="subtitle">Click Switch to Toggle • Click Bulb to Break<br>點擊開關通電 • 點擊燈泡模擬損壞</p>

    <div class="lab-grid">
        
        <div class="circuit-box">
            <div class="box-title">1. Series (串聯)</div>
            <svg viewBox="0 0 200 240" preserveAspectRatio="xMidYMid meet">
                <path d="M 60 220 L 20 220 L 20 40 L 180 40 L 180 220 L 140 220" class="wire" id="wire-series" />
                
                <g transform="translate(100, 220)">
                    <rect x="-30" y="-10" width="60" height="20" fill="#2c3e50" stroke="#7f8c8d" stroke-width="2"/>
                    <line x1="-5" y1="-12" x2="-5" y2="12" stroke="#ecf0f1" stroke-width="2"/>
                    <line x1="5" y1="-7" x2="5" y2="7" stroke="#ecf0f1" stroke-width="4"/>
                    <text x="-40" y="5" fill="#ecf0f1" font-weight="bold" font-size="16">+</text>
                </g>

                <g transform="translate(50, 40)" class="switch-group interactive" onclick="toggleSwitch('series')">
                    <circle cx="0" cy="0" r="4" fill="#ecf0f1"/>
                    <circle cx="30" cy="0" r="4" fill="#ecf0f1"/>
                    <text x="15" y="-15" class="label">Switch</text>
                    <line x1="0" y1="0" x2="28" y2="0" class="switch-arm" id="sw-arm-series" transform="rotate(-30)"/>
                    <rect x="-10" y="-20" width="50" height="40" fill="transparent"/>
                </g>

                <g transform="translate(180, 80)" class="bulb-group interactive" onclick="breakBulb('s1')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-s1" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-s1" />
                    <text x="-25" y="5" class="label" text-anchor="end">B1</text>
                </g>
                <g transform="translate(180, 160)" class="bulb-group interactive" onclick="breakBulb('s2')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-s2" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-s2" />
                    <text x="-25" y="5" class="label" text-anchor="end">B2</text>
                </g>
            </svg>
            <div class="status-text" id="status-series">Switch is Open.</div>
        </div>

        <div class="circuit-box">
            <div class="box-title parallel-title">2. Parallel (並聯)</div>
            <svg viewBox="0 0 200 240" preserveAspectRatio="xMidYMid meet">
                <path d="M 60 220 L 20 220 L 20 40 L 60 40" class="wire" id="wire-p-main1" />
                <path d="M 140 40 L 180 40 L 180 220 L 140 220" class="wire" id="wire-p-main2" />
                
                <path d="M 60 40 L 140 40" class="wire" id="wire-p-b1" />
                <path d="M 20 130 L 180 130" class="wire" id="wire-p-b2" />
                
                <line x1="20" y1="40" x2="20" y2="130" class="wire" id="wire-p-connL" />
                <line x1="180" y1="40" x2="180" y2="130" class="wire" id="wire-p-connR" />

                <g transform="translate(100, 220)">
                    <rect x="-30" y="-10" width="60" height="20" fill="#2c3e50" stroke="#7f8c8d" stroke-width="2"/>
                    <line x1="-5" y1="-12" x2="-5" y2="12" stroke="#ecf0f1" stroke-width="2"/>
                    <line x1="5" y1="-7" x2="5" y2="7" stroke="#ecf0f1" stroke-width="4"/>
                    <text x="-40" y="5" fill="#ecf0f1" font-weight="bold" font-size="16">+</text>
                </g>

                <g transform="translate(40, 220)" class="switch-group interactive" onclick="toggleSwitch('parallel')">
                    <circle cx="0" cy="0" r="4" fill="#ecf0f1"/><circle cx="30" cy="0" r="4" fill="#ecf0f1"/>
                    <line x1="0" y1="0" x2="28" y2="0" class="switch-arm" id="sw-arm-parallel" transform="rotate(-30)"/>
                    <text x="15" y="-15" class="label">Main</text>
                    <rect x="-10" y="-20" width="50" height="40" fill="transparent"/>
                </g>

                <g transform="translate(100, 40)" class="bulb-group interactive" onclick="breakBulb('p1')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-p1" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-p1" />
                    <text x="0" y="-22" class="label">B1</text>
                </g>
                <g transform="translate(100, 130)" class="bulb-group interactive" onclick="breakBulb('p2')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-p2" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-p2" />
                    <text x="0" y="-22" class="label">B2</text>
                </g>
            </svg>
            <div class="status-text" id="status-parallel">Switch is Open.</div>
        </div>

        <div class="circuit-box">
            <div class="box-title complex-title">3. Mixed (混合)</div>
            <svg viewBox="0 0 200 240" preserveAspectRatio="xMidYMid meet">
                <path d="M 60 220 L 20 220 L 20 40 L 60 40" class="wire" id="wire-c1-main1" />
                <path d="M 140 40 L 180 40 L 180 220 L 140 220" class="wire" id="wire-c1-main2" />

                <path d="M 60 40 L 140 40" class="wire" id="wire-c1-br1" />

                <path d="M 20 130 L 70 130" class="wire" id="wire-c1-br2a" />
                <path d="M 130 130 L 180 130" class="wire" id="wire-c1-br2b" />
                <path d="M 90 130 L 110 130" class="wire" id="wire-c1-br2c" /> <line x1="20" y1="40" x2="20" y2="130" class="wire" id="wire-c1-connL" />
                <line x1="180" y1="40" x2="180" y2="130" class="wire" id="wire-c1-connR" />

                <g transform="translate(100, 220)">
                    <rect x="-30" y="-10" width="60" height="20" fill="#2c3e50" stroke="#7f8c8d" stroke-width="2"/>
                    <line x1="-5" y1="-12" x2="-5" y2="12" stroke="#ecf0f1" stroke-width="2"/>
                    <line x1="5" y1="-7" x2="5" y2="7" stroke="#ecf0f1" stroke-width="4"/>
                    <text x="-40" y="5" fill="#ecf0f1" font-weight="bold" font-size="16">+</text>
                </g>
                
                <g transform="translate(40, 220)" class="switch-group interactive" onclick="toggleSwitch('complex1')">
                    <circle cx="0" cy="0" r="4" fill="#ecf0f1"/><circle cx="30" cy="0" r="4" fill="#ecf0f1"/>
                    <line x1="0" y1="0" x2="28" y2="0" class="switch-arm" id="sw-arm-c1" transform="rotate(-30)"/>
                    <text x="15" y="-15" class="label">Main</text>
                    <rect x="-10" y="-20" width="50" height="40" fill="transparent"/>
                </g>

                <g transform="translate(100, 40)" class="bulb-group interactive" onclick="breakBulb('c1_b1')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-c1-b1" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-c1-b1" />
                    <text x="0" y="-22" class="label">B1</text>
                </g>
                <g transform="translate(80, 130)" class="bulb-group interactive" onclick="breakBulb('c1_b2')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-c1-b2" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-c1-b2" />
                    <text x="0" y="25" class="label">B2</text>
                </g>
                <g transform="translate(120, 130)" class="bulb-group interactive" onclick="breakBulb('c1_b3')">
                    <circle cx="0" cy="0" r="14" class="bulb-glass" id="bulb-c1-b3" />
                    <path d="M -8 -8 L 8 8 M 8 -8 L -8 8" class="bulb-broken-x" id="x-c1-b3" />
                    <text x="0" y="25" class="label">B3</text>
                </g>
            </svg>
            <div class="status-text" id="status-c1">
                Challenge: Break B2.<br>Does B1 (top) stay ON?
            </div>
        </div>

    </div>
    
    <button class="reset-btn" onclick="resetAll()">Reset All (重置)</button>

</div>

<script>
    let state = {
        series: { on: false, b1: true, b2: true },
        parallel: { on: false, b1: true, b2: true },
        complex1: { on: false, b1: true, b2: true, b3: true }
    };

    function toggleSwitch(type) {
        state[type].on = !state[type].on;
        updateVisuals();
    }

    function breakBulb(id) {
        let type, bulbKey;
        if (id.startsWith('c')) {
            const parts = id.split('_');
            type = 'complex1';
            bulbKey = parts[1];
        } else {
            type = id.startsWith('s') ? 'series' : 'parallel';
            bulbKey = id.endsWith('1') ? 'b1' : 'b2';
        }
        state[type][bulbKey] = !state[type][bulbKey];
        updateVisuals();
    }

    function resetAll() {
        state = {
            series: { on: false, b1: true, b2: true },
            parallel: { on: false, b1: true, b2: true },
            complex1: { on: false, b1: true, b2: true, b3: true }
        };
        updateVisuals();
    }

    function setWireState(id, active) {
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.remove('wire-active');
        if (active) el.classList.add('wire-active');
    }

    function setBulbState(prefix, bulbKey, isOn, isBroken) {
        const bulb = document.getElementById(`bulb-${prefix}`);
        const x = document.getElementById(`x-${prefix}`);
        x.style.display = isBroken ? 'block' : 'none';
        bulb.classList.remove('bulb-on');
        if (isOn && !isBroken) bulb.classList.add('bulb-on');
    }

    function setSwitchState(id, closed) {
        document.getElementById(id).setAttribute('transform', closed ? 'rotate(0)' : 'rotate(-30)');
    }

    function updateVisuals() {
        // --- 1. SERIES ---
        const s = state.series;
        const sFlow = s.on && s.b1 && s.b2;
        setSwitchState('sw-arm-series', s.on);
        setBulbState('s1', 'b1', sFlow, !s.b1);
        setBulbState('s2', 'b2', sFlow, !s.b2);
        setWireState('wire-series', sFlow);
        
        const sStatus = document.getElementById('status-series');
        if (!s.on) sStatus.innerText = "Switch is Open.";
        else if (sFlow) sStatus.innerHTML = "<span style='color:#2ecc71'>Current Flowing!</span>";
        else sStatus.innerHTML = "<span style='color:#e74c3c'>Broken!</span> One bulb breaks, ALL go out.";

        // --- 2. PARALLEL ---
        const p = state.parallel;
        const p1On = p.on && p.b1;
        const p2On = p.on && p.b2;
        const pAnyOn = p1On || p2On;
        setSwitchState('sw-arm-parallel', p.on);
        setBulbState('p1', 'b1', p1On, !p.b1);
        setBulbState('p2', 'b2', p2On, !p.b2);
        setWireState('wire-p-main1', p.on);
        setWireState('wire-p-main2', pAnyOn);
        setWireState('wire-p-connL', pAnyOn);
        setWireState('wire-p-connR', pAnyOn);
        setWireState('wire-p-b1', p1On);
        setWireState('wire-p-b2', p2On);
        
        const pStatus = document.getElementById('status-parallel');
        if (!p.on) pStatus.innerText = "Switch is Open.";
        else if (p1On && p2On) pStatus.innerHTML = "<span style='color:#2ecc71'>All On!</span>";
        else if (pAnyOn) pStatus.innerHTML = "<span style='color:#2ecc71'>Partial On!</span> Independent paths.";
        else pStatus.innerHTML = "All broken.";

        // --- 3. MIXED ---
        const c1 = state.complex1;
        const c1_br1_on = c1.on && c1.b1;
        // Branch 2 is series: requires B2 AND B3
        const c1_br2_on = c1.on && c1.b2 && c1.b3;
        const c1_any_on = c1_br1_on || c1_br2_on;

        setSwitchState('sw-arm-c1', c1.on);
        setBulbState('c1-b1', 'b1', c1_br1_on, !c1.b1);
        setBulbState('c1-b2', 'b2', c1_br2_on, !c1.b2);
        setBulbState('c1-b3', 'b3', c1_br2_on, !c1.b3);
        
        setWireState('wire-c1-main1', c1.on);
        setWireState('wire-c1-main2', c1_any_on);
        
        // Branch 1 Wires
        setWireState('wire-c1-br1', c1_br1_on);
        
        // Branch 2 Wires
        setWireState('wire-c1-connL', c1_br2_on);
        setWireState('wire-c1-connR', c1_br2_on);
        setWireState('wire-c1-br2a', c1_br2_on);
        setWireState('wire-c1-br2b', c1_br2_on);
        setWireState('wire-c1-br2c', c1_br2_on);
        
        const c1Status = document.getElementById('status-c1');
        if (!c1.on) c1Status.innerText = "Open.";
        else if(c1_br1_on && !c1_br2_on) c1Status.innerHTML = "Bottom loop broken, <span style='color:#2ecc71'>Top (B1) stays ON!</span>";
        else if(!c1_br1_on && c1_br2_on) c1Status.innerHTML = "Top loop broken, <span style='color:#2ecc71'>Bottom (B2+B3) stays ON!</span>";
        else if(c1_br1_on && c1_br2_on) c1Status.innerHTML = "Normal Operation.";
        else c1Status.innerHTML = "All Broken.";
    }

    updateVisuals();
</script>
</body>
</html>